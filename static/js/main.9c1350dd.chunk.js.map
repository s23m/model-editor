{"version":3,"sources":["Resources/vertex.svg","Resources/edge.svg","Resources/select.svg","Resources/redo.svg","Resources/undo.svg","Resources/help.svg","App.js","ServiceWorker.js","DataStructures/SemanticIdentity.js","UIElements/SemanticDomainEditor.js","DataStructures/Graph.js","DataStructures/ArrowProperties.js","DataStructures/Cardinality.js","DataStructures/EdgeEnd.js","UIElements/LeftMenu.js","DataStructures/Arrow.js","Serialisation/NewFileManager.js","UIElements/ContainmentTree.js","DataStructures/Vertex.js","UIElements/Canvas.js","UIElements/CanvasDraw.js","UIElements/ContextMenu.js","UIElements/MainView.js","index.js"],"names":["module","exports","App","className","id","Boolean","window","location","hostname","match","rows","SemanticIdentity","name","description","abbreviation","shortAbbreviation","UUID","translations","this","typeName","undefined","replace","c","crypto","getRandomValues","Uint8Array","toString","VertexNode","vertex","children","Set","cleanObjectPath","vertexObjectPath","node","add","traversedVertices","isRemoved","has","delete","child","remove","recursive","semanticIdentity","getVertexNode","flattenedArray","childNode","push","flatten","flattenVertexNodes","returnOption","parsedRenderKey","ArrowChildren","VertexChildren","i","currentObjects","length","getRenderKey","title","setVertexTreePath","tempTreeObj","text","data","renderkey","modelkey","getModelKey","state","opened","type","ourSourceEnd","pathData","ourDestEnd","textSource","textDest","j","someObject","treeAppearanceSwitches","getNavigable","getAggregation","arrowIcon","folderTitle","treePath","ArrowEdge","flattenedVertexNodes","arrow","updateVertices","sourceVertexNodeObject","destVertexNodeObject","isSourceFound","sourceVertexUUID","isDestFound","destVertexUUID","vertexNode","Graph","vertexArrayFlattened","arrowArrayFlattened","rootVertices","arrows","objects","Array","isArray","object","addVertex","addArrow","originalUUID","newTitle","originalVertex","sID","console","log","getArrowEdge","destVertexNode","sourceVertexNode","isAnotherRoot","sourceVertex","error","returnArray","destVertex","newobject","isEquivalentArrow","isArrowWithSameSource","isEquivalentSource","isEquivalentDest","removeFromChildren","rootNode","arrowEdge","doFlattenVertices","doFlattenArrows","verticesSet","arrowsSet","from","concat","setRows","setColumns","textInput","React","createRef","translationColumns","onSave","workbook","xlsx","writeBuffer","then","buffer","saveAs","Blob","getRowId","row","styles","input","fontSize","width","label","container","maxWidth","selector","height","StartEditActionSelector","withStyles","props","defaultAction","changeAction","classes","Grid","alignItems","Typography","Select","onChange","e","target","value","OutlinedInput","labelWidth","margin","MenuItem","SelectTextChecker","isSelectText","changeSelectText","FormControlLabel","control","Checkbox","checked","color","EditPropsPanel","FocusableCell","onClick","restProps","Cell","tabIndex","onFocus","useState","createColumns","columns","setColumnsRet","columnName","editingEnabled","editingStateColumnExtensions","generatedRows","setRowsRet","wordWrapEnabled","tableColumnExtensions","startEditAction","setStartEditAction","selectTextOnEditStart","setSelectTextOnEditStart","exporterRef","useRef","startExport","useCallback","current","exportGrid","Paper","InputGroup","FormControl","ref","placeholder","aria-label","aria-describedby","Append","Button","variant","updateColumns","addColumn","splice","indexOf","removeColumn","onCommitChanges","changedRows","added","changed","deleted","startingAddedId","map","index","currentObjectsFlattened","treeVert","vertexData","updateChangedObject","o","sourceEdgeEnd","destEdgeEnd","updateChangedObjects","deletedSet","filter","columnExtensions","cellComponent","getRowForObject","translation","columnNames","set","setTranslationColumns","newColumns","EdgeEnd","EdgeEndToString","StringToEdgeEnd","LineColour","LineColourToStringName","StringNameToLineColour","LineType","LineTypeToString","StringToLineType","Cardinality","lowerBound","upperBound","attachedToUUID","isVisible","numLowerBound","numUpperBound","getDescription","lower","upper","headType","ArrowProps","cardinality","edgeEndRenderKey","getCurrentRenderKey","edgeEndModelKey","getCurrentModel","key","visibility","canvasContext","points","strokeColour","fillColour","strokeStyle","fillStyle","beginPath","moveTo","X","Y","lineTo","closePath","fill","stroke","x","y","angle","lineColour","angleFromLine","Math","PI","angleInverted","arrowPoints","cos","sin","drawLines","sideLength","deg30","trianglePoints","deg20","diamondPoints","drawArrowEnd","drawTriangleEnd","drawDiamondEnd","newType","LeftMenuType","TreeView","Vertex","Arrow","Artifact","Container","LeftMenuTypeToString","StringToLeftMenuType","Tool","Visibility","Edge","Specialisation","LeftMenu","testUpdateLabel","setPath","getVertexColour","selectedObject","getColour","setVertexColour","colour","setColour","hex","canvasDraw","deleteTitle","setState","getMenu","leftMenuContents","toolbar","setMode","src","iconSelect","alt","onKeyDown","onKeyPressed","iconVertex","iconEdge","menu","setLeftMenu","onInput","handleChange","getContentAsString","getS23MIconsSelector","getColourPicker","defaultChecked","getAbstract","toggleAbstract","deselectElement","vertexDeleteElement","defaultValue","vertexPath","onKeyUp","setTitle","setContent","deleteElement","edgeType","setNavigable","setAggregation","getSourceCardinalityVisibility","toggleSourceCardinalityVisibility","getSourceCardinalityLowerBound","min","max","updateCardinality","getSourceCardinalityUpperBound","getDestCardinalityVisibility","toggleDestCardinalityVisibility","getDestCardinalityLowerBound","getDestCardinalityUpperBound","setStartLabel","setEndLabel","stripElement","setFormRef","fileNames","content","bind","formRef","element","setIcons","event","mainState","selectedItem","drawMode","document","addEventListener","keyCode","prevProps","prevState","snapshot","leftMenu","getElementById","preventDefault","fetch","serverURL","method","headers","res","json","icons","forEach","icon","newContent","split","newLineType","setLineType","newColour","setLineColour","newLabel","sourceLowerBound","sourceUpperBound","currentSourceVisibility","destLowerBound","destUpperBound","currentDestVisibility","updateSourceCardinality","updateDestCardinality","dropdownOptions","fileName","slice","disabled","shouldIconBeSelected","setIcon","shouldTextBeSelected","setText","DropdownButton","onChangeComplete","presetColors","isTextSet","isIconSet","side","toggleNavigable","toggleAggregation","SourceAggregation","DestAggregation","trimPath","Component","objectsList","updateAttachedVertices","rebuildPath","lineType","selected","sourceIsNavigable","destIsNavigable","sourceIsAggregation","destIsAggregation","arrowModelKey","arrowRenderKey","getModelRenderKey","path","connectedObjectUUIDs","getObjectUUIDList","pathItem","getZerothCasePathItem","realHeight","output","item","pathStart","pathEnd","toggleVisibility","val","nodeIndex","d","topLeft","top","topRight","right","bottomRight","bottom","bottomLeft","left","vertexNodes","lineAngle","atan2","getSY","getNSY","getSX","getNSX","draw","getEY","getNEY","getEX","getNEX","startIndex","endIndex","indexSx","indexEx","indexSy","indexEy","abs","sourceText","destText","sourceCtext","destCtext","sxOffset","syOffset","exOffset","eyOffset","sxOffsetc","syOffsetc","exOffsetc","eyOffsetc","sourceTextWidth","measureText","destTextWidth","sourceCtextWidth","destCtextWidth","charWidth","sxFlip","syFlip","exFlip","eyFlip","E1index","E2index","startLRArrow","isPathSegmentLR","endLRArrow","SSX","SSY","SEX","SEY","ESX","ESY","EEX","EEY","sourceCardText","destCardText","Offsets","getTextOffsets","fillText","setLineDash","to","drawStartHead","drawEndHead","drawLabelsAndCardinalities","pos","drawMarker","cx","cy","intersectsSegment","getDistance","getSaveData","vertexObjects","arrowObjects","treeData","JSON","parse","stringify","folderData","getFolderData","decoyFolderData","getDecoyFolderData","getVertexData","decoyVertexData","getDecoyVertexData","modelObjects","getModelData","decoyModelObjects","getDecoyModelData","totalRenderKeys","getTotalRenderKeys","totalModels","getTotalModels","currentModel","currentKey","currentFolder","getSelectedFolderKey","vertices","tree","packages","dPackages","treeVertex","dTreeVertex","graph","dGraph","renderKeys","modelKeys","currentMod","currentFol","load","jsonString","saveData","vert","newVertices","newArrows","newConstructor","loadedVertex","remakeArrow","setFolderData","setDecoyFolderData","setVertexData","setDecoyVertexData","setModelData","setDecoyModelData","dGrraph","setTreeData","setTotalRenderKey","setTotalModelKeys","setCurrentObjects","updateArrows","setSelectedFolderKey","setNewRenderKey","setNewModel","drawAll","remakeSemantic","semantic","remakeEdge","edge","newArrow","importLoad","folderKeyMap","modelKeyMap","arrowUpdated","folder","folderKey","originalKey","renderKey","originalParentKey","parentRenderKey","newKey","newParentKey","model","modelKey","originalModelKey","newModelKey","packagesCompare","models","vertexRenderKey","includes","vertexModelKey","getCurrentObjects","addObject","setRenderKey","setModelKey","loadDirect","saveStates","currentState","createSaveState","newData","Object","assign","shift","unshift","pop","someVertexPath","currentlySelectedObject","showingVertPath","folderDataRoot","selectedFolderKey","newTreeData","newFolderData","getContainerData","loadFirstModel","setPresent","setAway","handleAddFolder","folderName","parentKey","incrementTotalRenderKeys","tempFolderThing","NaN","folderThing2","handleDeleteFolder","selectedRenderKey","deleteFolderChildren","selectedFolder","folderChildren","handleDeleteModel","handleDeleteVertex","deleteModelChildren","selectedModel","verticesFolder","v","handleRenameFolder","newName","rKey","handleAddVertex","vertexName","tempVertexThing","imageElements","vertexThing2","handleAddModel","modelName","semanticID","incrementTotalModels","decoyModelThing","tempModelThing","selectedUUID","selectedModelKey","handleRenameModel","mKey","handleModelRebase","newRkey","determineOwnership","vertexOrArrow","determineSubFolders","getModelNameFromKey","find","initialFolderAdded","ContainmentTree","canvasItems","subFolderItems","combinedItems","toTreeViewElement","core","root","selectedVertex","nextLevel","vertexOrEdge","actualObject","b","cont","treeDat","highestLevel","dragStart","removeEventListener","click","vertData","dataTransfer","setData","original","handleElementSelect","draggable","padding","imageElement","orignalVertex","Origin","isAbstract","renderedx","renderedy","awayx","awayy","status","isContainer","floor","random","newSem","newOrigin","mergedContent","Icons","Text","ex","ey","pad","hasContent","iconAreaHeight","contentHeight","possibleWidth","iconListLen","increaseWidthIfNecessary","is","font","measuredNameText","measuredText","shadowOffsetX","shadowOffsetY","fillRect","strokeRect","yPos","xPos","loadImage","sh","sw","scale","drawImage","iconPadding","iconHeight","Image","crossOrigin","onload","dy","txPos","tyPos","cursorX","cursorY","getNearestSide","sides","xPercentage","yPercentage","goodSide","distanceThreshold","rightDist","topDist","leftDist","closestIndex","closestDistance","distArrays","shortest","selectMultiple","selectDown","savedObjects","selectedCanvasObject","Canvas","ocm","mouseDown","canvas","position","startX","startY","shiftKey","button","intersection","tool","ctrlKey","foundEnd","ob","mouseUp","cancelDraw","resizing","canvasElement","onmousemove","arrowToolSelected","getConnectionDataForArrow","snapped","firstArrowJoint","secondObject","findIntersected","newObject","arrowPath","savedArrows","createObject","mouseStartX","mouseStartY","previousObject","upBoxes","upArrows","downBoxes","downArrows","leftBoxes","leftArrows","rightBoxes","rightArrows","first","second","bigBox","smallBox","collectMehBox","collectsidebox","arrangeboxesandarrows","arrangeboxesandarrowshorizontal","shiftBoxes","coord","lastX","lastY","onMouseMove","x1","y1","orderCoordinates","vy1","findNearestGridY","vy2","createArtifact","newVert","setIsContainer","createContainer","setTimeout","canvasObject","CollideCount","past_location","past_size","blockBeenSelected","canvasRef","zoom","zoomLevel","dragEnter","dragOver","dragLeave","drop","alert","droppedSemanticID","getData","droppedVertex","mouseCoords","visibilityCheck","canvasVert","originText","setOrigin","onContextMenu","onMouseDown","onMouseUp","onMouseLeave","mouseLeave","mouseOriginX","mouseOriginY","canvasWidth","canvasHeight","dragging","yRows","currentRenderKey","newModel","arrowType","resetMouseOrigin","canvasRect","getBoundingClientRect","canvasContainer","getElementsByClassName","styleHeight","getComputedStyle","getPropertyValue","styleWidth","setAttribute","getEffectiveZoom","recalculateScale","clearCanvas","resetTransform","sourceUUIDs","ArrowUUIDSource","destUUIDs","ArrowUUIDDest","slotHeight","checkResizeBounds","bounds","getBounds","x2","y2","inYBounds","inXBounds","nearest","nearestDistance","sideData","getNearestSideFrom","coordinate","lastPathX","lastPathY","relAngle","l","angles","nearestAngle","nearestRad","xv","yv","getSelectedObject","resizeObjectOnMouseMove","resizeVars","coords","getGraphXYFromMouseEvent","expandSide","conData","StickArrowToObject","updateA","newObjects","getObjectFromUUID","foundObject","connectionData","onLeftMousePress","saveBlockStates","cDist","nearestPointIndex","nearestArrow","point","hypot","findNearestArrowPointIndex","func","moveArrowPointOnMouseMove","compareSizesToMoveAll","objectID","box","verticalArray","horizontalArray","boxArray","allArrows","boxes","bigbox","globalAlpha","onMiddleClick","shiftDown","friendObject","arrowsVert","arrowsHoriz","ObjectsToCheck","nextObjects","n","newfriendObject","nf","of","p","F","S","saveDisX","saveDisY","moveObject","friends","k","solidifyObject","setZoom","newZoom","xpos","ypos","oldLineWidth","lineWidth","oldStrokeStyle","oldFillStyle","arc","sqrt","pow","intersects","linkContainer","baseUUID","mirrorUUID","baseSemantic","updateLinkedContainers","inputContainer","updateVertex","getLinkedVertex","verticies","newPath","clientX","clientY","sx","sy","rightClickedObject","elementID","rightClickedItem","rightClickedItemKey","menuType","ContextMenu","showMenu","handleClick","newFolderKey","parseInt","setLeftMenuToTree","keys","handleKey","handleContextMenu","source","dest","sourceName","destName","pageX","pageY","style","renderedOutput","matchingContainers","matchingModels","matchingUUID","renderedContainers","renderedModels","MainProgramClass","updateFolderName","addFolder","a","deleteFolder","editFolderName","addModel","deleteModel","editModelName","cZoom","setModelName","showFile","refreshTree","File","FileReader","FileList","file","querySelector","files","reader","readAsText","result","importFile","toggleSemanticDomainState","semanticTableEnabled","newRows","resetRows","theObject","div","SelectedTool","backgroundColor","mode","nearestObject","ctrl","OP","setSelected","None","maxSavedStates","SemanticDomainEditor","size","Dropdown","Item","confirm","reload","DLelement","createElement","href","toDataURL","download","body","appendChild","JSONdata","dataTransformed","dataFile","prompt","URL","createObjectURL","removeChild","save","readOnly","mainUndo","iconUndo","mainRedo","iconRedo","iconHelp","ReactDOM","render","StrictMode","getContext","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.9c1350dd.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/vertex.4937cefd.svg\";","module.exports = __webpack_public_path__ + \"static/media/edge.09e9d9dc.svg\";","module.exports = __webpack_public_path__ + \"static/media/select.8b3cad47.svg\";","module.exports = __webpack_public_path__ + \"static/media/redo.a80ea341.svg\";","module.exports = __webpack_public_path__ + \"static/media/undo.5858a028.svg\";","module.exports = __webpack_public_path__ + \"static/media/help.80a7660b.svg\";","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport React from 'react';\r\n\r\nimport './App.css';\r\n\r\n\r\nfunction App() {\r\n\r\n  return (\r\n \r\n        <div className=\"App\">\r\n            <div id='program'>\r\n            </div>\r\n        </div>\r\n\r\n  );\r\n\r\n\r\n}\r\n\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// Resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nexport function createUUID() {\r\n    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\r\n        // eslint-disable-next-line\r\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\r\n    );\r\n}\r\n\r\nexport class SemanticIdentity {\r\n    constructor(name, description, abbreviation, shortAbbreviation, UUID, translations){\r\n        this.typeName = \"SemanticIdentity\";\r\n        \r\n        if (UUID !== undefined){\r\n            this.UUID = UUID;\r\n        } else {\r\n            this.UUID = createUUID();\r\n        }\r\n\r\n        this.name = name;\r\n        this.description = description;\r\n        this.abbreviation = abbreviation;\r\n        this.shortAbbreviation = shortAbbreviation;\r\n\r\n        if (translations !== undefined){\r\n            this.translations = translations;\r\n        } else {\r\n            this.translations = [];\r\n        }\r\n    }\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\n// React imports\r\nimport React, { useRef, useCallback, useState } from 'react';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport GridMUI from '@material-ui/core/Grid';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport { EditingState } from '@devexpress/dx-react-grid';\r\n\r\nimport saveAs from 'file-saver';\r\n\r\nimport InputGroup from 'react-bootstrap/InputGroup'\r\nimport FormControl from 'react-bootstrap/FormControl'\r\nimport Button from 'react-bootstrap/Button'\r\n\r\nimport { GridExporter } from '@devexpress/dx-react-grid-export';\r\n\r\nimport {\r\n    Grid,\r\n    Table,\r\n    TableHeaderRow,\r\n    TableInlineCellEditing,\r\n    Toolbar,\r\n    ExportPanel,\r\n} from '@devexpress/dx-react-grid-material-ui';\r\n\r\nimport {\r\n    Plugin,\r\n    Template,\r\n    TemplatePlaceholder,\r\n} from '@devexpress/dx-react-core';\r\n\r\n// In program imports\r\nimport {currentObjects} from \"./CanvasDraw\";\r\nimport {vertexData} from \"./ContainmentTree\"\r\n\r\n// Globals\r\nlet rows;\r\nlet setRows = null;\r\nlet setColumns = null;\r\nlet textInput = React.createRef();\r\nexport var translationColumns = [];\r\n\r\nconst onSave = (workbook) => {\r\n    workbook.xlsx.writeBuffer().then((buffer) => {\r\n        saveAs(new Blob([buffer], { type: 'application/octet-stream' }), 'DataGrid.xlsx');\r\n    });\r\n};\r\n\r\nconst getRowId = row => row.id;\r\n\r\nconst styles = () => ({\r\n    input: {\r\n        fontSize: '14px',\r\n        width: '90px',\r\n    },\r\n    label: {\r\n        fontSize: '14px',\r\n    },\r\n    container: {\r\n        maxWidth: '18em',\r\n    },\r\n    selector: {\r\n        height: '32px',\r\n    },\r\n});\r\n\r\n// #FOLD_BLOCK\r\nconst StartEditActionSelectorBase = (props) => {\r\n    const { defaultAction, changeAction, classes } = props;\r\n    return (\r\n        <GridMUI\r\n            container\r\n            alignItems=\"center\"\r\n            className={classes.container}\r\n        >\r\n            <Typography\r\n                className={classes.label}\r\n            >\r\n                Start Edit Action:\r\n                &nbsp;\r\n            </Typography>\r\n            <Select\r\n                onChange={e => changeAction(e.target.value)}\r\n                value={defaultAction}\r\n                className={classes.selector}\r\n                input={(\r\n                    <OutlinedInput\r\n                        classes={{ input: classes.input }}\r\n                        labelWidth={0}\r\n                        margin=\"dense\"\r\n                    />\r\n                )}\r\n            >\r\n                <MenuItem value=\"click\">Click</MenuItem>\r\n                <MenuItem value=\"doubleClick\">Double Click</MenuItem>\r\n            </Select>\r\n        </GridMUI>\r\n    );\r\n};\r\nconst StartEditActionSelector = withStyles(styles, { name: 'StartEditActionSelector' })(StartEditActionSelectorBase);\r\n\r\n// #FOLD_BLOCK\r\nconst SelectTextCheckerBase = (props) => {\r\n    const { isSelectText, changeSelectText, classes } = props;\r\n    return (\r\n        <FormControlLabel\r\n            control={(\r\n                <Checkbox\r\n                    checked={isSelectText}\r\n                    onChange={e => changeSelectText(e.target.checked)}\r\n                    color=\"primary\"\r\n                />\r\n            )}\r\n            classes={{ label: classes.label }}\r\n            label=\"Select Text On Focus\"\r\n        />\r\n    );\r\n};\r\nconst SelectTextChecker = withStyles(styles, { name: 'SelectTextChecker' })(SelectTextCheckerBase);\r\n\r\nconst EditPropsPanel = props => (\r\n    <Plugin name=\"EditPropsPanel\">\r\n        <Template name=\"toolbarContent\">\r\n            <SelectTextChecker {...props} />\r\n            <TemplatePlaceholder />\r\n            <StartEditActionSelector {...props} />\r\n        </Template>\r\n    </Plugin>\r\n);\r\n\r\nconst FocusableCell = ({ onClick, ...restProps }) => (\r\n    <Table.Cell {...restProps} tabIndex={0} onFocus={onClick} />\r\n);\r\n\r\nexport default () => {\r\n    \r\n    // Create columns\r\n    let [columns, setColumnsRet] = useState(createColumns());\r\n    setColumns = setColumnsRet;\r\n\r\n    // Disable editing state\r\n    const [editingStateColumnExtensions] = useState([\r\n        { columnName: 'UUID', editingEnabled: false },\r\n        { columnName: 'type', editingEnabled: false },\r\n    ]);\r\n\r\n    // Rows\r\n    const [generatedRows, setRowsRet] = useState([]);\r\n    rows = generatedRows;\r\n    setRows = setRowsRet;\r\n\r\n    // Enable/Disable word Wrap\r\n    const [tableColumnExtensions] = useState([\r\n        { columnName: 'UUID', wordWrapEnabled: true },\r\n        { columnName: 'type', wordWrapEnabled: true },\r\n        { columnName: 'name', wordWrapEnabled: true },\r\n        { columnName: 'description', wordWrapEnabled: true },\r\n        { columnName: 'abbreviation', wordWrapEnabled: true },\r\n        { columnName: 'shortAbbreviation', wordWrapEnabled: true },\r\n    ]);\r\n\r\n    // Editable\r\n    const [startEditAction, setStartEditAction] = useState('click');\r\n    const [selectTextOnEditStart, setSelectTextOnEditStart] = useState(true);\r\n\r\n    const commitChanges = ({ added, changed, deleted}) => {\r\n        let changedRows;\r\n        if (added) {\r\n            const startingAddedId = rows.length > 0 ? rows[rows.length - 1].id + 1 : 0;\r\n            changedRows = [\r\n                ...rows,\r\n                ...added.map((row, index) => ({\r\n                    id: startingAddedId + index,\r\n                    ...row,\r\n                })),\r\n            ];\r\n        }\r\n        if (changed) {\r\n            changedRows = rows.map(row => (changed[row.id] ? { ...row, ...changed[row.id] } : row));\r\n            updateChangedObjects(changedRows);\r\n        }\r\n        if (deleted) {\r\n            const deletedSet = new Set(deleted);\r\n            changedRows = rows.filter(row => !deletedSet.has(row.id));\r\n        }\r\n\r\n        setRows(changedRows);\r\n    };\r\n\r\n    // Export functionality\r\n    const exporterRef = useRef(null);\r\n\r\n    const startExport = useCallback(() => {\r\n        exporterRef.current.exportGrid();\r\n    }, [exporterRef]);\r\n\r\n    // Return\r\n    return (\r\n        <Paper>\r\n            <InputGroup>\r\n                <FormControl\r\n                    ref={textInput}\r\n                    placeholder=\"Column name\"\r\n                    aria-label=\"Column name\"\r\n                    aria-describedby=\"basic-addon2\"\r\n                />\r\n                <InputGroup.Append>\r\n                    <Button variant=\"outline-secondary\" onClick={() => addColumn()}>Add</Button>\r\n                    <Button variant=\"outline-secondary\" onClick={() => removeColumn()}>Remove</Button>\r\n                </InputGroup.Append>\r\n            </InputGroup>\r\n            <Grid\r\n                rows={rows}\r\n                columns={columns}\r\n                getRowId={getRowId}\r\n            >\r\n                <EditingState\r\n                    onCommitChanges={commitChanges}\r\n                    columnExtensions={editingStateColumnExtensions}\r\n                />\r\n                <Table cellComponent={FocusableCell} columnExtensions={tableColumnExtensions} />\r\n                <TableHeaderRow />\r\n                <Toolbar />\r\n                <EditPropsPanel\r\n                    defaultAction={startEditAction}\r\n                    changeAction={setStartEditAction}\r\n                    isSelectText={selectTextOnEditStart}\r\n                    changeSelectText={setSelectTextOnEditStart}\r\n                />\r\n                <ExportPanel startExport={startExport} />\r\n                <TableInlineCellEditing\r\n                    startEditAction={startEditAction}\r\n                    selectTextOnEditStart={selectTextOnEditStart}\r\n                />\r\n            </Grid>\r\n            <GridExporter\r\n                ref={exporterRef}\r\n                rows={rows}\r\n                columns={columns}\r\n                onSave={onSave}\r\n            />\r\n        </Paper>\r\n    );\r\n};\r\n\r\nfunction addColumn() {\r\n    // Get\r\n    const value = textInput.current.value\r\n\r\n    // Clear column name\r\n    textInput.current.value = \"\";\r\n\r\n    // Check if value is empty\r\n    if (value === \"\" || value === null || value === undefined) {\r\n        return;\r\n    }\r\n\r\n    // Add column\r\n    translationColumns.push(value);\r\n    updateColumns();\r\n}\r\n\r\nfunction removeColumn() {\r\n    // Get\r\n    const value = textInput.current.value\r\n\r\n    // Clear column name\r\n    textInput.current.value = \"\";\r\n\r\n    // Delete from currentObjects\r\n    for (let object of currentObjects.flatten()) {\r\n        object.semanticIdentity.translations.delete(value);\r\n    }\r\n\r\n    // Delete column\r\n    translationColumns.splice(translationColumns.indexOf(value), 1);\r\n    updateColumns();\r\n}\r\n\r\nfunction updateColumns() {\r\n    setColumns(createColumns());\r\n}\r\n\r\nfunction getRowForObject(object) {\r\n    const row = {};\r\n\r\n    // Constants\r\n    row['id'] = object.semanticIdentity.UUID; // Just going to be based on UUID since it's easy and unique\r\n    row['UUID'] = object.semanticIdentity.UUID;\r\n    row['type'] = object.typeName;\r\n    row['name'] = object.semanticIdentity.name;\r\n    row['description'] = object.semanticIdentity.description;\r\n    row['abbreviation'] = object.semanticIdentity.abbreviation;\r\n    row['shortAbbreviation'] = object.semanticIdentity.shortAbbreviation;\r\n\r\n    // Translations\r\n    for (let o = 0; o < object.semanticIdentity.translations.length; o++) {\r\n        let translation = object.semanticIdentity.translations[o];\r\n\r\n        row[translation[0]] = translation[1];\r\n    }\r\n\r\n    return row;\r\n}\r\n\r\nexport function resetRows() {\r\n    let newRows = [];\r\n    let currentObjectsFlattened = currentObjects.flatten();\r\n\r\n    for (let i = 0; i < vertexData.length; i++) {\r\n        newRows.push(getRowForObject(vertexData[i]));\r\n    }\r\n    for(let i = 0; i < currentObjectsFlattened.length; i++){\r\n        // Add Arrow Ends\r\n        if (currentObjectsFlattened[i].typeName === \"Arrow\") {\r\n            newRows.push(getRowForObject(currentObjectsFlattened[i].sourceEdgeEnd));\r\n            newRows.push(getRowForObject(currentObjectsFlattened[i].destEdgeEnd));\r\n        }\r\n    }\r\n\r\n    if (setRows === null) {\r\n        console.error(\"Cannot set rows\");\r\n        return;\r\n    }\r\n\r\n    setRows(newRows);\r\n}\r\n\r\nfunction createColumns() {\r\n    // Create default columns\r\n    let columnNames = [\r\n        {name: 'UUID', title: 'UUID'},\r\n        {name: 'type', title: 'Type'},\r\n        {name: 'name', title: 'Name'},\r\n        {name: 'description', title: 'Description'},\r\n        {name: 'abbreviation', title: 'Abbreviation'},\r\n        {name: 'shortAbbreviation', title: 'Short Abbreviation'},\r\n    ];\r\n\r\n    // Add translation columns\r\n    for (let translation of translationColumns) {\r\n        columnNames.push({name: translation, title: translation});\r\n    }\r\n\r\n    return columnNames;\r\n}\r\n\r\nfunction updateChangedObject(object, row) {\r\n    // If should update\r\n    if (object.semanticIdentity.UUID === row['UUID']) {\r\n        \r\n        // Constants\r\n        object.semanticIdentity.abbreviation = row['abbreviation'];\r\n        object.semanticIdentity.shortAbbreviation = row['shortAbbreviation'];\r\n        object.semanticIdentity.name = row['name'];\r\n        object.title = row['name']; // update the title of the vertex to be the same as semantic name\r\n        object.semanticIdentity.description = row['description'];\r\n        object.text = row['name'] + \" \"\r\n        \r\n        // Translations\r\n        for (let translation of translationColumns) {\r\n            // Find translation in list\r\n            let set = false;\r\n            for (let i = 0; i < object.semanticIdentity.translations.length; i++) {\r\n                if (object.semanticIdentity.translations[i][0] === translation) {\r\n                    object.semanticIdentity.translations[i][1] = row[translation];\r\n                    set = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!set) {\r\n                object.semanticIdentity.translations.push([translation, row[translation]]);\r\n            }\r\n        }\r\n    }\r\n    \r\n    return row;\r\n}\r\n\r\nfunction updateChangedObjects(rows) {\r\n    \r\n    let currentObjectsFlattened = currentObjects.flatten();\r\n    let treeVert = vertexData\r\n\r\n    // Iterate through all rows\r\n    for (let i = 0; i < rows.length; i++) {\r\n\r\n        //itterate through tree verts\r\n        for (let j = 0; j < treeVert.length; j++) {\r\n            rows[i] = updateChangedObject(treeVert[j],rows[i])\r\n            console.log(treeVert[j])\r\n        }\r\n\r\n        // Iterate through all objects\r\n        for (let o = 0; o < currentObjectsFlattened.length; o++) {\r\n            // Update main objects\r\n            rows[i] = updateChangedObject(currentObjectsFlattened[o], rows[i]);\r\n\r\n            // Update edge ends\r\n            if (currentObjectsFlattened[o].typeName === \"Arrow\") {\r\n                rows[i] = updateChangedObject(currentObjectsFlattened[o].sourceEdgeEnd, rows[i]);\r\n                rows[i] = updateChangedObject(currentObjectsFlattened[o].destEdgeEnd, rows[i]);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function setTranslationColumns(newColumns) {\r\n    translationColumns = newColumns;\r\n    updateColumns();\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport { currentObjects,} from \"../UIElements/CanvasDraw\";\r\nimport {SemanticIdentity} from \"./SemanticIdentity\";\r\n\r\n\r\n\r\nexport class VertexNode {\r\n    constructor(vertex) {\r\n        this.vertex = vertex;\r\n        this.children = new Set();\r\n        this.typeName = \"VertexNode\";\r\n\r\n        //The path of this particular vertex node for displaying on the tree view element\r\n        this.cleanObjectPath = (\"Root\",\"/\",\"Vertices\")\r\n        this.vertexObjectPath = (\"Root\",\"/\",\"Vertices\")\r\n    }\r\n\r\n    add(node) {\r\n        this.children.add(node);\r\n    }\r\n\r\n    remove(traversedVertices, node) {\r\n        //onsole.log(\"remove is called\")\r\n        let isRemoved = false;\r\n        traversedVertices.add(this);\r\n\r\n        //Remove from the current vertex\r\n        isRemoved = this.children.has(node);\r\n        this.children.delete(node);\r\n\r\n        //Continue to remove from anywhere deeper in the tree\r\n        for (let child of this.children) {\r\n            if (!traversedVertices.has(child)) {\r\n                traversedVertices.add(child);\r\n                isRemoved = child.remove(traversedVertices, node);\r\n            }\r\n        }\r\n\r\n        return isRemoved;\r\n    }\r\n\r\n    getVertexNode(traversedVertices, vertex, recursive = true) {\r\n        for (let child of this.children) {\r\n            if (!traversedVertices.has(child)) {\r\n                traversedVertices.add(child);\r\n\r\n                if (child.vertex.semanticIdentity.UUID === vertex.semanticIdentity.UUID) {\r\n                    return child;\r\n                } else if (recursive) {\r\n                    let node = child.getVertexNode(traversedVertices, vertex);\r\n                    if (node !== null) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    //Remove from just the children of this object, without removing from deeper in the tree\r\n    removeFromChildren(node) {\r\n        if (this.children.has(node)) {\r\n            this.children.delete(node);\r\n            return true;\r\n\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    flatten(traversedVertices) {\r\n        var flattenedArray = [];\r\n\r\n        for (let childNode of this.children) {\r\n            if (!traversedVertices.has(childNode)) {\r\n                traversedVertices.add(childNode);\r\n                flattenedArray.push(childNode.vertex);\r\n\r\n                if (childNode !== null) {\r\n                    flattenedArray.push(...childNode.flatten(traversedVertices));\r\n                }\r\n            }\r\n        }\r\n\r\n        return flattenedArray;\r\n    }\r\n\r\n    flattenVertexNodes(traversedVertices) {\r\n        var flattenedArray = [];\r\n\r\n        for (let childNode of this.children) {\r\n            if (!traversedVertices.has(childNode)) {\r\n                traversedVertices.add(childNode);\r\n                flattenedArray.push(childNode);\r\n\r\n                if (childNode !== null) {\r\n                    flattenedArray.push(...childNode.flattenVertexNodes(traversedVertices));\r\n                }\r\n            }\r\n        }\r\n\r\n        return flattenedArray;\r\n    }\r\n\r\n    has(traversedVertices, node) {\r\n        //Search for object in children\r\n        if (this.children.has(node)) {\r\n            return true;\r\n\r\n        } else {\r\n\r\n            //Search for object in children of children\r\n            for (let child of this.children) {\r\n                if (!traversedVertices.has(child)) {\r\n                    traversedVertices.add(child);\r\n                    if (child.has(traversedVertices, node)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    toTreeViewElement(returnOption, parsedRenderKey) { //added the model key parameter to we can specifiy what models vertexes belong to\r\n        //console.log(\"toTreeViewElement called successfully\")\r\n        //Pretty much everything that's currently on the canvas is searched and then converted into the tree appropriate struct in the below if else statements.\r\n        //Then, the vertices and arrows folder nodes can display their appropriate children.\r\n        let ArrowChildren = [];\r\n        let VertexChildren = [];\r\n    \r\n\r\n        //These are no longer needed due to rework of assigning model children - Lachlan\r\n        /*\r\n        let verticies = []; // need to store the 'verticies folder' in an array for it to be iterable in a for loop - cooper\r\n        let arrows = []; // same issue as vertices not being iterable - Lachlan\r\n        */\r\n        \r\n\r\n\r\n        //Check which folder we're sticking these things into\r\n        if (returnOption === \"Vertex Folder\"){                  // they had a different spelling for vertex folder :DDDDD - cooper\r\n            //All objects currently on the canvas (excluding things like folders which only exist as tree view elements)\r\n            for(let i = 0; i < currentObjects.flatten().length; i++){\r\n                \r\n\r\n                //We onlt want the vertices in this folder\r\n                if (currentObjects.flatten()[i].typeName === \"Vertex\" && currentObjects.flatten()[i].getRenderKey() === parsedRenderKey){\r\n                    //Set the append the name of the path to include the vertex name\r\n                    if(currentObjects.flatten()[i].title === \"\"){\r\n                        this.setVertexTreePath(\"Unnamed Vertex\");\r\n                    }\r\n\r\n                    else{\r\n                        this.setVertexTreePath(currentObjects.flatten()[i].title);\r\n                    }\r\n                \r\n                \r\n\r\n\r\n                    //Create the appropriate struct for a tree view element from the vertex data\r\n                    let tempTreeObj = {\r\n                        text: currentObjects.flatten()[i].title,\r\n                        children: [],\r\n                        data: currentObjects.flatten()[i],\r\n                        renderkey: currentObjects.flatten()[i].getRenderKey(),\r\n                        modelkey: currentObjects.flatten()[i].getModelKey(),\r\n                        state: {opened: false}\r\n                    };\r\n\r\n                    //So you don't have vertices that are completely blank in the tree, looks kinda weird\r\n                    if (tempTreeObj.text === \"\"){\r\n                        tempTreeObj.text = \"Unnamed Vertex\";\r\n                    }\r\n                    \r\n                    //Finally, push to children. Makes it look like the following:\r\n                    //\r\n                    //  Vertex --+\r\n                    //           |\r\n                    //           +-- Unnamed Vertex   \r\n                    \r\n                    VertexChildren.push(tempTreeObj);\r\n\r\n                \r\n            }\r\n        }\r\n\r\n            return{\r\n                text: \"Vertices &#128193\",\r\n                children: VertexChildren,\r\n                data: null,\r\n                state: { opened: true },\r\n                type: \"Vertex Folder\"\r\n            }\r\n        }\r\n\r\n        //No longer necessary due to the rework of assigning model children - Lachlan\r\n            /*\r\n            let verticiesObject = { // push the vertex folder into an array of vertex folders - cooper\r\n                text: \"Vertices\",\r\n                children: VertexChildren,\r\n                data: null,\r\n                state: { opened: true },\r\n                type: \"Vertex Folder\"\r\n            }\r\n            verticies.push(verticiesObject)\r\n            //vertices folder\r\n            return verticies\r\n                \r\n            \r\n        }\r\n        */\r\n\r\n        //same typo as above if statement but for arrows\r\n        else if (returnOption === \"Arrow Folder\"){ //same thing but arrows folder - Lachlan\r\n            for(let i = 0; i < currentObjects.flatten().length; i++){\r\n\r\n                if (currentObjects.flatten()[i].typeName !== \"Vertex\" && currentObjects.flatten()[i].getRenderKey() === parsedRenderKey){\r\n                    //console.log(\"arrow key\")\r\n                    //console.log(currentObjects.flatten()[i].getModelKey())\r\n\r\n                        // Find the source and destination vertex as Keith defined in spec\r\n                        let ourSourceEnd = currentObjects.flatten()[i].pathData[1][1]\r\n                        let ourDestEnd = currentObjects.flatten()[i].pathData[0][1]\r\n\r\n                        let textSource = \"N/A\"\r\n                        let textDest = \"N/A\"\r\n                        let finalString = \"N/A\"\r\n\r\n                        // Looking through all of the current objects and matching the uuids\r\n                        for (let j = 0; j <currentObjects.flatten().length; j++){\r\n                        \r\n                            let someObject = currentObjects.flatten()[j]\r\n                            \r\n                            if (someObject.typeName === \"Vertex\"){\r\n                            \r\n                                if (ourSourceEnd === someObject.semanticIdentity.UUID){\r\n                                    \r\n                                    textDest = someObject.title\r\n                                }\r\n\r\n                                else if (ourDestEnd === someObject.semanticIdentity.UUID){\r\n                                    \r\n                                    textSource = someObject.title\r\n                                }\r\n                            }\r\n                            \r\n                        }\r\n\r\n                        //this array stores whether source/destination is Navigable/Aggregation so we can display the required icons in the tree\r\n                        //array is ordered source nav, dest nav, source agg, dest agg \r\n                        //if adding more properties, such ass a dotted arrow, just increase array size and adjust the if statements for constructing icon\r\n                        let treeAppearanceSwitches = [false,false,false,false]\r\n                        treeAppearanceSwitches[0] = currentObjects.flatten()[i].getNavigable(0)\r\n                        treeAppearanceSwitches[1] = currentObjects.flatten()[i].getNavigable(1)\r\n                        treeAppearanceSwitches[2] = currentObjects.flatten()[i].getAggregation(0)\r\n                        treeAppearanceSwitches[3] = currentObjects.flatten()[i].getAggregation(1)\r\n                        \r\n                        //unicode icon of the arrow properties/relations we want to display\r\n                        let arrowIcon = \"\";\r\n\r\n                        if(treeAppearanceSwitches[2] === true){\r\n                            arrowIcon = \"&#9670\"\r\n                            }\r\n                        else if(treeAppearanceSwitches[0] === true){\r\n                            arrowIcon = \"&#10229\"\r\n                        }\r\n\r\n                        arrowIcon += \"&#8213\"\r\n\r\n                        if(treeAppearanceSwitches[3] === true){\r\n                            arrowIcon += \"&#9670\"\r\n                            }\r\n                        else if(treeAppearanceSwitches[1] === true){\r\n                            arrowIcon += \"&#10230\"\r\n                        }\r\n\r\n                        finalString = textSource + \" \" + arrowIcon + \" \" + textDest\r\n\r\n                        let tempTreeObj = {\r\n                            text: finalString,\r\n                            children: [],\r\n                            data: currentObjects.flatten()[i],\r\n                            renderkey: currentObjects.flatten()[i].getRenderKey(),\r\n                            modelkey: currentObjects.flatten()[i].getModelKey(),\r\n                            state: {opened: false}\r\n                        };\r\n\r\n                        ArrowChildren.push(tempTreeObj);\r\n                    \r\n                    \r\n                }\r\n\r\n            }\r\n\r\n            //console.log(ArrowChildren.length)\r\n\r\n            if(ArrowChildren.length === 0){\r\n                return;\r\n            }\r\n            else{\r\n            return {\r\n                text: \"Relations \",\r\n                children: ArrowChildren,\r\n                data: null,\r\n                state: { opened: true },\r\n                type: \"Arrow Folder\"\r\n            }\r\n        }\r\n            \r\n        }\r\n    \r\n\r\n        //No longer necessary due to the rework of assigning model children - Lachlan\r\n            /*\r\n            let arrowsObject = { //create the arrows folder as an object to push to the arrows array - Lachlan\r\n                text: \"Arrows\",\r\n                children: ArrowChildren,\r\n                data: null,\r\n                state: { opened: true },\r\n                type: \"Arrow Folder\"\r\n            }\r\n\r\n            arrows.push(arrowsObject)\r\n            //vertices folder\r\n            return arrows\r\n        }\r\n            */\r\n            \r\n        \r\n        //This down here is for vertex heirarchy stuff, not really needed anymore.\r\n        /*\r\n        if (!traversed) {\r\n            traversedVertices.add(this);\r\n            \r\n            for (let child of this.children) {\r\n                //children.push(child.toTreeViewElement(traversedVertices));\r\n            }\r\n            \r\n        }\r\n\r\n        let text = this.vertex.title;\r\n\r\n        if (text === null || text === \"\") {\r\n            text = \"Unnamed Vertex\";\r\n        }\r\n\r\n        return {\r\n            text: text,\r\n            children: children,\r\n            data: this.vertex,\r\n            state: { opened: true }\r\n        };\r\n        */\r\n    }\r\n    \r\n    setTreeViewElement(folderTitle){ //For when you want to make a folder type of element\r\n        let fakeChildren = [];\r\n        return{\r\n            text: folderTitle,\r\n            children: fakeChildren,\r\n            state: {opened: true}\r\n        };\r\n    }\r\n\r\n    //this function sets the path of a particular vertex node so that you can \r\n    //1. Display that item's path in the actual vertex (if you want)\r\n    //2. Show a tree view that only contains the path to a desired vertex \r\n    setVertexTreePath(treePath){\r\n        this.vertexObjectPath = this.cleanObjectPath + \"/\" + treePath;\r\n    }\r\n\r\n    //Return the vertice's object path\r\n    returnVertexTreePath(){\r\n        return this.vertexObjectPath;\r\n    }\r\n\r\n}\r\n\r\nclass ArrowEdge {\r\n    constructor(flattenedVertexNodes, arrow) {\r\n        this.arrow = arrow;\r\n        this.updateVertices(flattenedVertexNodes);\r\n    }\r\n\r\n    updateVertices(flattenedVertexNodes) {\r\n        this.sourceVertexNodeObject = null;\r\n        this.destVertexNodeObject = null;\r\n\r\n        if (this.arrow !== null) {\r\n            let isSourceFound = this.arrow.sourceVertexUUID === null;\r\n            let isDestFound = this.arrow.destVertexUUID === null;\r\n\r\n            for (let vertexNode of flattenedVertexNodes) {\r\n                if (isSourceFound && isDestFound) {\r\n                    break;\r\n                }\r\n\r\n                if (vertexNode !== null) {\r\n                    if (vertexNode.vertex.semanticIdentity.UUID === this.arrow.sourceVertexUUID) {\r\n                        this.sourceVertexNodeObject = vertexNode;\r\n                        isSourceFound = true;\r\n\r\n                    } else if (vertexNode.vertex.semanticIdentity.UUID === this.arrow.destVertexUUID) {\r\n                        this.destVertexNodeObject = vertexNode;\r\n                        isDestFound = true;\r\n                    }\r\n                }\r\n            }\r\n        \r\n        }\r\n    }\r\n\r\n    set sourceVertexNode(vertexNode) {\r\n        this.sourceVertexNodeObject = vertexNode;\r\n\r\n        if (vertexNode !== null) {\r\n            this.arrow.sourceVertexUUID = vertexNode.vertex.semanticIdentity.UUID;\r\n        } else {\r\n            this.arrow.sourceVertexUUID = null;\r\n        }\r\n    }\r\n\r\n    get sourceVertexNode() {\r\n        return this.sourceVertexNodeObject;\r\n    }\r\n\r\n    get sourceVertex() {\r\n        if (this.sourceVertexNodeObject !== null) {\r\n            return this.sourceVertexNodeObject.vertex;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    set destVertexNode(vertexNode) {\r\n        this.destVertexNodeObject = vertexNode;\r\n\r\n        if (vertexNode !== null) {\r\n            this.arrow.destVertexUUID = vertexNode.vertex.semanticIdentity.UUID;\r\n        } else {\r\n            this.arrow.destVertexUUID = null;\r\n        }\r\n    }\r\n\r\n    get destVertexNode() {\r\n        return this.destVertexNodeObject;\r\n    }\r\n\r\n    get destVertex() {\r\n        if (this.destVertexNodeObject !== null) {\r\n            return this.destVertexNodeObject.vertex;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\n//Supply with an array/set of Vertex objects or Arrow objects (NOT ArrowEdge objects)\r\nexport class Graph {\r\n    constructor(vertexArrayFlattened, arrowArrayFlattened) {\r\n        this.rootVertices = new Set();\r\n        if (vertexArrayFlattened !== undefined) {\r\n            this.add(vertexArrayFlattened);\r\n        }\r\n\r\n        this.arrows = new Set();\r\n        if (arrowArrayFlattened !== undefined) {\r\n            this.add(arrowArrayFlattened);\r\n        }\r\n    }\r\n\r\n    add(objects) {\r\n        if (!Array.isArray(objects)) {\r\n            objects = [objects];\r\n        }\r\n\r\n        for (let object of objects) {\r\n            switch (object.typeName) {\r\n                case \"Vertex\":\r\n                    //console.log(\"add vert trigs\")\r\n                    this.addVertex(object);               \r\n                    break;\r\n                case \"Arrow\":\r\n                    this.addArrow(object);\r\n                    break;\r\n                case \"VertexNode\":\r\n                    this.rootVertices.add(object);\r\n                    break;\r\n                case \"ArrowEdge\":\r\n                    this.arrows.add(object);\r\n                    break;\r\n                default:\r\n                    //console.error(\"Attempted to add object to unknown type %s to Graph\", object.typeName)\r\n                    //console.log(object)\r\n                    //console.log(object.constructor)\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    addVertex(vertex) {\r\n        if (this.getVertexNode(vertex) === null) { // if its the original vertex\r\n            vertex.originalUUID = vertex.semanticIdentity.UUID; \r\n            vertex = new VertexNode(vertex);\r\n            this.rootVertices.add(vertex);\r\n        } else { // else its a copy of the original\r\n            //console.log(\"a copy vertex was attempted\")\r\n            \r\n            let newTitle = \" :: \" + vertex.title\r\n            vertex.title = newTitle\r\n            vertex.originalVertex = false;\r\n            /* For now im going to give the copies their own unique semantic UUID, as a lot of stuff in the program hinges off of vertex items\r\n            having their own unique sID. as a work around i've created a value in the vertex object to store the sID of the original vertex so that\r\n            any functions that require the original UUID of the original vertex can still be used. - cooper*/\r\n            vertex.originalUUID = vertex.semanticIdentity.UUID; \r\n            let sID = new SemanticIdentity(vertex.title,\"\",\"\",\"\", undefined ,[]) \r\n            vertex.semanticIdentity = sID;\r\n            vertex = new VertexNode(vertex);\r\n\r\n           \r\n            this.rootVertices.add(vertex);\r\n            console.log(vertex)\r\n        }\r\n    }\r\n\r\n    //NOTE: Graph direction is inverted, flowing from the dest to source of arrows\r\n    //This is intentional behaviour of the modelling spec\r\n    addArrow(arrow) {\r\n        if (this.getArrowEdge(arrow) === null) {\r\n            arrow = new ArrowEdge(this.flattenVertexNodes(), arrow);\r\n            this.arrows.add(arrow);\r\n\r\n            if (arrow.destVertexNode !== null && arrow.sourceVertexNode !== null) {\r\n                arrow.destVertexNode.add(arrow.sourceVertexNode);\r\n\r\n                //If the destination of the arrow is currently a root vertex,\r\n                //search for if the destination has any other possible roots,\r\n                //and remove from the root ONLY IF another root is found\r\n                //This retains an entry point for the graph even if there is a cycle back to root\r\n                if (this.rootVertices.has(arrow.sourceVertexNode)) {\r\n                    let isAnotherRoot = false;\r\n\r\n                    for (let vertexNode of this.rootVertices) {\r\n                        if (vertexNode.vertex.semanticIdentity.UUID === arrow.sourceVertex.semanticIdentity.UUID) {\r\n                            continue;\r\n                        }\r\n\r\n                        if (vertexNode.has(new Set(), arrow.sourceVertexNode)) {\r\n                            isAnotherRoot = true;\r\n                        }\r\n                    }\r\n\r\n                    if (isAnotherRoot) {\r\n                        this.rootVertices.delete(arrow.sourceVertexNode);\r\n                    }\r\n                }\r\n            }\r\n\r\n        } else {\r\n            console.error(\"Attempted to add duplicate arrow\");\r\n        }\r\n    }\r\n\r\n    //A way of returning the arrow UUID's associated with the deleted vertex. For some reason the source and ending\r\n    //UUID data isn't being saved properly upstream, so this is a way around that.\r\n    ArrowUUIDSource(object){\r\n        object = this.getVertexNode(object);\r\n        //first index is source, second is destination\r\n        let returnArray = [];\r\n\r\n        //Match an arrow\r\n        let i = 0;\r\n        for (let arrow of this.arrows) {\r\n            if (arrow.sourceVertexNode !== null && arrow.sourceVertex.semanticIdentity.UUID === object.vertex.semanticIdentity.UUID) {\r\n                returnArray[i] = arrow;\r\n                i += 1;\r\n            }\r\n        }\r\n\r\n        return returnArray;\r\n    }\r\n\r\n    ArrowUUIDDest(object){\r\n        object = this.getVertexNode(object);\r\n        //first index is source, second is destination\r\n        let returnArray = [];\r\n\r\n        //Match an arrow\r\n        let i = 0;\r\n        for (let arrow of this.arrows) {\r\n            if (arrow.destVertexNode !== null && arrow.destVertex.semanticIdentity.UUID === object.vertex.semanticIdentity.UUID) {\r\n                returnArray[i] = arrow;\r\n                i += 1;\r\n            }\r\n        }\r\n\r\n        return returnArray;\r\n    }\r\n\r\n    //Removes and object while shifting it's children's position in the tree\r\n    remove(object) {\r\n        console.log(\"remove 2 is called\")\r\n        //By this point rootVertices doesnt actually contain the vertex we want to delete which makes the isRemoved Logic hard to follow as has returns true when the item is present- Lachlan\r\n        console.log(this.rootVertices)\r\n        if (object.typeName === \"Vertex\") {\r\n            let newobject = this.getVertexNode(object);\r\n            let isRemoved = this.rootVertices.has(newobject);\r\n            console.log(isRemoved)\r\n\r\n\r\n            //Remove from the root\r\n            this.rootVertices.delete(newobject);\r\n            for (let child of newobject.children) {\r\n                this.rootVertices.add(child);\r\n            }\r\n            //console.log(\"It removes from the root fine\")\r\n\r\n            \r\n            //Remove from anywhere deeper in the tree\r\n            let traversedVertices = new Set();\r\n            for (let vertexNode of this.rootVertices) {\r\n                if (!traversedVertices.has(vertexNode)) {\r\n                    traversedVertices.add(vertexNode);\r\n                    vertexNode.remove(traversedVertices, newobject);\r\n                    console.log(isRemoved)\r\n                }\r\n            }\r\n            \r\n            if (isRemoved) {\r\n                //Remove the vertex from being the source or dest of any arrow\r\n                for (let arrow of this.arrows) {\r\n                    if (arrow.sourceVertexNode !== null && arrow.sourceVertex.semanticIdentity.UUID === newobject.vertex.semanticIdentity.UUID) {\r\n                        arrow.sourceVertexNode = null;\r\n                    }\r\n                    \r\n                    if (arrow.destVertexNode !== null && arrow.destVertex.semanticIdentity.UUID === newobject.vertex.semanticIdentity.UUID) {\r\n                        arrow.destVertexNode = null;\r\n                    }\r\n                }\r\n            }\r\n            \r\n\r\n            return isRemoved;\r\n\r\n        } else if (object.typeName === \"Arrow\") {\r\n            let newobject = this.getArrowEdge(object);\r\n\r\n            if (newobject !== null) {\r\n                this.arrows.delete(newobject);\r\n                //IF arrow has a sourceVertex AND destVertex\r\n                if (newobject.sourceVertexNode !== null && newobject.destVertexNode !== null) {\r\n                    //IF there is no other arrow from sourceVertex to destVertex, remove the sourceVertex from the children of destVertex\r\n                    //AND move the sourceVertex to root, if there is no other arrow with the same sourceVertex\r\n                    let isEquivalentArrow = false;\r\n                    let isArrowWithSameSource = false;\r\n                    \r\n                    for (let arrow of this.arrows) {\r\n                        let isEquivalentSource = arrow.sourceVertexNode !== null && arrow.sourceVertex.semanticIdentity.UUID === newobject.sourceVertex.semanticIdentity.UUID;\r\n                        let isEquivalentDest = arrow.destVertexNode !== null && arrow.destVertex.semanticIdentity.UUID === newobject.destVertex.semanticIdentity.UUID;\r\n                        \r\n                        if (isEquivalentSource && isEquivalentDest) {\r\n                            isEquivalentArrow = true;\r\n                        }\r\n                        if (isEquivalentSource && arrow.destVertexNode !== null) {\r\n                            isArrowWithSameSource = true;\r\n                        }\r\n                    }\r\n                    \r\n                    if (!isEquivalentArrow) {\r\n                        newobject.destVertexNode.removeFromChildren(newobject.sourceVertexNode);\r\n                    }\r\n                    if (!isArrowWithSameSource) {\r\n                        this.add(newobject.sourceVertexNode);\r\n                    }\r\n\r\n                    //Remove vertex from the root if removing this arrow has resolved a cycle\r\n                    if (newobject.sourceVertexNode.has(new Set(), newobject.destVertexNode)) {\r\n                        this.rootVertices.delete(newobject.destVertexNode);\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n        } else {\r\n            if (object !== null) {\r\n                console.error(\"Attempted to remove object of invalid type %s to Graph\", object.typeName);\r\n            } else {\r\n                console.error(\"Attempted to remove null from Graph\");\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    has(object) {\r\n        //Search for object in root vertices\r\n        if (this.rootVertices.has(object)) {\r\n            return true;\r\n\r\n        } else {\r\n            let traversedVertices = new Set();\r\n\r\n            //Search for object in children of root vertices\r\n            for (let vertex of this.rootVertices) {\r\n                if (!traversedVertices.has(vertex)) {\r\n                    traversedVertices.add(vertex);\r\n                    if (vertex.has(traversedVertices, object)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    getVertexNode(vertex) {\r\n        let traversedVertices = new Set();\r\n\r\n        for (let rootNode of this.rootVertices) {\r\n            if (!traversedVertices.has(rootNode)) {\r\n                traversedVertices.add(rootNode);\r\n                if (rootNode.vertex.semanticIdentity.UUID === vertex.semanticIdentity.UUID) {\r\n                    return rootNode;\r\n                } else {\r\n                    let node = rootNode.getVertexNode(traversedVertices, vertex);\r\n                    if (node !== null) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getArrowEdge(arrow) {\r\n        for (let arrowEdge of this.arrows) {\r\n            if (arrowEdge.arrow.semanticIdentity.UUID === arrow.semanticIdentity.UUID) {\r\n                return arrowEdge;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    flatten(doFlattenVertices = true, doFlattenArrows = true) {\r\n        let verticesSet = new Set();\r\n        let arrowsSet = new Set();\r\n\r\n        let traversedVertices = new Set();\r\n\r\n        if (doFlattenVertices) {\r\n            for (let vertexNode of this.rootVertices) {\r\n                if (!traversedVertices.has(vertexNode)) {\r\n                    traversedVertices.add(vertexNode);\r\n                    verticesSet.add(vertexNode.vertex);\r\n    \r\n                    if (vertexNode !== null) {\r\n                        for (let child of vertexNode.flatten(traversedVertices)) {\r\n                            verticesSet.add(child);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        if (doFlattenArrows) {\r\n            for (let arrowEdge of this.arrows) {\r\n                arrowsSet.add(arrowEdge.arrow);\r\n            }\r\n        }\r\n\r\n        let flattenedArray = Array.from(verticesSet);\r\n        return flattenedArray.concat(Array.from(arrowsSet));\r\n    }\r\n\r\n    flattenVertexNodes() {\r\n        var verticesSet = new Set();\r\n        let traversedVertices = new Set();\r\n\r\n        for (let vertexNode of this.rootVertices) {\r\n            if (!traversedVertices.has(vertexNode)) {\r\n                traversedVertices.add(vertexNode);\r\n                verticesSet.add(vertexNode);\r\n\r\n                if (vertexNode !== null) {\r\n                    for (let child of vertexNode.flattenVertexNodes(traversedVertices)) {\r\n                        verticesSet.add(child);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return Array.from(verticesSet);\r\n    }\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\n //EDGE ENDS\r\nexport const EdgeEnd = {\r\n    NONE: \"None\",\r\n    ARROW: \"Arrow\",\r\n    TRIANGLE: \"Triangle\",\r\n    FILLED_TRIANGLE: \"Filled Triangle\",\r\n    DIAMOND: \"Diamond\",\r\n    FILLED_DIAMOND: \"Filled Diamond\"\r\n};\r\n\r\nexport const EdgeEndToString = {};\r\nEdgeEndToString[EdgeEnd.NONE] = \"None\";\r\nEdgeEndToString[EdgeEnd.ARROW] = \"Arrow\";\r\nEdgeEndToString[EdgeEnd.TRIANGLE] = \"Triangle\";\r\nEdgeEndToString[EdgeEnd.FILLED_TRIANGLE] = \"FilledTriangle\";\r\nEdgeEndToString[EdgeEnd.DIAMOND] = \"Diamond\";\r\nEdgeEndToString[EdgeEnd.FILLED_DIAMOND] = \"FilledDiamond\";\r\n\r\nexport const StringToEdgeEnd = {};\r\nStringToEdgeEnd[\"None\"] = EdgeEnd.NONE;\r\nStringToEdgeEnd[\"Arrow\"] = EdgeEnd.ARROW;\r\nStringToEdgeEnd[\"Triangle\"] = EdgeEnd.TRIANGLE;\r\nStringToEdgeEnd[\"FilledTriangle\"] = EdgeEnd.FILLED_TRIANGLE;\r\nStringToEdgeEnd[\"Diamond\"] = EdgeEnd.DIAMOND;\r\nStringToEdgeEnd[\"FilledDiamond\"] = EdgeEnd.FILLED_DIAMOND;\r\n\r\n//LINE COLOURS\r\nexport const LineColour = {\r\n    BLACK: \"#000000\",\r\n    RED: \"#FF0000\",\r\n    BLUE: \"#0000FF\",\r\n    GREEN: \"#00FF00\"\r\n};\r\n\r\nexport const LineColourToStringName = {};\r\nLineColourToStringName[LineColour.BLACK] = \"Black\";\r\nLineColourToStringName[LineColour.RED] = \"Red\";\r\nLineColourToStringName[LineColour.BLUE] = \"Blue\";\r\nLineColourToStringName[LineColour.GREEN] = \"Green\";\r\n\r\nexport const StringNameToLineColour = {};\r\nStringNameToLineColour[\"Black\"] = LineColour.BLACK;\r\nStringNameToLineColour[\"Red\"] = LineColour.RED;\r\nStringNameToLineColour[\"Blue\"] = LineColour.BLUE;\r\nStringNameToLineColour[\"Green\"] = LineColour.GREEN;\r\n\r\n//LINE TYPES\r\nexport const LineType = {\r\n    SOLID: 1,\r\n    DASHED: 2\r\n};\r\n\r\nexport const LineTypeToString = {};\r\nLineTypeToString[LineType.SOLID] = \"Solid\";\r\nLineTypeToString[LineType.DASHED] = \"Dashed\";\r\n\r\nexport const StringToLineType = {};\r\nStringToLineType[\"Solid\"] = LineType.SOLID;\r\nStringToLineType[\"Dashed\"] = LineType.DASHED;","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport { SemanticIdentity } from \"./SemanticIdentity\";\r\n\r\nexport class Cardinality {\r\n    constructor(lowerBound, upperBound, attachedToUUID, isVisible = false, semanticIdentity) {\r\n        this.typeName = \"Cardinality\";\r\n        \r\n        this.numLowerBound = lowerBound;\r\n        this.numUpperBound = upperBound;\r\n        this.attachedToUUID = attachedToUUID;\r\n        this.isVisible = isVisible;\r\n\r\n        if (semanticIdentity !== undefined){\r\n            this.semanticIdentity = semanticIdentity;\r\n        } else {\r\n            this.semanticIdentity = new SemanticIdentity(this.toString(), this.getDescription())\r\n        }\r\n    }\r\n\r\n    set lowerBound(value){\r\n        this.numLowerBound = value;\r\n        this.semanticIdentity.name = this.toString();\r\n    }\r\n\r\n    get lowerBound(){\r\n        return this.numLowerBound;\r\n    }\r\n\r\n    set upperBound(value){\r\n        this.numUpperBound = value;\r\n        this.semanticIdentity.name = this.toString();\r\n    }\r\n\r\n    get upperBound(){\r\n        return this.numUpperBound;\r\n    }\r\n\r\n    toggleVisibility() {\r\n        this.isVisible = !this.isVisible;\r\n    }\r\n\r\n    toString() {\r\n        var lower;\r\n        var upper;\r\n\r\n        if (this.lowerBound === '-1') {\r\n            lower = 'n'\r\n        } else {\r\n            lower = this.lowerBound;\r\n        }\r\n\r\n        if (this.upperBound === '-1') {\r\n            upper = 'n'\r\n        } else {\r\n            upper = this.upperBound;\r\n        }\r\n\r\n        if (lower === upper) {\r\n            return lower;\r\n        } else {\r\n            return lower + \" .. \" + upper\r\n        }\r\n    }\r\n\r\n    getDescription(){\r\n        return `Cardinality of Edge End ${this.attachedToUUID}`;\r\n    }\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport { SemanticIdentity } from \"./SemanticIdentity\";\r\nimport { Cardinality } from \"./Cardinality\";\r\nimport * as ArrowProps from \"./ArrowProperties\";\r\nimport { getCurrentModel, getCurrentRenderKey } from \"../UIElements/CanvasDraw\";\r\n\r\n\r\n// Object that contains all the parts of an arrow ending including:\r\n// Head type\r\n// Cardinality\r\n// Label\r\n//\r\n// Used in the Arrow class\r\nexport class EdgeEnd {\r\n    constructor(attachedToUUID, headType = ArrowProps.EdgeEnd.NONE, cardinality, label = \"\", semanticIdentity) {\r\n        this.attachedToUUID = attachedToUUID;\r\n        this.typeName = \"EdgeEnd\";\r\n\r\n        if (semanticIdentity !== undefined){\r\n            this.semanticIdentity = semanticIdentity;\r\n        } else {\r\n            this.semanticIdentity = new SemanticIdentity(this.toString(), this.getDescription())\r\n        }\r\n        \r\n        this.headType = headType;\r\n        \r\n        if (cardinality !== undefined){\r\n            this.cardinality = cardinality;\r\n        } else {\r\n            this.cardinality = new Cardinality(1, 1, this.semanticIdentity.UUID);\r\n        }\r\n\r\n        this.label = label;\r\n\r\n        // For deciding where it goes in the graph\r\n        this.edgeEndRenderKey = getCurrentRenderKey();\r\n\r\n        // For rendering the object\r\n        this.edgeEndModelKey = getCurrentModel();\r\n    }\r\n\r\n    // Set the model key\r\n    setModelKey(key){\r\n        this.edgeEndModelKey = key;\r\n    }\r\n\r\n    // Return the model key\r\n    getModelKey(){\r\n        return this.edgeEndModelKey;\r\n    }\r\n\r\n    // Set the render key. Done in ContainmentTree.js\r\n    setRenderKey(key){\r\n        this.edgeEndRenderKey = key;\r\n    }\r\n\r\n    // Return the render key. Done in CanvasDraw.js\r\n    getRenderKey(key){\r\n        return this.edgeEndRenderKey;\r\n    }\r\n\r\n    set type(newType){\r\n        this.headType = newType;\r\n        this.semanticIdentity.name = this.toString();\r\n    }\r\n\r\n    get type(){\r\n        return this.headType;\r\n    }\r\n\r\n    toString(){\r\n        return `${this.type} type Edge End`;\r\n    }\r\n\r\n    getDescription(){\r\n        return `Edge end of ${this.attachedToUUID}`;\r\n    }\r\n\r\n    updateCardinality(lowerBound, upperBound, visibility){\r\n        this.cardinality.lowerBound = lowerBound;\r\n        this.cardinality.upperBound = upperBound;\r\n        this.cardinality.visibility = visibility;\r\n    }\r\n\r\n    drawLines(canvasContext, points, strokeColour, fillColour) {\r\n        canvasContext.strokeStyle = strokeColour;\r\n        if (fillColour !== undefined) {\r\n            canvasContext.fillStyle = fillColour;\r\n        }\r\n\r\n        canvasContext.beginPath();\r\n        canvasContext.moveTo(points[0].X, points[0].Y);\r\n        for (let i = 1; i < points.length; i++) {\r\n            canvasContext.lineTo(points[i].X, points[i].Y)\r\n        }\r\n        \r\n        if (fillColour !== undefined) {\r\n            canvasContext.closePath();\r\n            canvasContext.fill();\r\n        }\r\n        canvasContext.stroke();\r\n\r\n        canvasContext.fillStyle = \"#000\"\r\n        canvasContext.strokeStyle = \"#000\";\r\n    }\r\n\r\n    drawArrowEnd(canvasContext, x, y, angle, lineColour) {\r\n        //Constants\r\n        const strokeLength = 7;\r\n        const angleFromLine = Math.PI/6;\r\n        const angleInverted = angle + Math.PI;\r\n\r\n        //Generate points for the arrowhead\r\n        var arrowPoints = [];\r\n        arrowPoints.push({\r\n            X: x + strokeLength * Math.cos(angleInverted - angleFromLine),\r\n            Y: y + strokeLength * Math.sin(angleInverted - angleFromLine)\r\n        });\r\n        arrowPoints.push({\r\n            X: x,\r\n            Y: y\r\n        });\r\n        arrowPoints.push({\r\n            X: x + strokeLength * Math.cos(angleInverted + angleFromLine),\r\n            Y: y + strokeLength * Math.sin(angleInverted + angleFromLine)\r\n        });\r\n\r\n        //Arrowhead drawing\r\n        this.drawLines(canvasContext, arrowPoints, lineColour)\r\n    }\r\n\r\n    drawTriangleEnd(canvasContext, x, y, angle, lineColour, fillColour = \"#FFF\") {\r\n        //Constants\r\n        const sideLength = 7;\r\n        const deg30 = Math.PI / 6;\r\n        const angleInverted = angle + Math.PI;\r\n\r\n        //Generate points for the triangle\r\n        var trianglePoints = [];\r\n        trianglePoints.push({\r\n            X: x,\r\n            Y: y\r\n        });\r\n        trianglePoints.push({\r\n            X: x + sideLength * Math.cos(angleInverted - deg30),\r\n            Y: y + sideLength * Math.sin(angleInverted - deg30)\r\n        });\r\n        trianglePoints.push({\r\n            X: x + sideLength * Math.cos(angleInverted + deg30),\r\n            Y: y + sideLength * Math.sin(angleInverted + deg30)\r\n        });\r\n        trianglePoints.push({\r\n            X: x,\r\n            Y: y\r\n        });\r\n\r\n        //Triangle drawing\r\n        this.drawLines(canvasContext, trianglePoints, lineColour, fillColour);\r\n    }\r\n\r\n    drawDiamondEnd(canvasContext, x, y, angle, lineColour, fillColour = \"#FFF\") {\r\n        //Constants\r\n        const sideLength = 7;\r\n        const deg20 = Math.PI / 9;\r\n        const angleInverted = angle + Math.PI;\r\n\r\n        //Generate points for the diamond\r\n        var diamondPoints = [];\r\n        diamondPoints.push({\r\n            X: x,\r\n            Y: y\r\n        });\r\n        diamondPoints.push({\r\n            X: x + sideLength * Math.cos(angleInverted - deg20),\r\n            Y: y + sideLength * Math.sin(angleInverted - deg20)\r\n        });\r\n        diamondPoints.push({\r\n            X: x + sideLength * 2 * Math.cos(angleInverted),\r\n            Y: y + sideLength * 2 * Math.sin(angleInverted)\r\n        });\r\n        diamondPoints.push({\r\n            X: x + sideLength * Math.cos(angleInverted + deg20),\r\n            Y: y + sideLength * Math.sin(angleInverted + deg20)\r\n        });\r\n        diamondPoints.push({\r\n            X: x,\r\n            Y: y\r\n        });\r\n\r\n        //Diamond drawing\r\n        this.drawLines(canvasContext, diamondPoints, lineColour, fillColour);\r\n    }\r\n\r\n    draw(canvasContext, x, y, angle, lineColour){\r\n        switch (this.type) {\r\n            case ArrowProps.EdgeEnd.NONE:\r\n                break;\r\n            case ArrowProps.EdgeEnd.ARROW:\r\n                this.drawArrowEnd(canvasContext, x, y, angle, lineColour);\r\n                break;\r\n            case ArrowProps.EdgeEnd.TRIANGLE:\r\n                this.drawTriangleEnd(canvasContext, x, y, angle, lineColour);\r\n                break;\r\n            case ArrowProps.EdgeEnd.FILLED_TRIANGLE:\r\n                this.drawTriangleEnd(canvasContext, x, y, angle, lineColour, lineColour);\r\n                break;\r\n            case ArrowProps.EdgeEnd.DIAMOND:\r\n                this.drawDiamondEnd(canvasContext, x, y, angle, lineColour);\r\n                break;\r\n            case ArrowProps.EdgeEnd.FILLED_DIAMOND:\r\n                this.drawDiamondEnd(canvasContext, x, y, angle, lineColour, lineColour);\r\n                break;\r\n            default:\r\n                console.log(\"EdgeEnd had unexpected type: %s\", this.type);\r\n        }\r\n    }\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport React from 'react';\r\nimport * as canvasDraw from \"./CanvasDraw\";\r\nimport {LineColourToStringName,} from \"../DataStructures/ArrowProperties\"\r\nimport { ContainmentTree,} from \"./ContainmentTree\";\r\nimport {serverURL} from \".//MainView\"\r\n\r\nimport { SketchPicker } from 'react-color';\r\n\r\n// Icons\r\nimport iconVertex from \"../Resources/vertex.svg\";\r\nimport iconEdge from \"../Resources/edge.svg\";\r\nimport iconSelect from \"../Resources/select.svg\"\r\n\r\n\r\n\r\nimport {deleteElement} from \"./CanvasDraw\";\r\nimport { vertexDeleteElement } from './CanvasDraw';\r\nimport DropdownButton from \"react-bootstrap/DropdownButton\";\r\n\r\n\r\n//Property Enums\r\nexport const LeftMenuType = {\r\n    TreeView: \"TreeView\",\r\n    Vertex: \"Vertex\",\r\n    Arrow: \"Arrow\",\r\n\r\n    //FTreeView: \"FocussedTreeView\"\r\n\r\n    Artifact: \"Artifact\",\r\n    Container:\"Container\"\r\n\r\n};\r\n\r\nexport const LeftMenuTypeToString = {};\r\nLeftMenuTypeToString[LeftMenuType.TreeView] = \"TreeView\";\r\nLeftMenuTypeToString[LeftMenuType.Vertex] = \"Vertex\";\r\nLeftMenuTypeToString[LeftMenuType.Arrow] = \"Arrow\";\r\nLeftMenuTypeToString[LeftMenuType.Arrow] = \"Artifact\";\r\nLeftMenuTypeToString[LeftMenuType.Arrow] = \"Container\";\r\n\r\nexport const StringToLeftMenuType = {};\r\nLeftMenuTypeToString[\"TreeView\"] = LeftMenuType.TreeView;\r\nLeftMenuTypeToString[\"Vertex\"] = LeftMenuType.Vertex;\r\nLeftMenuTypeToString[\"Arrow\"] = LeftMenuType.Arrow;\r\nLeftMenuTypeToString[\"Artifact\"] = LeftMenuType.Artifact;\r\nLeftMenuTypeToString[\"Container\"] = LeftMenuType.Container;\r\n\r\nexport const Tool = {\r\n    Select: \"Select\",\r\n    Vertex: \"Vertex\",\r\n    Visibility: \"Visibility\",\r\n    Edge: \"Edge\",\r\n    Specialisation: \"Specialisation\",\r\n    Artifact: \"Artifact\",\r\n    Container: \"Container\",\r\n};\r\n\r\n// class to display the left hand menu, where we will be showing\r\n// object editing tools for now\r\nexport class LeftMenu extends React.Component{\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            menu: LeftMenuType.TreeView,\r\n            selectedObject: null,\r\n            fileNames: [],\r\n            title: \"\",\r\n            content: [],\r\n\r\n        };\r\n        this.setTitle = this.setTitle.bind(this);\r\n        this.setContent = this.setContent.bind(this);\r\n        this.handleChange = this.handleChange.bind(this);\r\n\r\n        this.formRef = null;\r\n\r\n        this.setFormRef = element =>{\r\n            this.formRef = element;\r\n        };\r\n\r\n        this.setIcons();\r\n\r\n    }\r\n    handleChange(event){\r\n        this.setState({title: event.target.value})\r\n        this.setState({title:\"\"})\r\n        this.setTitle();\r\n        this.setContent();\r\n    }\r\n    /*\r\n    leftMenuContents = <form id = \"VertexMenu\">\r\n                <div className=\"LeftHeader\">Vertex Properties</div>\r\n                <label className=\"LeftLabel\">Title</label>\r\n                <input id=\"LeftTitle\" className=\"LeftTitle\" defaultValue={this.state.selectedObject.title} onKeyUp={() => this.setTitle()}/>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n    \r\n                */\r\n               \r\n    /// This is a test function, remove it if I forget to\r\n    testUpdateLabel = () =>{\r\n        this.setPath(\"fffffffff\")\r\n        //document.getElementById(\"VertPath\").value = \"It doth been updated\";\r\n        \r\n        //console.log(\"RIGHT HERE \" + document.getElementById(\"VertPath\").value)\r\n    }\r\n\r\n\r\n\r\n    /// \r\n\r\n    componentDidMount() {\r\n        this.menu = this.props.mainState.menu;\r\n        this.selectedItem = this.props.mainState.drawMode;\r\n        this.props.setMode(this.selectedItem)\r\n\r\n        document.addEventListener(\"keydown\", this.onKeyPressed.bind(this));\r\n        \r\n    }\r\n\r\n\r\n    //For quickKeys\r\n\r\n\r\n    onKeyPressed(e) {\r\n        if (e.keyCode === 46){\r\n            console.log(this.state.selectedObject);\r\n            if(this.state.selectedObject.typeName === \"Vertex\"){\r\n                vertexDeleteElement(this.state.selectedObject);\r\n            }\r\n            else{\r\n                deleteElement(this.state.selectedObject);\r\n            }\r\n            this.setState({menu:\"TreeView\"});\r\n            canvasDraw.drawAll();\r\n        }\r\n\r\n        \r\n    }\r\n    \r\n    static getDerivedStateFromProps(props,state) {\r\n\r\n        return {\r\n            menu: props.mainState.menu,\r\n            selectedObject: props.mainState.selectedObject\r\n\r\n        };\r\n\r\n        //this.setState({menu:nextProps.mainState.menu,selectedObject:nextProps.mainState.selectedObject});\r\n        \r\n        //document.removeEventListener(\"keydown\", this.onKeyPressed.bind(this));\r\n\r\n    }\r\n    \r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n\r\n\r\n        let leftMenu = document.getElementById(\"VertexMenu\");\r\n        if(leftMenu === null){\r\n            leftMenu = document.getElementById(\"ArrowMenu\");\r\n        }\r\n        if(leftMenu !== null){\r\n            leftMenu.addEventListener(\"keypress\", (e) => {\r\n                if(e.key === \"Enter\") {\r\n                    e.preventDefault();\r\n                }\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n    setIcons() {\r\n        fetch(serverURL + '/icons/list',{\r\n            method:'GET',\r\n            headers: {\r\n                'Accept': '*/*',\r\n            },\r\n        })\r\n            .then((res) => {return res.json()})\r\n            .then((data) => {\r\n                let fileNames = [];\r\n                data.icons.forEach((icon) => {\r\n                    fileNames.push(icon)\r\n                });\r\n                this.setState({fileNames:fileNames})\r\n            })\r\n    }\r\n\r\n    //VERTEX SETTERS\r\n\r\n    \r\n    setTitle() {\r\n        let newTitle = document.getElementById(\"LeftTitle\").value;\r\n        this.state.selectedObject.setTitle(newTitle);\r\n        canvasDraw.updateVertex(this.state.selectedObject);\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n\r\n    setContent() {\r\n        let newContent = document.getElementById(\"LeftContent\").value;\r\n        newContent = newContent.split(\"\\n\");\r\n        this.state.selectedObject.setContent(newContent);\r\n        canvasDraw.updateVertex(this.state.selectedObject);\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n    //ARROW SETTERS\r\n    setLineType() {\r\n        let newLineType = document.getElementById(\"LineType\").value;\r\n        this.state.selectedObject.setLineType(newLineType);\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n    setColour() {\r\n        let newColour = document.getElementById(\"LineColour\").value;\r\n        this.state.selectedObject.setLineColour(newColour);\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n    setStartLabel() {\r\n        let newLabel = document.getElementById(\"SourceLabel\").value;\r\n        this.state.selectedObject.setStartLabel(newLabel);\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    setEndLabel() {\r\n        let newLabel = document.getElementById(\"DestLabel\").value;\r\n        this.state.selectedObject.setEndLabel(newLabel);\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    updateCardinality() {\r\n        let sourceLowerBound = document.getElementById(\"sourceFromCardindality\").value;\r\n        let sourceUpperBound = document.getElementById(\"sourceToCardindality\").value;\r\n        let currentSourceVisibility = this.state.selectedObject.getSourceCardinalityVisibility();\r\n        let destLowerBound = document.getElementById(\"destFromCardindality\").value;\r\n        let destUpperBound = document.getElementById(\"destToCardindality\").value;\r\n        let currentDestVisibility = this.state.selectedObject.getDestCardinalityVisibility();\r\n\r\n        this.state.selectedObject.updateSourceCardinality(sourceLowerBound, sourceUpperBound, currentSourceVisibility);\r\n        this.state.selectedObject.updateDestCardinality(destLowerBound, destUpperBound, currentDestVisibility);\r\n\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    toggleSourceCardinalityVisibility() {\r\n        this.state.selectedObject.toggleSourceCardinalityVisibility();\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    toggleDestCardinalityVisibility() {\r\n        this.state.selectedObject.toggleDestCardinalityVisibility();\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    toggleAbstract(){\r\n        this.state.selectedObject.toggleAbstract()\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n    getS23MIconsSelector() {\r\n        let dropdownOptions = [<div className=\"DropdownItem\"><div className=\"dropdownLabel\">Name</div><div className=\"checkBoxContainer\">Text</div><div className=\"checkBoxContainer\">Icon</div></div>];\r\n\r\n        let name = \"\";\r\n        this.state.fileNames.forEach(fileName => {\r\n            if (fileName.slice(-6, -4) === \"_n\") {\r\n                name = fileName.slice(0, -6);\r\n                dropdownOptions.push(<div className=\"DropdownItem\" ref={fileName}> <div className=\"dropdownLabel\">{name}</div> <div className=\"checkBoxContainer\"><input type='checkbox' disabled=\"disabled\" /> </div>  <div className=\"checkBoxContainer\"><input type='checkbox' defaultChecked={this.shouldIconBeSelected(fileName)} onClick={() => {this.setIcon(fileName)}}/></div> </div>)\r\n            } else {\r\n                name = fileName.slice(0, -4);\r\n                dropdownOptions.push(<div className=\"DropdownItem\" ref={fileName}> <div className=\"dropdownLabel\">{name}</div> <div className=\"checkBoxContainer\"><input type='checkbox' defaultChecked={this.shouldTextBeSelected(fileName)} onClick={() => {this.setText(fileName)}} /> </div>  <div className=\"checkBoxContainer\"><input type='checkbox' defaultChecked={this.shouldIconBeSelected(fileName)} onClick={() => {this.setIcon(fileName)}}/></div> </div>)\r\n            }\r\n        });\r\n\r\n        return <DropdownButton title=\"Category Selector\" name=\"Icons\" id=\"IconSelector\" className=\"IconSelector\">\r\n            {dropdownOptions}\r\n        </DropdownButton>;\r\n    }\r\n\r\n    getVertexColour = () => {\r\n        return this.state.selectedObject.getColour()\r\n    };\r\n\r\n    setVertexColour = (colour) =>{\r\n        this.state.selectedObject.setColour(colour.hex);\r\n        canvasDraw.updateVertex(this.state.selectedObject);\r\n        canvasDraw.drawAll()\r\n    };\r\n\r\n    getColourPicker() {\r\n        return <DropdownButton title = \"Colour Selector\" id = \"ColourSelector\">\r\n        <SketchPicker\r\n            color={this.getVertexColour}\r\n            onChangeComplete={this.setVertexColour}\r\n            presetColors = {[\"#FFD5A9\",\"#F5B942\",\"#FFFFFF\"]}\r\n        /></DropdownButton>\r\n    }\r\n\r\n    shouldTextBeSelected(fileName) {\r\n        return this.state.selectedObject.isTextSet(fileName)\r\n    }\r\n\r\n    shouldIconBeSelected(fileName) {\r\n        return this.state.selectedObject.isIconSet(fileName)\r\n    }\r\n\r\n    setText(fileName) {\r\n        this.state.selectedObject.setText(fileName);\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    setIcon(fileName) {\r\n        this.state.selectedObject.setIcon(fileName);\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    setNavigable(side){\r\n\r\n        this.state.selectedObject.toggleNavigable(side);\r\n\r\n        document.getElementById(\"SourceIsNavigable\").checked = this.state.selectedObject.getNavigable(0);\r\n        document.getElementById(\"DestIsNavigable\").checked = this.state.selectedObject.getNavigable(1);\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n    setAggregation(side){\r\n        if(!this.state.selectedObject.getNavigable(side)){\r\n            this.state.selectedObject.toggleNavigable(side);\r\n        }\r\n        this.state.selectedObject.toggleAggregation(side);\r\n        let SourceAggregation = this.state.selectedObject.getAggregation(0);\r\n        let DestAggregation = this.state.selectedObject.getAggregation(1);\r\n        if(SourceAggregation) {\r\n            document.getElementById(\"SourceIsNavigable\").checked = true;\r\n        }\r\n        if(DestAggregation){\r\n            document.getElementById(\"DestIsNavigable\").checked = true;\r\n        }\r\n        document.getElementById(\"SourceIsAggregation\").checked = SourceAggregation;\r\n        document.getElementById(\"DestIsAggregation\").checked = DestAggregation;\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n    deselectElement(){\r\n        this.props.setLeftMenu(null);\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    showTreeView(){\r\n        //this.state.menu = LeftMenuType.TreeView;\r\n        //console.log(\"HENLO: \" + this.state);\r\n        //leftMenuContents = <ContainmentTree setLeftMenu = {this.props.setLeftMenu} />;\r\n        this.state.selectedObject(null)\r\n        canvasDraw.drawAll();\r\n    }\r\n\r\n    stripElement(e){\r\n        e.preventDefault()\r\n        this.state.selectedObject.trimPath();\r\n        canvasDraw.drawAll()\r\n    }\r\n\r\n   \r\n    deleteTitle = () => {\r\n        this.setState({title: \"\"})\r\n    };\r\n   \r\n\r\n// return the correct menu based on the selected item\r\n    getMenu = () =>{\r\n\r\n        \r\n\r\n        let leftMenuContents;\r\n\r\n        let toolbar = <div id = \"Toolbar\" className = \"Toolbar\">\r\n            <div id = \"Select\" className=\"ToolbarItem\" onClick={() => this.props.setMode(Tool.Select)}><img src={iconSelect} alt =\"Select\"/></div>\r\n\r\n            <div id = \"Vertex\" className=\"ToolbarItem\" onClick={() => {this.props.setMode(Tool.Vertex); }} onKeyDown={() => this.onKeyPressed()}    ><img src={iconVertex} alt =\"Vertex\"/></div>\r\n\r\n            <div id = \"Edge\" className=\"ToolbarItem\" onClick={() => this.props.setMode(Tool.Edge)}><img src={iconEdge} alt =\"Edge\"/></div>\r\n\r\n        </div>;\r\n\r\n        if (this.state.menu === LeftMenuType.TreeView) {\r\n            leftMenuContents = <ContainmentTree setLeftMenu = {this.props.setLeftMenu} />\r\n            //console.log(\"A new tree has been created\");\r\n\r\n        } else if (this.state.menu === LeftMenuType.Vertex) {\r\n            canvasDraw.drawAll();\r\n            \r\n            leftMenuContents = <form id = \"VertexMenu\">\r\n                <div className=\"LeftHeader\">Vertex Properties</div>\r\n                <label className=\"LeftLabel\">Title</label>\r\n                <input id=\"LeftTitle\" className=\"LeftTitle\" value={this.state.selectedObject.title} onInput={this.handleChange}/>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Content</label>\r\n                <textarea id=\"LeftContent\" className =\"LeftContent\" value={this.state.selectedObject.getContentAsString()} onInput={this.handleChange}/>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                {this.getS23MIconsSelector()}\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                {this.getColourPicker()}\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Is Abstract?</label>\r\n                <input type=\"checkbox\" id=\"IsAbstract\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getAbstract()} onClick={() => this.toggleAbstract()}/>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <button className=\"LeftMenuButton\" onClick={() => this.deselectElement()}>Deselect</button>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={() => {/*deleteElement(this.state.selectedObject)*/vertexDeleteElement(this.state.selectedObject);this.setState({menu:\"TreeView\"})}} placeholder=\"NoTabIndex\">Remove</button>\r\n\r\n\r\n\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                \r\n    \r\n                <input id=\"VertPath\" className=\"vertexPath\" defaultValue={this.state.selectedObject.vertexPath}/>\r\n                \r\n\r\n\r\n            </form>;\r\n            \r\n        } else if (this.state.menu === LeftMenuType.Artifact) {\r\n            canvasDraw.drawAll();\r\n\r\n            leftMenuContents = <form id=\"VertexMenu\">\r\n                <div className=\"LeftHeader\">Vertex Properties</div>\r\n                <label className=\"LeftLabel\">Title</label>\r\n                <input id=\"LeftTitle\" className=\"LeftTitle\" defaultValue={this.state.selectedObject.title} onKeyUp={() => this.setTitle()} />\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Content</label>\r\n                <textarea id=\"LeftContent\" className=\"LeftContent\" defaultValue={this.state.selectedObject.getContentAsString()} onKeyUp={() => this.setContent()} />\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                {this.getS23MIconsSelector()}\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                {this.getColourPicker()}\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Is Abstract?</label>\r\n                <input type=\"checkbox\" id=\"IsAbstract\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getAbstract()} onClick={() => this.toggleAbstract()} />\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <button className=\"LeftMenuButton\" onClick={() => this.deselectElement()}>Deselect</button>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={() => { deleteElement(this.state.selectedObject); this.setState({ menu: \"TreeView\" }) }} placeholder=\"NoTabIndex\">Remove</button>\r\n            </form>;\r\n\r\n        } else if (this.state.menu === LeftMenuType.Container) {\r\n            canvasDraw.drawAll();\r\n            leftMenuContents = <form id=\"VertexMenu\">\r\n                <div className=\"LeftHeader\">Vertex Properties</div>\r\n                <label className=\"LeftLabel\">Title</label>\r\n                <input id=\"LeftTitle\" className=\"LeftTitle\" defaultValue={this.state.selectedObject.title} onKeyUp={() => this.setTitle()} />\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Content</label>\r\n                <textarea id=\"LeftContent\" className=\"LeftContent\" defaultValue={this.state.selectedObject.getContentAsString()} onKeyUp={() => this.setContent()} />\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                {this.getS23MIconsSelector()}\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Is Abstract?</label>\r\n                <input type=\"checkbox\" id=\"IsAbstract\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getAbstract()} onClick={() => this.toggleAbstract()} />\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <button className=\"LeftMenuButton\" onClick={() => this.deselectElement()}>Deselect</button>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={() => { deleteElement(this.state.selectedObject); this.setState({ menu: \"TreeView\" }) }} placeholder=\"NoTabIndex\">Remove</button>\r\n            </form>;\r\n\r\n        }else if (this.state.menu === LeftMenuType.Arrow) {\r\n            console.log(\"Arrow Selected\");\r\n            console.log(this.state.selectedObject)\r\n\r\n            if(this.state.selectedObject.edgeType === Tool.Edge){\r\n\r\n            leftMenuContents = <form id = \"ArrowMenu\">\r\n                <div className=\"LeftHeader\">Edge Properties</div>\r\n\r\n                <label className=\"LeftLabel\">Source Is Navigable?</label>\r\n                <input type=\"checkbox\" id=\"SourceIsNavigable\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getNavigable(0)} onClick={() => this.setNavigable(0)}/>\r\n\r\n                <label className=\"LeftLabel\">Destination Is Navigable?</label>\r\n                <input type=\"checkbox\" id=\"DestIsNavigable\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getNavigable(1)} onClick={() => this.setNavigable(1)}/>\r\n\r\n                <label className=\"LeftLabel\">Source Is Aggregation?</label>\r\n                <input type=\"checkbox\" id=\"SourceIsAggregation\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getAggregation(0)} onClick={() => this.setAggregation(0)}/>\r\n\r\n                <label className=\"LeftLabel\">Destination Is Aggregation?</label>\r\n                <input type=\"checkbox\" id=\"DestIsAggregation\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getAggregation(1)} onClick={() => this.setAggregation(1)}/>\r\n\r\n                <label className=\"LeftLabel\">Line Colour</label>\r\n                <select name=\"LineColour\" id=\"LineColour\" className=\"LeftSelector\" defaultValue={LineColourToStringName[this.state.selectedObject.lineColour]} onChange={() => this.setColour()}>\r\n                    <option value = \"Black\">Black</option>\r\n                    <option value = \"Red\">Red</option>\r\n                    <option value = \"Blue\">Blue</option>\r\n                    <option value = \"Green\">Green</option>\r\n                </select>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                {/* -1 represents n or *  */}\r\n                <label className=\"LeftLabel\">Source Cardinality</label>\r\n                <div className=\"CardinalityArea\"> <div className=\"LeftCheckboxLabel\"> Visible: </div> <input type=\"checkbox\" id = \"sourceCardinalityShown\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getSourceCardinalityVisibility()} onChange={() => {this.toggleSourceCardinalityVisibility();canvasDraw.drawAll()}}/>\r\n                    <input type=\"number\" id = \"sourceFromCardindality\" className=\"CardinalityBox\" defaultValue={this.state.selectedObject.getSourceCardinalityLowerBound()} min=\"0\" max=\"25\" onChange={() => this.updateCardinality()}/>\r\n                    <label>..</label>\r\n                    <input type=\"number\" id = \"sourceToCardindality\" className=\"CardinalityBox\" defaultValue={this.state.selectedObject.getSourceCardinalityUpperBound()} min=\"-1\" max=\"25\" onChange={() => this.updateCardinality()}/>\r\n                </div>\r\n\r\n\r\n                <label className=\"LeftLabel\">Destination Cardinality</label>\r\n                <div className=\"CardinalityArea\"> <div className=\"LeftCheckboxLabel\">Visible:</div> <input type=\"checkbox\" id = \"destCardinalityShown\" className=\"LeftCheckbox\" defaultChecked={this.state.selectedObject.getDestCardinalityVisibility()} onChange={() => {this.toggleDestCardinalityVisibility();canvasDraw.drawAll()}}/>\r\n                    <input type=\"number\" id = \"destFromCardindality\" className=\"CardinalityBox\" defaultValue={this.state.selectedObject.getDestCardinalityLowerBound()} min=\"0\" max=\"25\" onChange={() => this.updateCardinality()}/>\r\n                    <label>..</label>\r\n                    <input type=\"number\" id = \"destToCardindality\" className=\"CardinalityBox\" defaultValue={this.state.selectedObject.getDestCardinalityUpperBound()} min=\"-1\" max=\"25\" onChange={() => this.updateCardinality()}/>\r\n                </div>\r\n\r\n                <label className=\"LeftLabel\">Source Label</label>\r\n                    <input id=\"SourceLabel\" className=\"LeftTitle\" defaultValue={this.state.selectedObject.sourceEdgeEnd.label} onKeyUp={() => this.setStartLabel()}/>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n\r\n                <label className=\"LeftLabel\">Destination Label</label>\r\n                    <input id=\"DestLabel\" className=\"LeftTitle\" defaultValue={this.state.selectedObject.destEdgeEnd.label} onKeyUp={() => this.setEndLabel()}/>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={() => { deleteElement(this.state.selectedObject); this.setState({ menu: LeftMenuType.TreeView, selectedObject: null }) }}>Remove</button>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={(e) => this.stripElement(e)}>Make Straight</button>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={() => this.deselectElement()}>Deselect</button>\r\n                <label className=\"LeftSpacer\">&nbsp;</label>\r\n                <button className=\"LeftMenuButton\" onClick={() => {deleteElement(this.state.selectedObject);this.setState({menu:LeftMenuType.TreeView,selectedObject:null})}}>Remove</button>\r\n\r\n            </form>\r\n            }else{\r\n                leftMenuContents = <form id = \"ArrowMenu\">\r\n                    <div className=\"LeftHeader\">Selected Edge</div>\r\n                    <button className=\"LeftMenuButton\" onClick={() => this.deselectElement()}>Deselect</button>\r\n                    <label className=\"LeftSpacer\">&nbsp;</label>\r\n                    <button className=\"LeftMenuButton\" onClick={() => {deleteElement(this.state.selectedObject);this.setState({menu:LeftMenuType.TreeView,selectedObject:null})}}>Remove</button>\r\n\r\n                    \r\n\r\n                    </form>\r\n            }\r\n        }\r\n\r\n        return <div>{toolbar}<form ref={this.setFormRef} className={this.props.className}>\r\n            {leftMenuContents}\r\n            </form></div>;\r\n        \r\n    };\r\n\r\n    render() {\r\n        let menu = this.getMenu();\r\n        if (this.formRef !== null) {\r\n            this.formRef = null;\r\n        }\r\n        return menu;\r\n    }\r\n\r\n\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport { SemanticIdentity } from \"./SemanticIdentity\";\r\nimport {drawMarker, getDistance,} from \"../UIElements/CanvasDraw\";\r\nimport {getModelRenderKey} from \"../UIElements/ContainmentTree\";\r\nimport * as ArrowProps from \"./ArrowProperties\";\r\nimport { EdgeEnd } from \"./EdgeEnd\";\r\nimport {Tool} from \"../UIElements/LeftMenu\";\r\nimport * as canvasDraw from \"../UIElements/CanvasDraw\"\r\n\r\nexport class Arrow {\r\n    // Connects an arrow fromVertex to toVertex\r\n    // pathData is an array of objects that can either be a:\r\n    //      0) Vertex Data\r\n    //         [0, UUID, xPercentage, yPercentage]\r\n    //         The Percentage data is the relative percentage\r\n    //              e.g. 0,0 represents top left, 1,1 bottom right etc\r\n    //      1) Array containing an x and y element\r\n    //         [1, x, y]\r\n    constructor(objectsList, pathData, type, semanticIdentity) {\r\n        this.typeName = \"Arrow\";\r\n\r\n        if (semanticIdentity !== undefined || objectsList === null){\r\n            this.semanticIdentity = semanticIdentity;\r\n        } else {\r\n            if (objectsList.length > 1) {\r\n                this.semanticIdentity = new SemanticIdentity(\"Arrow from \" + objectsList[0].semanticIdentity.UUID + \" to \" + objectsList[1].semanticIdentity.UUID, \"\", \"\", \"\", undefined, []);\r\n            } else if (objectsList.length === 1) {\r\n                this.semanticIdentity = new SemanticIdentity(\"Arrow connecting \" + objectsList[0].semanticIdentity.UUID, \"\", \"\", \"\", undefined, []);\r\n            } else {\r\n                this.semanticIdentity = new SemanticIdentity(\"Arrow connecting 1 or less vertices\", \"\", \"\", \"\", undefined, []);\r\n            }\r\n        }\r\n\r\n        this.sourceEdgeEnd = new EdgeEnd(this.semanticIdentity.UUID);\r\n        this.destEdgeEnd = new EdgeEnd(this.semanticIdentity.UUID);\r\n\r\n        // Ensure there are at least 2 points\r\n        if (pathData.length === 1) pathData.push(pathData[0]);\r\n        // Save pathData for later\r\n        this.pathData = pathData;\r\n\r\n        this.sourceVertexUUID = null;\r\n        this.destVertexUUID = null;\r\n        this.updateAttachedVertices();\r\n\r\n        // Construct Path\r\n        this.rebuildPath();\r\n        \r\n        // Type\r\n\r\n        this.lineColour = ArrowProps.LineColour.BLACK;\r\n        this.lineType = ArrowProps.LineType.SOLID;\r\n\r\n        if (type === Tool.Edge || type === Tool.Specialisation || type === Tool.Visibility) {\r\n            this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.NONE\r\n        }else{\r\n            console.log(\"Failed to find correct tool\");\r\n            this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.NONE\r\n        }\r\n\r\n        if (type === Tool.Edge) {\r\n            this.destEdgeEnd.type = ArrowProps.EdgeEnd.NONE\r\n            this.typeName = \"Arrow\";\r\n        }else if (type === Tool.Specialisation){\r\n            this.destEdgeEnd.type = ArrowProps.EdgeEnd.TRIANGLE\r\n            this.typeName = \"Specialisation\";\r\n        }else if (type === Tool.Visibility){\r\n            this.destEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n            this.lineType = ArrowProps.LineType.DASHED\r\n            this.typeName = \"Visibility\";\r\n        }else{\r\n            console.log(\"Failed to find correct tool\");\r\n            this.destEdgeEnd.type = ArrowProps.EdgeEnd.NONE\r\n        }\r\n\r\n        this.edgeType = type;\r\n\r\n        this.selected = false;\r\n\r\n        this.sourceIsNavigable = false;\r\n        this.destIsNavigable = false;\r\n        this.sourceIsAggregation = false;\r\n        this.destIsAggregation = false;\r\n\r\n        // Model key for rendering\r\n        this.arrowModelKey = canvasDraw.getCurrentModel();\r\n\r\n        // Render key for the arrow for placing in tree\r\n        this.arrowRenderKey = getModelRenderKey(this.arrowModelKey);\r\n    }\r\n\r\n    // Set the model key\r\n    setModelKey(key){\r\n        this.arrowModelKey = key;\r\n    }\r\n\r\n    getModelKey(){\r\n        return this.arrowModelKey;\r\n    }\r\n\r\n    // Set the render key. This is done in ContainmentTree.js\r\n    setRenderKey(key){\r\n        this.arrowRenderKey = key;\r\n    }\r\n\r\n    // Return the render key. This is called in CanvasDraw\r\n    getRenderKey(){\r\n        return this.arrowRenderKey;\r\n    }\r\n\r\n    toggleNavigable(side){\r\n        if(side === 0) {\r\n            this.sourceIsNavigable = !this.sourceIsNavigable;\r\n        }else if(side === 1){\r\n            this.destIsNavigable = !this.destIsNavigable;\r\n        }\r\n        if(this.sourceIsAggregation){\r\n            this.sourceIsNavigable = true;\r\n        }\r\n        if(this.destIsAggregation){\r\n            this.destIsNavigable = true;\r\n        }\r\n\r\n        if(this.sourceIsNavigable && this.destIsNavigable){\r\n            if(this.sourceIsAggregation){\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.FILLED_DIAMOND;\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n            }\r\n            else if(this.destIsAggregation){\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.FILLED_DIAMOND;\r\n            }else{\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n            }\r\n        }else if(this.sourceIsNavigable){\r\n            if(this.sourceIsAggregation){\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.FILLED_DIAMOND;\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.NONE;\r\n            }else {\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.NONE;\r\n            }\r\n        }else if(this.destIsNavigable){\r\n            if(this.destIsAggregation){\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.FILLED_DIAMOND;\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.NONE;\r\n            }else {\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.NONE;\r\n            }\r\n        }else{\r\n            this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.NONE;\r\n            this.destEdgeEnd.type = ArrowProps.EdgeEnd.NONE;\r\n        }\r\n\r\n    }\r\n\r\n    toggleAggregation(side){\r\n        if(side === 0){\r\n            this.sourceIsAggregation = !this.sourceIsAggregation;\r\n            if(this.destIsAggregation && this.sourceIsAggregation){\r\n                this.destIsAggregation = false;\r\n            }\r\n        }else{\r\n            this.destIsAggregation = !this.destIsAggregation;\r\n            if(this.destIsAggregation && this.sourceIsAggregation){\r\n                this.sourceIsAggregation = false;\r\n            }\r\n        }\r\n\r\n\r\n        if(this.sourceIsAggregation) {\r\n            this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.FILLED_DIAMOND;\r\n            if(this.destIsNavigable){\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n            }else{\r\n                this.destEdgeEnd.type = ArrowProps.EdgeEnd.NONE\r\n            }\r\n        }else if(this.destIsAggregation){\r\n            this.destEdgeEnd.type = ArrowProps.EdgeEnd.FILLED_DIAMOND;\r\n            if(this.sourceIsNavigable){\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.ARROW;\r\n            }else{\r\n                this.sourceEdgeEnd.type = ArrowProps.EdgeEnd.NONE\r\n            }\r\n        }else{\r\n            // this updates the arrow heads so they are correct\r\n            this.toggleNavigable(100)\r\n        }\r\n    }\r\n\r\n    getNavigable(side){\r\n        if(side === 0){\r\n            return this.sourceIsNavigable;\r\n        }else{\r\n            return this.destIsNavigable;\r\n        }\r\n\r\n    }\r\n\r\n    getAggregation(side){\r\n        if(side === 0){\r\n            return this.sourceIsAggregation\r\n        }else{\r\n            return this.destIsAggregation\r\n        }\r\n\r\n    }\r\n\r\n    trimPath(){\r\n        this.pathData = [this.pathData[0], this.pathData[this.pathData.length-1]];\r\n        this.path = [this.path[0], this.path[this.path.length-1]];\r\n    }\r\n\r\n    // Rebuilds path from cached pathData\r\n    rebuildPath() {\r\n\r\n        let connectedObjectUUIDs = this.getObjectUUIDList();\r\n        let objects = [];\r\n\r\n        connectedObjectUUIDs.forEach((UUID) => {\r\n            objects.push(canvasDraw.getObjectFromUUID(UUID))\r\n        });\r\n\r\n        // X, Y data for path\r\n        this.path = [];\r\n\r\n        for (let i = 0; i < this.pathData.length; i++) {\r\n            // Check if its case 0 or 1\r\n            let pathItem = this.pathData[i];\r\n\r\n            //If the first element of a PathItem is 0, the second element contains the UUID of an object\r\n            if (pathItem[0] === 0) {\r\n                this.path.push(this.getZerothCasePathItem(objects, pathItem));\r\n            }\r\n            //If the first element is 1, the next two elements are the X and Y points, respectively\r\n            else if (pathItem[0] === 1) {\r\n                this.path.push([pathItem[1], pathItem[2]]);\r\n            } else {\r\n                console.error(\"Invalid PathData case, wrong case\", pathItem);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Gets pathItem from object (hopefully a vertex) based on UUID\r\n    // will come back to this to sort out arrows overlapping on creation\r\n    // for extra clarity pathItem[2] is where the arrow from/end is on the x axis of the vertex(0..1)\r\n    // and pathItem[3] is where the arrow is from/end is on the y axis of the vertex(0..1) - cooper\r\n    getZerothCasePathItem(objects, pathItem) {\r\n        for (let i = 0; i < objects.length; i++) {\r\n           // if(objects[0].semanticIdentity.UUID === objects[1].semanticIdentity.UUID){\r\n\r\n           // }\r\n            if (objects[i] !== null && objects[i] !== undefined) {\r\n                if (objects[i].semanticIdentity.UUID === pathItem[1]) {\r\n                    \r\n                    \r\n                  //  let minX = objects[i].x\r\n                   // let maxX = objects[i].x + objects[i].width\r\n                   // let minY = objects[i].y\r\n                   // let maxY = objects[i].y + objects[i].realHeight // get the minimum and maximum x,y coords for the object. \r\n                                                                    // this will serve as a range so that arrows can't automatically pass these points\r\n                    let newX = pathItem[2]*objects[i].width + objects[i].x;\r\n                    let newY = pathItem[3]*objects[i].realHeight + objects[i].y;\r\n                    let x = newX\r\n                    let y = newY\r\n                    \r\n                 //   if (newX <= minX){\r\n                  //      x = minX\r\n                  //  }\r\n                  //  else if (newX >= maxX){\r\n                    //    x = maxX\r\n                    //}\r\n                    //else if (newY <= minY){\r\n                      //  y = minY\r\n                    //}\r\n                    //else if (newY >= maxY){\r\n                     //   y = maxY\r\n                    //}\r\n                   \r\n              \r\n                    return [x, y]\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log(\" [Ignore this when importing] Could not find vertex to connect for pathItem\", pathItem);\r\n        return null;\r\n    }\r\n\r\n    getObjectUUIDList(){\r\n        let output = [];\r\n            this.pathData.forEach((item) => {\r\n                let index = this.pathData.indexOf(item);\r\n                if(item == null){\r\n                    this.pathData[index] = [1,this.path[index][0],this.path[index][1]]\r\n                }\r\n                if (this.pathData[index][0] === 0) {\r\n                    output.push(item[1])\r\n                }\r\n            });\r\n        return output\r\n    }\r\n\r\n    updateAttachedVertices() {\r\n        var pathStart = this.pathData[0];\r\n        var pathEnd = this.pathData[this.pathData.length - 1];\r\n\r\n        if (pathStart[0] === 0) {\r\n            this.sourceVertexUUID = pathStart[1];\r\n        } else {\r\n            this.sourceVertexUUID = null;\r\n        }\r\n\r\n        if (pathEnd[0] === 0) {\r\n            this.destVertexUUID = pathEnd[1];\r\n        } else {\r\n            this.destVertexUUID = null;\r\n        }\r\n    }\r\n\r\n    setSelected(selected) {\r\n        this.selected = selected;\r\n    }\r\n\r\n    updateSourceCardinality(lowerBound, upperBound, visibility) {\r\n        this.sourceEdgeEnd.updateCardinality(lowerBound, upperBound, visibility);\r\n    }\r\n\r\n    getSourceCardinalityVisibility() {\r\n        return this.sourceEdgeEnd.cardinality.isVisible;\r\n    }\r\n\r\n    toggleSourceCardinalityVisibility() {\r\n        this.sourceEdgeEnd.cardinality.toggleVisibility();\r\n    }\r\n\r\n    getSourceCardinalityLowerBound() {\r\n        return this.sourceEdgeEnd.cardinality.lowerBound;\r\n    }\r\n\r\n    getSourceCardinalityUpperBound() {\r\n        return this.sourceEdgeEnd.cardinality.upperBound;\r\n    }\r\n\r\n    updateDestCardinality(lowerBound, upperBound, visibility) {\r\n        this.destEdgeEnd.updateCardinality(lowerBound, upperBound, visibility);\r\n    }\r\n\r\n    getDestCardinalityVisibility() {\r\n        return this.destEdgeEnd.cardinality.isVisible;\r\n    }\r\n\r\n    toggleDestCardinalityVisibility() {\r\n        this.destEdgeEnd.cardinality.toggleVisibility();\r\n    }\r\n\r\n    getDestCardinalityLowerBound() {\r\n        return this.destEdgeEnd.cardinality.lowerBound;\r\n    }\r\n\r\n    getDestCardinalityUpperBound() {\r\n        return this.destEdgeEnd.cardinality.upperBound;\r\n    }\r\n\r\n    setStartLabel(label) {\r\n        this.sourceEdgeEnd.label = label;\r\n    }\r\n\r\n    setEndLabel(label) {\r\n        this.destEdgeEnd.label = label;\r\n    }\r\n\r\n    setLineColour(lineColour) {\r\n        let val = ArrowProps.StringNameToLineColour[lineColour];\r\n        if (val !== undefined) {\r\n            this.lineColour = val;\r\n        } else {\r\n            console.log(\"Attempted to assign invalid lineColour: %s\", lineColour);\r\n        }\r\n    }\r\n\r\n    setLineType(lineType) {\r\n        let val = ArrowProps.StringToLineType[lineType];\r\n        if (val !== undefined) {\r\n            this.lineType = val;\r\n        } else {\r\n            console.log(\"Attempted to assign invalid lineType: %s\", lineType);\r\n        }\r\n    }\r\n\r\n    // Creates nodes for an algorithmn to path find around a vertex\r\n    createPathNodesForVertex(vertex, nodeIndex, d) {\r\n        // Set ids\r\n        let topLeft     = nodeIndex++;\r\n        let top         = nodeIndex++;\r\n        let topRight    = nodeIndex++;\r\n        let right       = nodeIndex++;\r\n        let bottomRight = nodeIndex++;\r\n        let bottom      = nodeIndex++;\r\n        let bottomLeft  = nodeIndex++;\r\n        let left        = nodeIndex++;\r\n\r\n        // Create nodes for: fromVertex\r\n        let vertexNodes = [];\r\n        vertexNodes.push([topLeft,     vertex.x-d,              vertex.y+vertex.height+d, [left, top]]);               // Top    Left\r\n        vertexNodes.push([top,         vertex.x+vertex.width/2, vertex.y+vertex.height+d, [topLeft, topRight]]);       // Top\r\n        vertexNodes.push([topRight,    vertex.x+vertex.width+d, vertex.y+vertex.height+d, [top, right]]);              // Top    Right\r\n        vertexNodes.push([right,       vertex.x+vertex.width+d, vertex.y+vertex.height/2, [topRight, bottomRight]]);   //        Right\r\n        vertexNodes.push([bottomRight, vertex.x+vertex.width+d, vertex.y-d,               [right, bottom]]);           // Bottom Right\r\n        vertexNodes.push([bottom,      vertex.x+vertex.width/2, vertex.y-d,               [bottomRight, bottomLeft]]); // Bottom\r\n        vertexNodes.push([bottomLeft,  vertex.x-d,              vertex.y-d,               [bottomRight, left]]);       // Bottom Left\r\n        vertexNodes.push([left,        vertex.x-d,              vertex.y+vertex.height/2, [bottomLeft, topLeft]]);     //        Left\r\n        return [nodeIndex, vertexNodes];\r\n    }\r\n\r\n    drawStartHead(canvasContext) {\r\n        let lineAngle = Math.atan2(this.getSY() - this.getNSY(), this.getSX() - this.getNSX());\r\n        this.sourceEdgeEnd.draw(canvasContext, this.getSX(), this.getSY(), lineAngle, this.lineColour);\r\n    }\r\n\r\n    drawEndHead(canvasContext) {\r\n        let lineAngle = Math.atan2(this.getEY() - this.getNEY(), this.getEX() - this.getNEX());\r\n        this.destEdgeEnd.draw(canvasContext, this.getEX(), this.getEY(), lineAngle, this.lineColour);\r\n    }\r\n\r\n    isPathSegmentLR(startIndex,endIndex){\r\n        let indexSx = this.path[startIndex][0];\r\n        let indexEx = this.path[endIndex][0];\r\n        let indexSy = this.path[startIndex][1];\r\n        let indexEy = this.path[endIndex][1];\r\n\r\n        return Math.abs(indexSx-indexEx) > Math.abs(indexSy-indexEy)\r\n    }\r\n\r\n    getTextOffsets(canvasContext, sourceText, destText, sourceCtext, destCtext) {\r\n        let sourceTextWidth = canvasContext.measureText(sourceText).width;\r\n        let destTextWidth = canvasContext.measureText(destText).width;\r\n        let sourceCtextWidth = canvasContext.measureText(sourceCtext).width;\r\n        let destCtextWidth = canvasContext.measureText(destCtext).width;\r\n        let textHeight = 15;\r\n        // 'M' is the widest possible character\r\n        let charWidth = canvasContext.measureText(\"M\").width;\r\n\r\n        let sxOffset;\r\n        let syOffset;\r\n        let exOffset;\r\n        let eyOffset;\r\n\r\n        let sxOffsetc;\r\n        let syOffsetc;\r\n        let exOffsetc;\r\n        let eyOffsetc;\r\n\r\n        let sxFlip = true;\r\n        let syFlip = true;\r\n        let exFlip = true;\r\n        let eyFlip = true;\r\n\r\n        // true if arrow is landscape, false if arrow is portrait;\r\n        let E1index = this.path.length-2;\r\n        let E2index = this.path.length-1;\r\n\r\n        let startLRArrow = this.isPathSegmentLR(0,1);\r\n        let endLRArrow = this.isPathSegmentLR(E1index,E2index);\r\n\r\n        let SSX = this.path[0][0];\r\n        let SSY = this.path[0][1];\r\n        let SEX = this.path[1][0];\r\n        let SEY = this.path[1][1];\r\n\r\n        let ESX = this.path[E1index][0];\r\n        let ESY = this.path[E1index][1];\r\n        let EEX = this.path[E2index][0];\r\n        let EEY = this.path[E2index][1];\r\n\r\n        if (startLRArrow) {\r\n            if (SSX > SEX) {\r\n                sxFlip = !sxFlip;\r\n            }\r\n        } else {\r\n            if (SSY > SEY) {\r\n                syFlip = !syFlip;\r\n            }\r\n        }\r\n\r\n        if (endLRArrow) {\r\n            if (ESX > EEX) {\r\n                exFlip = !exFlip;\r\n            }\r\n        } else {\r\n            if (ESY > EEY) {\r\n                eyFlip = !eyFlip;\r\n            }\r\n        }\r\n\r\n\r\n        if (sxFlip) {\r\n            sxOffset = charWidth/2;\r\n            if (startLRArrow) {\r\n                sxOffsetc = charWidth/2;\r\n            } else {\r\n                sxOffsetc = -1*(sourceCtextWidth+charWidth/2)\r\n            }\r\n        } else {\r\n            sxOffset = -1*(sourceTextWidth+charWidth/2);\r\n            if (startLRArrow) {\r\n                sxOffsetc = -1*(sourceCtextWidth+charWidth/2)\r\n            } else {\r\n                sxOffsetc = charWidth/2;\r\n            }\r\n        }\r\n        \r\n\r\n        if (syFlip) {\r\n            syOffset = textHeight;\r\n            if (startLRArrow) {\r\n                syOffsetc = -1*(textHeight/2)\r\n            } else {\r\n                syOffsetc = syOffset;\r\n            }\r\n        } else {\r\n            syOffset = -1*(textHeight/2);\r\n            if (startLRArrow) {\r\n                syOffsetc = syOffset;\r\n            } else {\r\n                syOffsetc = -1*(textHeight/2)\r\n            }\r\n        }\r\n\r\n\r\n        //if true arrow moves more in x than in y\r\n        exFlip = !exFlip;\r\n        eyFlip = !eyFlip;\r\n\r\n        if (exFlip) {\r\n            exOffset = charWidth/2;\r\n            if (endLRArrow) {\r\n                exOffsetc = charWidth/2;\r\n            } else {\r\n                exOffsetc = -1*(destCtextWidth+charWidth/2)\r\n            }\r\n        } else {\r\n            exOffset = -1*(destTextWidth+charWidth/2);\r\n            if (endLRArrow) {\r\n                exOffsetc = -1*(destCtextWidth+charWidth/2)\r\n            } else {\r\n                exOffsetc = charWidth/2;\r\n            }\r\n        }\r\n\r\n\r\n        if (eyFlip) {\r\n            eyOffset = textHeight;\r\n            if (endLRArrow) {\r\n                eyOffsetc = -1*(textHeight/2);\r\n            } else {\r\n                eyOffsetc = eyOffset;\r\n            }\r\n        } else {\r\n            eyOffset = -1*(textHeight/2);\r\n            if (endLRArrow) {\r\n                eyOffsetc = textHeight;\r\n            } else {\r\n                eyOffsetc = eyOffset;\r\n            }\r\n        }\r\n\r\n\r\n        return [sxOffset,syOffset,exOffset,eyOffset,sxOffsetc,syOffsetc,exOffsetc,eyOffsetc]\r\n    }\r\n\r\n\r\n\r\n    drawLabelsAndCardinalities(canvasContext) {\r\n        let sourceCardText = this.sourceEdgeEnd.cardinality.toString();\r\n        let destCardText = this.destEdgeEnd.cardinality.toString();\r\n        let Offsets = this.getTextOffsets(canvasContext,this.sourceEdgeEnd.label,this.destEdgeEnd.label,sourceCardText,destCardText);\r\n\r\n        canvasContext.fillStyle = \"#000\";\r\n\r\n        //draw source text\r\n        canvasContext.fillText(this.sourceEdgeEnd.label, this.getSX() + Offsets[0], this.getSY() + Offsets[1]);\r\n\r\n        //draw destination text\r\n        canvasContext.fillText(this.destEdgeEnd.label, this.getEX() + Offsets[2], this.getEY() + Offsets[3]);\r\n\r\n        //draw source cardinality\r\n        if (this.getSourceCardinalityVisibility()) {\r\n            canvasContext.fillText(sourceCardText, this.getSX() + Offsets[4], this.getSY() + Offsets[5]);\r\n        }\r\n\r\n        //draw destination cardinality\r\n        if (this.getDestCardinalityVisibility()) {\r\n            canvasContext.fillText(destCardText, this.getEX() + Offsets[6], this.getEY() + Offsets[7]);\r\n        }\r\n    }\r\n\r\n    draw(canvasContext) {\r\n        let dashLength = 5;\r\n\r\n        switch (this.lineType) {\r\n            case ArrowProps.LineType.SOLID:\r\n                canvasContext.setLineDash([]);\r\n                break;\r\n            case ArrowProps.LineType.DASHED:\r\n                canvasContext.setLineDash([dashLength, dashLength]);\r\n                break;\r\n            default:\r\n                console.log(\"Arrow had invalid lineType: %s\", this.lineType);\r\n        }\r\n\r\n        // Draw\r\n        canvasContext.strokeStyle = this.lineColour;\r\n\r\n        // Draw Lines\r\n        for (let i = 0; i < this.path.length-1; i++) {\r\n            let from = this.path[i];\r\n            let to = this.path[i+1];\r\n\r\n            canvasContext.beginPath();\r\n            canvasContext.moveTo(from[0], from[1]);\r\n            canvasContext.lineTo(to[0], to[1]);\r\n            canvasContext.stroke();\r\n        }\r\n\r\n        canvasContext.strokeStyle = \"#000\";\r\n        canvasContext.setLineDash([]);\r\n\r\n        this.drawStartHead(canvasContext);\r\n        this.drawEndHead(canvasContext);\r\n        //store which labels were flipped and in which direction (x/y)\r\n        this.drawLabelsAndCardinalities(canvasContext);\r\n\r\n        if (this.selected) {\r\n            for (let i = 0; i < this.path.length; i++) {\r\n                let pos = this.path[i];\r\n                drawMarker(pos[0], pos[1]);\r\n            }\r\n        }\r\n    }\r\n\r\n    intersects(cx, cy) {\r\n        for (let i = 0; i < this.path.length-1; i++) {\r\n            let from = this.path[i];\r\n            let to = this.path[i+1];\r\n\r\n            if (this.intersectsSegment(cx, cy, from, to)) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Checks if it intersects with one of the line segments\r\n    intersectsSegment(cx, cy, from, to) {\r\n        let m = getDistance(cx, cy, from[0], from[1]);\r\n        let n = getDistance(cx, cy, to[0], to[1]);\r\n        let l = getDistance(from[0], from[1], to[0], to[1]);\r\n\r\n        let threshold = 1;\r\n\r\n        return (m+n-threshold < l);\r\n    }\r\n\r\n    // Get first x/y\r\n    getSX() {\r\n        return this.path[0][0];\r\n    }\r\n    getSY() {\r\n        return this.path[0][1];\r\n    }\r\n\r\n    // Get second x/y\r\n    getNSX() {\r\n        return this.path[1][0];\r\n    }\r\n    getNSY() {\r\n        return this.path[1][1];\r\n    }\r\n\r\n    // Get second last x/y\r\n    getNEX() {\r\n        let index = this.path.length-2;\r\n        if (index < 0) index = 0;\r\n        return this.path[index][0];\r\n    }\r\n    getNEY() {\r\n        let index = this.path.length-2;\r\n        if (index < 0) index = 0;\r\n        return this.path[index][1];\r\n    }\r\n\r\n    // Get last x/y\r\n    getEX() {\r\n        return this.path[this.path.length-1][0];\r\n    }\r\n    getEY() {\r\n        return this.path[this.path.length-1][1];\r\n    }\r\n}","import {addObject, currentObjects, drawAll, getCurrentModel, getCurrentObjects, getCurrentRenderKey, getTotalModels, getTotalRenderKeys, \r\n    setCurrentObjects, setNewModel, setNewRenderKey, setTotalModelKeys, setTotalRenderKey, updateArrows} from \"../UIElements/CanvasDraw\"\r\n\r\nimport {setTranslationColumns, translationColumns} from \"../UIElements/SemanticDomainEditor\"\r\n\r\nimport {Vertex} from \"../DataStructures/Vertex\";\r\nimport {Arrow} from \"../DataStructures/Arrow\";\r\nimport {Cardinality} from \"../DataStructures/Cardinality\";\r\nimport {EdgeEnd} from \"../DataStructures/EdgeEnd\";\r\nimport {Graph} from \"../DataStructures/Graph\";\r\nimport { SemanticIdentity } from \"../DataStructures/SemanticIdentity\";\r\nimport { getDecoyFolderData, getDecoyModelData, getDecoyVertexData, getFolderData, getModelData, \r\n    getSelectedFolderKey, getTreeData, getVertexData, setDecoyFolderData, setDecoyModelData, setDecoyVertexData, \r\n    setFolderData, setModelData, setSelectedFolderKey, setTreeData, setVertexData } from \"../UIElements/ContainmentTree\";\r\n\r\n\r\n//Get all the data that needs to be saved, to restore a session\r\n// .slice() only creates a shallow copy of arrays which means that it copies literal values but only makes referneces to arrays and objects.\r\n// turning the object into a string and back into an object creates a deep copy which is an actual standalone copy and not an array of references\r\nexport function getSaveData() {\r\n    let vertexObjects = currentObjects.flatten(true, false);\r\n    let arrowObjects = currentObjects.flatten(false, true);\r\n    let treeData = JSON.parse(JSON.stringify(getTreeData()))\r\n    let folderData = JSON.parse(JSON.stringify(getFolderData()))\r\n    let decoyFolderData = JSON.parse(JSON.stringify(getDecoyFolderData()))\r\n\r\n    let vertexData = JSON.parse(JSON.stringify(getVertexData()));\r\n    let decoyVertexData = JSON.parse(JSON.stringify(getDecoyVertexData()));\r\n\r\n    let modelObjects = JSON.parse(JSON.stringify(getModelData()));\r\n    let decoyModelObjects = JSON.parse(JSON.stringify(getDecoyModelData())) \r\n\r\n    let totalRenderKeys = getTotalRenderKeys();\r\n    let totalModels = getTotalModels();\r\n\r\n    let currentModel = getCurrentModel();\r\n    let currentKey = getCurrentRenderKey();\r\n    let currentFolder = getSelectedFolderKey();\r\n\r\n    let saveData = {\r\n\r\n        translationColumns: translationColumns,\r\n\r\n        vertices: vertexObjects,\r\n        arrows: arrowObjects,\r\n        tree: treeData,\r\n        packages: folderData,\r\n        dPackages: decoyFolderData,\r\n        treeVertex: vertexData,\r\n        dTreeVertex: decoyVertexData,\r\n        graph: modelObjects,\r\n        dGraph: decoyModelObjects,\r\n        renderKeys: totalRenderKeys,\r\n        modelKeys: totalModels,\r\n        currentKey: currentKey,\r\n        currentMod: currentModel,\r\n        currentFol: currentFolder,\r\n        \r\n\r\n\r\n\r\n    };\r\n    return saveData;\r\n}\r\n\r\n\r\n//Create the JSON file with the save data\r\nexport function save(){\r\n    let JSONdata = getSaveData();\r\n    let dataTransformed = JSON.stringify(JSONdata);\r\n    let dataFile = new Blob([dataTransformed], {type: 'text/json'});\r\n    //default file name\r\n    let title = prompt(\"Please name your file\", 's23m Model')\r\n\r\n    //Download the file\r\n    let DLelement = document.createElement(\"a\");\r\n    DLelement.href = URL.createObjectURL(dataFile);\r\n    DLelement.download = title + \".json\";\r\n    document.body.appendChild(DLelement);\r\n    DLelement.click();\r\n    document.body.removeChild(DLelement);\r\n\r\n}\r\n\r\n//currently doesnt load arrows or semantic editor properties\r\nexport function load(jsonString){\r\n    if (jsonString == null) return;\r\n    let saveData = JSON.parse(jsonString);\r\n\r\n    //TreeVertices need to convert semanticIdentity back to a sI object\r\n    for(let vert of saveData.treeVertex){\r\n        vert.semanticIdentity = new SemanticIdentity(vert.semanticIdentity.name,vert.semanticIdentity.description,vert.semanticIdentity.abbreviation,\r\n            vert.semanticIdentity.shortAbbreviation,vert.semanticIdentity.UUID,vert.semanticIdentity.translations)\r\n    }\r\n    //Models and arrows need to be converted back to their explicit types\r\n    var newVertices = [];\r\n    var newArrows = [];\r\n\r\n    //vertices\r\n    for(let vert of saveData.vertices){\r\n        console.log(vert)\r\n        vert.semanticIdentity = new SemanticIdentity(vert.semanticIdentity.name,vert.semanticIdentity.description,vert.semanticIdentity.abbreviation,\r\n            vert.semanticIdentity.shortAbbreviation,vert.semanticIdentity.UUID,vert.semanticIdentity.translations)\r\n        //atm its a bit messy as vert constructor doesnt use destructuring so we can specifiy options, when it does this can be changed\r\n        vert = new Vertex ({newConstructor: 1,loadedVertex: vert})\r\n        newVertices.push(vert)\r\n    }\r\n\r\n    //arrows\r\n    function remakeSemantic(semantic){\r\n        return new SemanticIdentity(semantic.name, semantic.description, semantic.abbreviation, semantic.shortAbbreviation, semantic.UUID, semantic.translations);\r\n    }\r\n\r\n    function remakeCardinality(cardinality){\r\n        return new Cardinality(cardinality.numLowerBound, cardinality.numUpperBound, cardinality.attachedToUUID, cardinality.isVisible, remakeSemantic(cardinality.semanticIdentity));\r\n    }\r\n \r\n    function remakeEdge(edge){\r\n        return new EdgeEnd(edge.attachedToUUID, edge.headType, remakeCardinality(edge.cardinality), edge.label, remakeSemantic(edge.semanticIdentity));\r\n    }\r\n\r\n    function remakeArrow(arrow){\r\n        var newArrow = new Arrow(newVertices, arrow.pathData, arrow.edgeType, remakeSemantic(arrow.semanticIdentity));\r\n            newArrow.sourceEdgeEnd = remakeEdge(arrow.sourceEdgeEnd);\r\n            newArrow.destEdgeEnd = remakeEdge(arrow.destEdgeEnd);\r\n            return newArrow;\r\n    }\r\n\r\n    for(let arrow of saveData.arrows){\r\n        arrow = remakeArrow(arrow)\r\n        newArrows.push(arrow)\r\n    }\r\n\r\n    setTranslationColumns(saveData.translationColumns)\r\n    setFolderData(saveData.packages);\r\n    setDecoyFolderData(saveData.dPackages);\r\n    setVertexData(saveData.treeVertex);\r\n    setDecoyVertexData(saveData.dTreeVertex);\r\n    setModelData(saveData.graph)\r\n    setDecoyModelData(saveData.dGrraph)\r\n    setTreeData(saveData.tree)\r\n    setTotalRenderKey(saveData.renderKeys)\r\n    setTotalModelKeys(saveData.modelKeys)\r\n    setCurrentObjects(new Graph(newVertices, newArrows));\r\n    updateArrows()\r\n    setSelectedFolderKey(1)\r\n    setNewRenderKey(1)\r\n    setNewModel(1)\r\n    drawAll()\r\n\r\n\r\n\r\n    console.log(\"load finished\")\r\n\r\n}\r\n\r\n//Import a package or save file into root\r\nexport function importLoad(jsonString){\r\n    //load the file\r\n    if (jsonString == null) return;\r\n    let saveData = JSON.parse(jsonString);\r\n    console.log(\"saveData\")\r\n    console.log(saveData)\r\n\r\n    //Models and folders,treevertex's need to be given new keys\r\n    //arrows and vertex's will need new keys to match their updated parent keys\r\n    let folderKeyMap = [];\r\n    let modelKeyMap = [];\r\n    let arrowUpdated = []; // list of arrows that have already updated. Used to stop arrows updating multiple times due to newkeys overlapping with oldkey numbers.\r\n    let renderKeys = getTotalRenderKeys();\r\n    let modelKeys = getTotalModels();\r\n\r\n\r\n\r\n    //assign a new key for each package/vertex\r\n    for(let folder of saveData.packages){\r\n        renderKeys++;\r\n        let folderKey = {originalKey: folder.renderKey, originalParentKey: folder.parentRenderKey, newKey: renderKeys, newParentKey: 0}\r\n        folderKeyMap.push(folderKey)\r\n    }\r\n    for(let vert of saveData.treeVertex){\r\n        renderKeys++;\r\n        let folderKey = {originalKey: vert.renderKey, originalParentKey: vert.parentRenderKey, newKey: renderKeys, newParentKey: 0}\r\n        folderKeyMap.push(folderKey)\r\n    }\r\n    for(let model of saveData.graph){\r\n        modelKeys++;\r\n        let modelKey = {originalModelKey: model.modelKey, originalKey: model.renderKey, newModelKey: modelKeys, newKey: 0}\r\n        modelKeyMap.push(modelKey)\r\n    }\r\n\r\n    //assign new relative parent keys\r\n    for(let packages of folderKeyMap){\r\n        for(let packagesCompare of folderKeyMap){\r\n            if(packages.originalParentKey === packagesCompare.originalKey){\r\n                packages.newParentKey = packagesCompare.newKey;\r\n            }\r\n        }\r\n    }\r\n\r\n    for(let models of modelKeyMap){\r\n        for(let packages of folderKeyMap){\r\n            if(models.originalKey === packages.originalKey){\r\n                models.newKey = packages.newKey;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    //assign the new keys to the vertex's, model's and packages\r\n\r\n    for(let i = 0; i < saveData.packages.length; i++){\r\n        saveData.packages[i].renderKey = folderKeyMap[i].newKey;\r\n        saveData.packages[i].parentRenderKey = folderKeyMap[i].newParentKey;\r\n\r\n        saveData.packages[i].data.renderKey = folderKeyMap[i].newKey;\r\n        saveData.packages[i].data.parentRenderKey = folderKeyMap[i].newParentKey;\r\n\r\n        saveData.dPackages[i].renderKey = folderKeyMap[i].newKey;\r\n        saveData.dPackages[i].parentRenderKey = folderKeyMap[i].newParentKey;\r\n    }\r\n\r\n    for(let i = saveData.packages.length; i < saveData.packages.length + saveData.treeVertex.length; i++){\r\n        saveData.treeVertex[i - saveData.packages.length].renderKey = folderKeyMap[i].newKey;\r\n        saveData.treeVertex[i - saveData.packages.length].parentRenderKey = folderKeyMap[i].newParentKey;\r\n\r\n        saveData.treeVertex[i - saveData.packages.length].data.renderKey = folderKeyMap[i].newKey;\r\n        saveData.treeVertex[i - saveData.packages.length].data.parentRenderKey = folderKeyMap[i].newParentKey;\r\n\r\n        saveData.dTreeVertex[i - saveData.packages.length].renderKey = folderKeyMap[i].newKey;\r\n        saveData.dTreeVertex[i - saveData.packages.length].parentRenderKey = folderKeyMap[i].newParentKey;\r\n    }\r\n\r\n    for(let i =0; i< saveData.graph.length; i++){\r\n        saveData.graph[i].renderKey = modelKeyMap[i].newKey\r\n        saveData.graph[i].modelKey = modelKeyMap[i].newModelKey\r\n\r\n        saveData.graph[i].data.renderKey = modelKeyMap[i].newKey\r\n        saveData.graph[i].data.modelKey = modelKeyMap[i].newModelKey\r\n\r\n        saveData.dGraph[i].renderKey = modelKeyMap[i].newKey\r\n        saveData.dGraph[i].modelKey = modelKeyMap[i].newModelKey\r\n    }\r\n\r\n    //assign the new keys to vertex's and arrows\r\n    for(let packages of folderKeyMap){\r\n        console.log(folderKeyMap)\r\n        console.log(\"folderKeyMap\")\r\n        \r\n        for(let vertex of saveData.vertices){\r\n            if(vertex.vertexRenderKey === packages.originalKey){\r\n                vertex.vertexRenderKey = packages.newKey;\r\n            }\r\n        }\r\n\r\n        for(let arrow of saveData.arrows){\r\n           \r\n\r\n            if(arrow.arrowRenderKey === packages.originalKey && !arrowUpdated.includes(arrow)){\r\n                console.log(\"saveData.arrows\")\r\n                console.log(saveData.arrows)\r\n                arrow.arrowRenderKey = packages.newKey;\r\n                arrowUpdated.push(arrow);\r\n            }\r\n        }\r\n            \r\n    }\r\n\r\n    for(let models of modelKeyMap){\r\n        for(let vertex of saveData.vertices){\r\n            if(vertex.vertexModelKey === models.originalModelKey){\r\n                vertex.vertexModelKey = models.newModelKey;\r\n            }\r\n        }\r\n\r\n        for(let arrow of saveData.arrows){\r\n            if(arrow.arrowModelKey === models.originalModelKey){\r\n                arrow.arrowModelKey = models.newModelKey;\r\n            }\r\n        }\r\n    }\r\n    \r\n    console.log(saveData.arrows)\r\n\r\n\r\n\r\n    //recreat vertex/arrow objects as in load()\r\n\r\n    var newVertices = [];\r\n    var newArrows = [];\r\n    for(let vert of saveData.vertices){\r\n        vert.semanticIdentity = new SemanticIdentity(vert.semanticIdentity.name,vert.semanticIdentity.description,vert.semanticIdentity.abbreviation,\r\n            vert.semanticIdentity.shortAbbreviation,vert.semanticIdentity.UUID,vert.semanticIdentity.translations)\r\n        //atm its a bit messy as vert constructor doesnt use destructuring so we can specifiy options, when it does this can be changed\r\n        vert = new Vertex ({newConstructor: 1,loadedVertex: vert})\r\n        newVertices.push(vert)\r\n    }\r\n\r\n    function remakeSemantic(semantic){\r\n        return new SemanticIdentity(semantic.name, semantic.description, semantic.abbreviation, semantic.shortAbbreviation, semantic.UUID, semantic.translations);\r\n    }\r\n\r\n    function remakeCardinality(cardinality){\r\n        return new Cardinality(cardinality.numLowerBound, cardinality.numUpperBound, cardinality.attachedToUUID, cardinality.isVisible, remakeSemantic(cardinality.semanticIdentity));\r\n    }\r\n \r\n    function remakeEdge(edge){\r\n        return new EdgeEnd(edge.attachedToUUID, edge.headType, remakeCardinality(edge.cardinality), edge.label, remakeSemantic(edge.semanticIdentity));\r\n    }\r\n\r\n    function remakeArrow(arrow){\r\n        var newArrow = new Arrow(newVertices, arrow.pathData, arrow.edgeType, remakeSemantic(arrow.semanticIdentity));\r\n            newArrow.setRenderKey(arrow.arrowRenderKey)\r\n            newArrow.setModelKey(arrow.arrowModelKey)\r\n            newArrow.sourceEdgeEnd = remakeEdge(arrow.sourceEdgeEnd);\r\n            newArrow.destEdgeEnd = remakeEdge(arrow.destEdgeEnd);\r\n            return newArrow;\r\n    }\r\n\r\n    for(let arrow of saveData.arrows){\r\n        arrow = remakeArrow(arrow)\r\n        newArrows.push(arrow)\r\n    }\r\n\r\n\r\n    //models,folders,tree verts need to be added to current data\r\n\r\n    setFolderData(getFolderData().concat(saveData.packages))\r\n    setDecoyFolderData(getDecoyFolderData().concat(saveData.dPackages))\r\n\r\n    setVertexData(getVertexData().concat(saveData.treeVertex))\r\n    setDecoyVertexData(getDecoyVertexData().concat(saveData.dTreeVertex))\r\n\r\n    setModelData(getModelData().concat(saveData.graph)) \r\n    setDecoyModelData(getDecoyModelData().concat(saveData.dGraph))\r\n\r\n\r\n    //vertex's and arrows add to current data\r\n\r\n    console.log(getCurrentObjects())\r\n    console.log(newVertices)\r\n\r\n    for(let vertex of newVertices){\r\n        addObject(vertex)\r\n    }\r\n    for(let arrow of newArrows){\r\n        addObject(arrow)\r\n    }\r\n\r\n    //reset current keys to reload a few things eg. turn any loaded vertices invisible is they were present in save\r\n\r\n    setSelectedFolderKey(getSelectedFolderKey())\r\n    setNewRenderKey(getCurrentRenderKey())\r\n    setNewModel(getCurrentModel())\r\n    //set the new latest index's\r\n    setTotalRenderKey(renderKeys)\r\n    setTotalModelKeys(modelKeys)\r\n    //update arrows drawall\r\n    updateArrows()\r\n    drawAll()\r\n\r\n    console.log(getCurrentObjects())\r\n     \r\n\r\n return;\r\n}\r\n\r\n//Loads saveData in memory (not from json string)\r\nfunction loadDirect(saveData){\r\n\r\n    setTranslationColumns(saveData.translationColumns)\r\n    setFolderData(saveData.packages);\r\n    setDecoyFolderData(saveData.dPackages);\r\n    setVertexData(saveData.treeVertex);\r\n    setDecoyVertexData(saveData.dTreeVertex);\r\n    setModelData(saveData.graph)\r\n    setDecoyModelData(saveData.dGrraph)\r\n    setTreeData(saveData.tree)\r\n    setTotalRenderKey(saveData.renderKeys)\r\n    setTotalModelKeys(saveData.modelKeys)\r\n    setCurrentObjects(new Graph(saveData.vertices, saveData.arrows));\r\n    updateArrows()\r\n    setSelectedFolderKey(saveData.currentFol)\r\n    setNewRenderKey(saveData.currentKey)\r\n    setNewModel(saveData.currentMod)\r\n    drawAll()\r\n\r\n}\r\n\r\n// index 0 is the most recent change\r\nlet saveStates = []\r\nlet currentState = 0\r\n//Save states limit as its all stored in memeory (save states are relativley small though and only scale to be a few kilobytes per object though)\r\nlet maxSavedStates = 10; //Could probably get away with a limit in the range of 20-50 for really large model \"depositories\"\r\n\r\nexport function getsaveStates(){\r\n    return saveStates;\r\n}\r\n\r\n\r\nexport function createSaveState(){\r\n\r\n    //This line is needed as some of the variables in saveData\r\n    let newData = Object.assign({}, getSaveData());\r\n    //Remove everything infront of the current state if not most recent eg. When the user has hit undo and then does an action\r\n    if(currentState !== 0){\r\n        for(let i = 0; i < currentState; i++){\r\n            saveStates.shift()\r\n        }\r\n        currentState = 0;\r\n    }\r\n    //push the chnage to saveStates and remove the oldest state if above threshold\r\n    saveStates.unshift(newData)\r\n    if(saveStates.length > maxSavedStates){\r\n        saveStates.pop()\r\n    }\r\n}\r\n\r\n//I beleive the first part of the if statement can be deleted as part 2 covers it ie.there will never be 11 savestates, but havent tested yet\r\nexport function undo(){\r\n    if(currentState < (maxSavedStates - 1) && saveStates[currentState + 1] !== undefined && saveStates.length !== 0){\r\n        currentState ++\r\n        loadDirect(saveStates[currentState])\r\n    }\r\n    console.log(currentState)\r\n}\r\n\r\nexport function redo(){\r\n    if(currentState > 0 && saveStates.length !== 0){\r\n        currentState --\r\n        loadDirect(saveStates[currentState])\r\n    }\r\n    console.log(currentState)\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. \r\n */\r\n\r\nimport React from 'react';\r\nimport TreeView from 'react-simple-jstree';\r\n\r\nimport { currentObjects, setNewRenderKey, \r\n    getTotalRenderKeys, incrementTotalRenderKeys, \r\n    getCurrentModel, setNewModel, getTotalModels, incrementTotalModels, deleteElement} from \"./CanvasDraw\";\r\n\r\nimport { drawAll } from \"./CanvasDraw\";\r\nimport {VertexNode} from \"../DataStructures/Graph.js\"\r\nimport { SemanticIdentity } from \"../DataStructures/SemanticIdentity.js\";\r\nimport { createSaveState } from '../Serialisation/NewFileManager';\r\n\r\n// I need to export this so I can access it in the left menu and then set it to the correct vertex;\r\nexport var someVertexPath = \"\";\r\n\r\nlet currentlySelectedObject = null; //The currently selected object\r\n\r\nlet showingVertPath = false;\r\n\r\n// Accesor for tree data\r\nlet treeData = [];\r\n\r\n// I need this to store the folders. Initially, it has one folder simply titled 'Unnamed Folder'.\r\nexport let folderData = [];\r\n\r\n// used to store Vertex objects in tree data (Used to create the vertex objects in CanvasDraw/currentObjects)\r\nexport let vertexData = [];\r\nlet decoyVertexData = [] //here because of how old team did folder indexing\r\n\r\n//used as a container to seperate \"root\" folders and subfolders so that only the root folders are pushed to root.children in the constructor - Lachlan\r\nlet folderDataRoot = [];\r\n\r\n//This variable will be used to store the \"selected folder\" for creating new folders or models\r\n// As renderKey is tied too many methods related to syncing data between canvas and tree/ creating data in tree control of the current renderkey \r\n//has been taken away from the user and will always be set to the parent folder of the selected model (this happens in elementSelect on a model click) - Lachlan\r\nlet selectedFolderKey = 0;\r\n\r\n// This is to do with getting the data indexing to be\r\nlet decoyFolderData = [];\r\n\r\n// An array for holding model names\r\nexport let modelObjects = [];\r\n\r\nlet decoyModelObjects = []; // doing the same data referencing as folder data because currently the data being referenced in the models is the model beforehand which\r\n                            // i dont tink is intended. - cooper\r\n\r\n\r\n// created a boolean which whill tell the leftmenu that the containment tree needs to update\r\nexport var treeNeedsUpdate = 0;\r\n\r\n\r\n\r\nexport function setSelectedFolderKey(newKey){\r\n    selectedFolderKey = newKey;\r\n}\r\n\r\nexport function getSelectedFolderKey(){\r\n    return selectedFolderKey;\r\n}\r\n\r\nexport function getTreeData(){\r\n    return treeData;\r\n}\r\n\r\nexport function setTreeData(newTreeData){\r\n    treeData = newTreeData;\r\n}\r\n\r\nexport function getFolderData(){\r\n    return folderData;\r\n}\r\n\r\nexport function setFolderData(newFolderData){\r\n    folderData = newFolderData;\r\n}\r\n\r\nexport function getDecoyFolderData(){\r\n    return decoyFolderData\r\n}\r\n\r\nexport function setDecoyFolderData(newData){\r\n    decoyFolderData = newData;\r\n}\r\n\r\nexport function getVertexData(){\r\n    return vertexData;\r\n}\r\n\r\nexport function setVertexData(newData){\r\n    vertexData = newData;\r\n}\r\n\r\nexport function getDecoyVertexData(){\r\n    return decoyVertexData\r\n}\r\n\r\nexport function setDecoyVertexData(newData){\r\n    decoyVertexData = newData;\r\n}\r\n\r\n//returns a concated array of the folders and vertex(containers)\r\nexport function getContainerData(){\r\n    return folderData.concat(vertexData);\r\n}\r\n\r\nexport function getModelData(){\r\n    return modelObjects;\r\n}\r\n\r\nexport function setModelData(newData){\r\n    modelObjects = newData;\r\n}\r\nexport function getDecoyModelData(){\r\n    return decoyModelObjects;\r\n}\r\nexport function setDecoyModelData(newData){\r\n    decoyModelObjects = newData;\r\n}\r\n\r\n//This function is used to load the first available model and canvas from the modelObjects array\r\n//Used to fix thye tree/canvas desync bug when deleting - Lachlan\r\nfunction loadFirstModel(){\r\n    //set selected model/render key to the 1st available as so a canvas isnt loaded for a nonexistant model\r\n    // if there is atleast one or more items inside of modelObjects set the renderkey to the first object, else set the renderkey and model keys to 1.\r\n    console.log(\"below is modelObjects\")\r\n    console.log(modelObjects)\r\n    if(modelObjects.length > 0){\r\n        setNewRenderKey(modelObjects[0].data.renderKey)\r\n        setNewModel(modelObjects[0].data.modelKey)\r\n        setSelectedFolderKey(modelObjects[0].data.renderKey)\r\n    }\r\n    else{\r\n        setNewRenderKey(1)\r\n        setNewModel(-1)\r\n        setSelectedFolderKey(1)\r\n    }\r\n\r\n    //taken from handleElementSelect for loading the new models canvas\r\n    for (let item of currentObjects.flatten()){\r\n        if (item.typeName === \"Vertex\" && item.getModelKey() === getCurrentModel()){\r\n            item.setPresent();\r\n        }\r\n        else if (item.getModelKey() !== getCurrentModel() && item.typeName === \"Vertex\"){\r\n            item.setAway();\r\n        }\r\n    }\r\n    drawAll()\r\n    \r\n}\r\n\r\n\r\n//parent key is for dictating subfolders where 0 is root, else pKey is a folder renderKey - Lachlan\r\nexport function handleAddFolder(folderName, parentKey = 0){\r\n    //Create a new folder using the known node type\r\n\r\n    incrementTotalRenderKeys();\r\n\r\n    let tempFolderThing = {\r\n        text: folderName + \" \", //If icon is changed, youll have to change the folder icon in context menu too\r\n        children: treeData[getTotalRenderKeys()],\r\n        data: NaN,\r\n        state: {opened: true},\r\n        type: \"Folder\",\r\n        typeName: \"Folder\",\r\n        renderKey: getTotalRenderKeys(),\r\n        parentRenderKey: parentKey\r\n    }\r\n\r\n    decoyFolderData.push(tempFolderThing)\r\n\r\n    let folderThing2 = {\r\n        text: folderName + \" \", //If icon is changed, youll have to change the folder icon in context menu too\r\n        children: treeData[getTotalRenderKeys()],\r\n        data: decoyFolderData[folderData.length],\r\n        state: {opened: true},\r\n        type: \"Folder\",\r\n        typeName: \"Folder\",\r\n        renderKey: getTotalRenderKeys(),\r\n        parentRenderKey: parentKey\r\n    }\r\n    \r\n\r\n    folderData.push(folderThing2);\r\n\r\n\r\n    \r\n}\r\n\r\n// Function to remove a folder in the tree\r\nexport function handleDeleteFolder(selectedRenderKey){ // changing the deleting functions to delete based on renderkey & modelkeys - cooper\r\n    console.log(\"below is the selected render key\")\r\n    console.log(selectedRenderKey)\r\n    if(folderData.length > 1){ //cannot delete folder if it is the only one excluding root - Lachlan\r\n        for (let i = 0; i < folderData.length; i++){\r\n            if (folderData[i].renderKey === selectedRenderKey){\r\n                console.log(\"below is folderdata\")\r\n                console.log(folderData)\r\n                deleteFolderChildren(folderData[i]);\r\n                decoyFolderData.splice(i,1); // have to delete from this array as well because this is where folders obtain the data of themselves \r\n                folderData.splice(i,1); \r\n            }\r\n        }\r\n    \r\n    }\r\n    else{console.log(\"Cannot delete only folder\")}\r\n    \r\n    loadFirstModel()\r\n}\r\n\r\nfunction deleteFolderChildren(selectedFolder){ // function for deleting all the children of a folder.\r\n    let folderChildren = selectedFolder.children;\r\n    for (let i = 0; i < folderChildren.length; i++){\r\n        if (folderChildren[i].type === \"Folder\"){\r\n            let selectedRenderKey = folderChildren[i].renderKey;\r\n            handleDeleteFolder(selectedRenderKey);\r\n\r\n        }\r\n        else if (folderChildren[i].type === \"Model\"){\r\n            let selectedModelKey = folderChildren[i].modelKey;\r\n            handleDeleteModel(selectedModelKey);\r\n        }\r\n        else if (folderChildren[i].type === \"treeVertex\"){\r\n            let selectedUUID = folderChildren[i].semanticIdentity.UUID;\r\n            handleDeleteVertex(selectedUUID);\r\n        }\r\n    }\r\n}\r\n\r\nfunction deleteModelChildren(selectedModel){ // function for deleting all the children of the model.\r\n    if(selectedModel.children.length > 0){\r\n        let verticesFolder = selectedModel.children;\r\n        for (let i = 0; i < verticesFolder.length; i++){ // had to make a nested for loop due to the encompassing 'vertices' folder\r\n            let vertices = verticesFolder[i].children;\r\n            for (let v = 0; v < vertices.length; v++){\r\n                if (vertices[v].modelkey === selectedModel.modelKey){\r\n                    let chosenObject = vertices[v].data\r\n                    deleteElement(chosenObject);\r\n                }\r\n            }    \r\n        }\r\n    }   \r\n}\r\n\r\n\r\nexport function handleRenameFolder(newName,rKey){\r\n    if(newName !== \"\"){\r\n        for (let i = 0; i < folderData.length; i++){\r\n            if (folderData[i].renderKey === rKey){\r\n                folderData[i].text = newName + \" \";\r\n                folderData[i].data.text = newName + \" \";\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    else{\r\n        console.log(\"Cannot have empty name\")\r\n    }\r\n}\r\n\r\nexport function handleAddVertex(vertexName, parentKey = 0){\r\n    //Create a new folder using the known node type\r\n\r\n    incrementTotalRenderKeys();\r\n    let sID = new SemanticIdentity(vertexName,\"\",\"\",\"\", undefined ,[])\r\n\r\n    let tempVertexThing = {\r\n        text: vertexName + \" \", //If icon is changed, youll have to change the folder icon in context menu too\r\n        children: treeData[getTotalRenderKeys()],\r\n        data: NaN,\r\n        state: {opened: true},\r\n        type: \"treeVertex\",\r\n        typeName: \"VertexNode\",\r\n        originalVertex: true,\r\n        renderKey: getTotalRenderKeys(),\r\n        parentRenderKey: parentKey,\r\n        content: \"content\",\r\n        colour: \"#FFD5A9\",\r\n        height: 50,\r\n        width: 70,\r\n        icons: [[],[],[]],\r\n        imageElements: {},\r\n        fontSize: 12,\r\n        semanticIdentity: sID\r\n    }\r\n\r\n    decoyVertexData.push(tempVertexThing)\r\n\r\n    let vertexThing2 = {\r\n        text: vertexName + \" \", //If icon is changed, youll have to change the folder icon in context menu too\r\n        children: treeData[getTotalRenderKeys()],\r\n        data: decoyVertexData[vertexData.length],\r\n        state: {opened: true},\r\n        type: \"treeVertex\",\r\n        typeName: \"VertexNode\",\r\n        originalVertex: true,\r\n        renderKey: getTotalRenderKeys(),\r\n        parentRenderKey: parentKey,\r\n        content: \"\",\r\n        colour: \"#FFD5A9\",\r\n        height: 50,\r\n        width: 70,\r\n        icons: [[],[],[]],\r\n        imageElements: {},\r\n        fontSize: 12,\r\n        semanticIdentity: sID\r\n    }\r\n    \r\n\r\n    vertexData.push(vertexThing2);\r\n    //console.log(vertexData)\r\n\r\n\r\n    return vertexThing2\r\n    \r\n}\r\n\r\n\r\n\r\n// Added optional parameter render key, atm used to handle create a model with no folder selected - Lachlan\r\n//initial \"children\" are to prevent erros caused by children initialy not being iterable - Lachlan\r\nexport function handleAddModel(modelName, rKey=getSelectedFolderKey(), semanticID=undefined){\r\n    incrementTotalModels();\r\n    let sID = undefined;\r\n    let icon = \" \"; //If icon is changed, youll have to change toe folder icon in context menu too\r\n    \r\n    if (semanticID !== undefined){\r\n        sID = semanticID;\r\n        icon = \" \"; //If icon is changed, youll have to change toe folder icon in context menu too\r\n    } else {\r\n        sID = new SemanticIdentity(modelName,\"\",\"\",\"\", undefined ,[]);\r\n    }\r\n\r\n    if(rKey <= 0) return //stops the creation of models in the root or otherwise non-existent folders\r\n    \r\n    let decoyModelThing = {\r\n        text: modelName + icon,\r\n        children: [],\r\n        data: NaN,\r\n        state: {opened: true},\r\n        type: \"Model\",\r\n        typeName: \"Model\",\r\n        renderKey: rKey,\r\n        modelKey: getTotalModels(),\r\n        semanticIdentity: sID\r\n    }\r\n    decoyModelObjects.push(decoyModelThing);\r\n\r\n\r\n    let tempModelThing = {\r\n        text: modelName + icon,\r\n        children: [],\r\n        data: decoyModelObjects[modelObjects.length],\r\n        state: {opened: true},\r\n        type: \"Model\",\r\n        typeName: \"Model\",\r\n        renderKey: rKey,\r\n        modelKey: getTotalModels(),\r\n        semanticIdentity: sID\r\n    };\r\n \r\n    modelObjects.push(tempModelThing);\r\n    //console.log(modelObjects)\r\n\r\n}\r\n\r\nexport function handleDeleteVertex(selectedUUID){\r\n    for(let vertex of currentObjects.flatten()){\r\n        if(vertex.originalUUID === selectedUUID){\r\n            currentObjects.remove(vertex)\r\n        }\r\n    }\r\n    for(let i = 0; i < vertexData.length; i++){\r\n        if(vertexData[i].semanticIdentity.UUID === selectedUUID){\r\n            vertexData.splice(i, 1)\r\n            decoyVertexData.splice(i, 1)\r\n        }\r\n    }\r\n    drawAll();\r\n}\r\n\r\nexport function handleDeleteModel(selectedModelKey){\r\n\r\n\r\n    for (let i = 0; i < modelObjects.length; i++){\r\n        if (modelObjects[i].modelKey === selectedModelKey){\r\n            console.log(\"model deleted below\")\r\n            console.log(modelObjects[i])\r\n            deleteModelChildren(modelObjects[i]);\r\n            modelObjects.splice(i, 1);\r\n            decoyModelObjects.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    loadFirstModel()\r\n}\r\n\r\nexport function handleRenameModel(newName,mKey){\r\n    for (let i = 0; i < modelObjects.length; i++){\r\n        if (modelObjects[i].modelKey === mKey){\r\n            modelObjects[i].text = newName + \" \";\r\n            modelObjects[i].data.text = newName + \" \";\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function getModelRenderKey(selectedModelKey){ // this function is to fetch the renderkey of the selected model to ensure verticies get created with the correct renderkey -- cooper\r\n    for(let i = 0; i < modelObjects.length; i++){\r\n        if (modelObjects[i].modelKey === selectedModelKey){\r\n            return modelObjects[i].renderKey\r\n        }\r\n    }\r\n}\r\n\r\n//Function for changing the parent folder of a model - Lachlan\r\nexport function handleModelRebase(mKey,newRkey){\r\n    console.log(\"Rebase test\")\r\n    console.log(modelObjects)\r\n    for(let model of modelObjects){\r\n        if(model.modelKey === mKey){\r\n           for(let objectFolders of model.children){  \r\n                let objects = objectFolders.children\r\n                for(let object of objects){\r\n                    object.renderkey = newRkey;\r\n                    if(object.data.typeName === \"Vertex\"){\r\n                    object.data.vertexRenderKey = newRkey;\r\n                    }\r\n                    else{\r\n                    object.data.arrowRenderKey = newRkey;\r\n                    }\r\n                }\r\n            } \r\n            console.log(model)\r\n            model.renderKey = newRkey;\r\n            console.log(model)\r\n        }\r\n    }\r\n    console.log(modelObjects)\r\n    treeNeedsUpdate = 1;\r\n    createSaveState();\r\n}\r\n\r\n\r\n\r\n// This is a function to display the path of a given vertex\r\n// It's called in the left menu of a vertex\r\nexport function showVertexPath(theObject){\r\n\r\n    if (currentObjects.flatten().length > 0){\r\n        currentlySelectedObject = theObject;\r\n        if (showingVertPath === false){\r\n            showingVertPath = true;\r\n        }\r\n    \r\n        else if (showingVertPath === true){\r\n            showingVertPath = false;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// This function is used to determine which object should be owned by which folder object.\r\n// Works by taking a look at the children of the treeData array and seeing if their render \r\n// key matches the one parsed to the function\r\nfunction determineOwnership(parsedRenderKey){\r\n    let returnArray = []\r\n    let i = 0\r\n    for (let vertexOrArrow of treeData){\r\n        if(vertexOrArrow !== undefined){\r\n            //console.log(\"treeData object name: \" + vertexOrArrow.text)\r\n\r\n            if (vertexOrArrow.type === \"Model\"){\r\n                if (vertexOrArrow.renderKey === parsedRenderKey){\r\n                    returnArray.push(treeData[i])\r\n                }\r\n                \r\n            }\r\n\r\n        }\r\n        i += 1\r\n    }\r\n\r\n    return returnArray\r\n}\r\n\r\n//function used for determineing which folders are owned by a higher folder - Lachlan\r\nfunction determineSubFolders(parsedRenderKey){\r\n    let returnArray = []\r\n    for (let folder of getContainerData()){\r\n        if(folder.parentRenderKey === parsedRenderKey)\r\n        returnArray.push(folder)\r\n    }\r\n    //console.log(\"subfolder return\")\r\n    //console.log(returnArray)\r\n    return returnArray\r\n}\r\n\r\nexport function getModelNameFromKey(key){\r\n    let model = modelObjects.find(model => model.modelKey === key)\r\n    return model.text\r\n}\r\n\r\nexport function getFolderNameFromKey(key){\r\n    let folder = getContainerData().find(folder => folder.renderKey === key)\r\n    return folder.text\r\n}\r\n\r\n\r\n\r\nlet initialFolderAdded = false;\r\nexport class ContainmentTree extends React.Component {\r\n\r\n    componentDidMount() {\r\n        document.getElementById(\"LowerPanel\").addEventListener('dragstart', this.dragStart);\r\n    }\r\n    componentDidUpdate(){\r\n    }\r\n    \r\n    componentWillUnmount() {\r\n        document.getElementById(\"LowerPanel\").removeEventListener('dragstart', this.dragStart);\r\n    }\r\n\r\n    dragStart(e) {\r\n        //console.log(e)\r\n        //When we have a better method of getting data without the click, Use the new method to assign the data value - Lachlan\r\n        e.target.click();\r\n        let vertData = 0;\r\n        for(let folder of getContainerData()){\r\n            if(getSelectedFolderKey() === folder.renderKey)\r\n            vertData = folder;\r\n        }\r\n\r\n        let data = vertData;\r\n        console.log('drag starts...');\r\n        //Prevents errors when a folder or model is dragged etc. \r\n        if(vertData.type === \"treeVertex\"){\r\n        e.dataTransfer.setData('text/plain',data.semanticIdentity.UUID)\r\n        //console.log(data.semanticIdentity.UUID)\r\n        }\r\n        else{\r\n            console.log(\"This object has no drag/drop feature\")\r\n        }\r\n     }\r\n    \r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        treeData = []; \r\n        //let i = 0;\r\n        //console.log(\"props\")\r\n        //console.log(props)\r\n        \r\n\r\n        \r\n        if (initialFolderAdded === false){\r\n            handleAddFolder(\"Package\"); //The initial folder has render key 1, the initial model needs this to be specified as nothing is selected\r\n            handleAddModel(\"Graph\",1) \r\n            handleAddFolder(\"Subfolder\",1)\r\n            handleAddVertex(\"Vertex\",1)\r\n            handleAddFolder(\"Package 2\")\r\n            handleAddModel(\"Graph 2\",4)\r\n            handleAddVertex(\"Vertex 2\",4)\r\n            setNewRenderKey(1);\r\n            setNewModel(1);\r\n            setSelectedFolderKey(1);\r\n            initialFolderAdded = true;\r\n            createSaveState();\r\n        }\r\n        \r\n\r\n            // Push the model objects in. --- I moved the position of these for loops outside of the vertex for loop as it was creating a few problems - cooper\r\n        for (let model of modelObjects){\r\n            treeData.push(model);           \r\n            \r\n        }\r\n        for (let folder of getContainerData()){ // this for loop is to define the ownership of the models - cooper\r\n                let canvasItems = determineOwnership(folder.renderKey) \r\n                let subFolderItems = determineSubFolders(folder.renderKey)\r\n                let combinedItems = canvasItems.concat(subFolderItems)\r\n                folder.children = combinedItems;\r\n                \r\n\r\n            }\r\n               // treeData.push(vertex.toTreeViewElement(new Set())); --- not too sure what the point of this .push was - cooper   \r\n            \r\n        for (let folder of getContainerData()){ // this for loop is to define the ownership of the vertices & arrows - cooper\r\n            let vertex = new VertexNode() \r\n\r\n\r\n            if (vertex.toTreeViewElement(\"Arrow Folder\", folder.renderKey) !== undefined){\r\n                folder.children.push(vertex.toTreeViewElement(\"Arrow Folder\", folder.renderKey))\r\n            }  \r\n            \r\n        }\r\n\r\n        for(let vert of getVertexData()){\r\n            if(vert.children.length === 0){\r\n                vert.text = vert.text.replace(\" \",\"\");\r\n                vert.text = vert.text.replace(\" \",\"\");\r\n                vert.text = vert.text + \" \"\r\n            }\r\n            else{\r\n                vert.text = vert.text.replace(\" \",\"\");\r\n                vert.text = vert.text.replace(\" \",\"\");\r\n                vert.text = vert.text + \" \"\r\n            }\r\n        }\r\n\r\n        folderDataRoot = [];\r\n        for (let folder of getContainerData()){\r\n            if(folder.parentRenderKey ===0){\r\n                folderDataRoot.push(folder)\r\n            }\r\n\r\n        }\r\n\r\n        this.state = {\r\n            data: {\r\n                core: {\r\n                    data: [\r\n                        { text: \"Root\", \r\n                        children: folderDataRoot, state: { opened: true }, \r\n                        root: true},\r\n                    ]\r\n                }\r\n            },\r\n            selectedVertex: null\r\n        }\r\n\r\n\r\n\r\n        if(showingVertPath === true){\r\n\r\n            let highestLevel = \"Root\";\r\n            let nextLevel = \"\";\r\n            let vertexOrEdge = \"\";\r\n            let actualObject = \"\";\r\n\r\n            let b = 0;\r\n            //First, we need to actually determine where the vertex is\r\n            //Take a look at our container\r\n            for (let cont of getContainerData()){\r\n                for (let treeDat of cont.children){\r\n                    if(b === 0){\r\n                        for (let treeElement of treeDat.children){\r\n                                if ((treeElement.text === currentlySelectedObject.title)){\r\n                                    nextLevel = cont.text;\r\n                                    vertexOrEdge = \"Vertices\"\r\n                                    actualObject = currentlySelectedObject.title\r\n                                    someVertexPath = highestLevel +\"::\"+ nextLevel +\"::\"+ vertexOrEdge +\"::\"+ actualObject;\r\n                                    b = 1;\r\n                                }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //Function called when an object in treeview is clicked\r\n    handleElementSelect(e, data) {\r\n\r\n        // Try catch used to catch undefined data type eg. root\r\n        try{\r\n            console.log(data.node)\r\n\r\n            if(data.node.data.type === \"Folder\" || data.node.data.type === \"treeVertex\" ){\r\n                setSelectedFolderKey(data.node.data.renderKey)\r\n            }\r\n\r\n            else if (data.node.data.type === \"Model\"){\r\n                setNewModel(data.node.data.modelKey);\r\n                setNewRenderKey(data.node.data.renderKey);\r\n                setSelectedFolderKey(data.node.data.renderKey)\r\n                // Move everything away\r\n                for (let item of currentObjects.flatten()){\r\n                    if (item.typeName === \"Vertex\" && item.getModelKey() === getCurrentModel()){\r\n                        item.setPresent();\r\n                    }\r\n\r\n                    else if (item.getModelKey() !== getCurrentModel() && item.typeName === \"Vertex\"){\r\n                        item.setAway();\r\n                    }\r\n                }\r\n            }\r\n            \r\n            else if (data.selected.length === 1 && data.node.data !== null && data.node.data.type === undefined) {\r\n                let UUID = data.node.data.semanticIdentity.UUID;\r\n                for (let vertex of currentObjects.flatten()) {\r\n                    if (vertex.semanticIdentity.UUID === UUID) {\r\n                        this.setState({\r\n                            selectedVertex: vertex\r\n                        });\r\n\r\n                        //The following is required to change canvas to the selected vertex's model preventing desync issues of tree and canvas - Lachlan\r\n                        setNewRenderKey(vertex.vertexRenderKey);\r\n                        setNewModel(vertex.vertexModelKey); \r\n                        setSelectedFolderKey(vertex.vertexRenderKey)\r\n                        \r\n                        for (let item of currentObjects.flatten()){\r\n                            if (item.typeName === \"Vertex\" && item.getModelKey() === getCurrentModel()){\r\n                                item.setPresent();\r\n                            }\r\n                            else if (item.getModelKey() !== getCurrentModel() && item.typeName === \"Vertex\"){\r\n                                item.setAway();\r\n                            }\r\n                        }\r\n                        this.props.setLeftMenu(this.state.selectedVertex);\r\n                    }\r\n                }\r\n            } \r\n            else {\r\n                this.setState({\r\n                    selectedVertex: null\r\n                });\r\n            }\r\n            drawAll();\r\n        }\r\n        catch(e){\r\n            //console.log(\"If True,a null type error has been caught, If the selected object should be selectable, this is an issue\")\r\n        }\r\n\r\n        //If the user clicks the root folder\r\n        try{\r\n            if(data.node.original.root === true){\r\n                setSelectedFolderKey(0) //renderkey 0 will be used for root\r\n            }\r\n        }\r\n        catch(e){\r\n        }\r\n\r\n\r\n    }\r\n\r\n    handleContextMenu(){\r\n        console.log(\"CM triggered for tree\")\r\n    }\r\n\r\n\r\n\r\n    render() {\r\n        const data = this.state.data;\r\n        return (\r\n            <div>\r\n                <TreeView treeData={data} onChange={(e, data) => this.handleElementSelect(e, data)} className=\"treeview\" id=\"treeview\" draggable=\"true\" />\r\n\r\n            </div>\r\n        )\r\n    }\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport { drawMarker, distanceThreshold, getCurrentModel } from \"../UIElements/CanvasDraw\";\r\nimport { getModelRenderKey } from \"../UIElements/ContainmentTree\";\r\nimport { SemanticIdentity} from \"./SemanticIdentity\";\r\nimport {serverURL} from \"../UIElements/MainView\"\r\n\r\nexport var padding = 5;\r\nexport var defaultColour = \"#FFD5A9\";\r\nexport var defaultMinimumSize = 30;\r\n\r\nexport class Vertex {\r\n\r\n    //As javascript doesnt have method overloading, newConstructor is used to access the secondary constructor when flagged 1 \r\n\r\n    //at some point change to use destructuring, which will require changing every use of this method to use destructing too\r\n    constructor({title = \"unnamed\", content, colour, x, y, width, height, semanticIdentity,newConstructor=0,loadedVertex=0}) {\r\n\r\n        //This constructor is used to turn a vertex loaded from JSON.parse back into a vertex object\r\n        if(newConstructor === 1){\r\n\r\n            this.typeName = loadedVertex.typeName;\r\n            this.semanticIdentity = loadedVertex.semanticIdentity;\r\n            this.title = loadedVertex.title;\r\n            this.content = loadedVertex.content;\r\n            this.colour = loadedVertex.colour;\r\n            this.x = loadedVertex.x;\r\n            this.y = loadedVertex.y;\r\n            this.icons = loadedVertex.icons;\r\n            this.selected = false;\r\n            this.imageElements = loadedVertex.imageElement;\r\n            this.fontSize = 12;\r\n            this.orignalVertex = loadedVertex.orignalVertex;\r\n            this.originalUUID = loadedVertex.originalUUID; \r\n            this.Origin = loadedVertex.Origin; \r\n            this.width = loadedVertex.width;\r\n            this.height = loadedVertex.height;\r\n            this.realHeight = loadedVertex.realHeight;\r\n            this.isAbstract = loadedVertex.isAbstract;\r\n            this.vertexPath = loadedVertex.vertexPath;\r\n            this.vertexModelKey = loadedVertex.vertexModelKey;\r\n            this.vertexRenderKey = loadedVertex.vertexRenderKey;\r\n            this.renderedx = loadedVertex.renderedx;\r\n            this.renderedy = loadedVertex.renderedy;\r\n            this.awayx = loadedVertex.awayx;\r\n            this.awayy = loadedVertex.awayy;\r\n            this.status = loadedVertex.status;\r\n\r\n        }\r\n\r\n        else{\r\n            this.typeName = \"Vertex\";\r\n\r\n            if (semanticIdentity !== undefined){\r\n                this.semanticIdentity = semanticIdentity;\r\n            } else {\r\n                this.semanticIdentity = new SemanticIdentity(title,\"\",\"\",\"\", undefined ,[]);\r\n            }\r\n\r\n            this.title = title;\r\n\r\n\r\n            if(content === undefined){\r\n                this.content = \"\"\r\n            }\r\n            else{\r\n            this.content = content;\r\n            }\r\n\r\n            this.colour = colour\r\n            this.x = x;\r\n            this.y = y;\r\n            this.icons = [[],[],[]];\r\n            this.selected = false;\r\n            this.imageElements = {};\r\n            this.fontSize = 12;\r\n            this.orignalVertex = true; // bool to see if the selected vertex is the original\r\n            //this.originalUUID = this.originalUUID // going to store the UUID of the original vertex here as canvas objects need to be given a unique semanticUUID \r\n            this.isContainer = false; //Ignore this now, Kieth explained how containers work after finishing old implementation, direction other team was going was wrong - Lachlan\r\n            this.Origin = \"\" //package the vertex originates from if needed\r\n    \r\n\r\n            // Note these values often change in runtime\r\n            this.width = width;\r\n            this.height = height;\r\n\r\n            this.realHeight = height;\r\n\r\n            // Make sure width and height meet a reasonable minimum\r\n            this.width = Math.max(width, defaultMinimumSize);\r\n            this.height = Math.max(height, defaultMinimumSize);\r\n\r\n            this.isAbstract = false;\r\n\r\n            //Store the path to your given vertex here\r\n            this.vertexPath = \"\";\r\n\r\n            // USed to decide where to render the object\r\n            this.vertexModelKey = getCurrentModel();\r\n\r\n            // Used to decide where the object goes in the tree\r\n            this.vertexRenderKey = getModelRenderKey(this.vertexModelKey);\r\n\r\n\r\n            // Used for moving vertices out of the way when they're not being rendered to prevent invisible overlap\r\n            this.renderedx = x;\r\n            this.renderedy = y;\r\n\r\n            this.awayx = Math.floor(Math.random() * 2000000)+100000;\r\n            this.awayy = Math.floor(Math.random() * 2000000)+100000;\r\n\r\n            this.status = \"present\"\r\n        }\r\n        \r\n    }\r\n\r\n    // Save a vertice's proper x and y coordinate for later rendering and then send the vertex somewhere else\r\n    setAway(){\r\n        if (this.status === \"present\"){\r\n            this.renderedx = this.x;\r\n            this.renderedy = this.y;\r\n\r\n            this.x = this.awayx;\r\n            this.y = this.awayy;\r\n\r\n            this.status = \"away\"\r\n\r\n        }\r\n        \r\n    }\r\n\r\n    setPresent(){\r\n\r\n        if (this.status === \"away\"){\r\n            this.x = this.renderedx;\r\n            this.y = this.renderedy;\r\n\r\n            this.status = \"present\"\r\n        }\r\n        \r\n    }\r\n\r\n    setModelKey(key){\r\n        this.vertexModelKey = key;\r\n    }\r\n\r\n    getModelKey(){\r\n        return this.vertexModelKey;\r\n    }\r\n\r\n\r\n    getSemantic(){\r\n        return this.SemanticIdentity\r\n    }\r\n\r\n    setSemantic(newSem){\r\n        this.SemanticIdentity = newSem;\r\n    }\r\n\r\n    // Set the render key. Done in ContainmentTree.js\r\n    setRenderKey(key){\r\n        this.vertexRenderKey = key;\r\n    }\r\n\r\n    // Get the render key. Called in CanvasDraw.js\r\n    getRenderKey(){\r\n        return this.vertexRenderKey;\r\n    }\r\n\r\n    setPath(path){\r\n        this.vertexPath = path;\r\n    }\r\n\r\n    getPath(){\r\n        return this.vertexPath;\r\n    }\r\n\r\n    setSelected(selected) {\r\n        this.selected = selected;\r\n    }\r\n\r\n    getColour(){\r\n        return this.colour\r\n    }\r\n\r\n    setColour(colour){\r\n        this.colour = colour;\r\n    }\r\n\r\n    setTitle(title) {\r\n        this.title = title;\r\n        this.semanticIdentity.name = title;\r\n    }\r\n\r\n    setContent(content) {\r\n        this.content = content;\r\n        this.semanticIdentity.description = content;\r\n    }\r\n\r\n    getAbstract(){\r\n        return this.isAbstract\r\n    }\r\n\r\n    toggleAbstract(){\r\n        this.isAbstract = !this.isAbstract\r\n    }\r\n\r\n    setOrigin(newOrigin){\r\n        this.Origin = newOrigin;\r\n    }\r\n    getOrigin(){\r\n        return this.Origin;\r\n    }\r\n\r\n    getContentAsString() {\r\n        if (this.content !== null) {\r\n            let mergedContent = \"\";\r\n            \r\n            for (let i = 0; i < this.content.length; i++) {\r\n                mergedContent = mergedContent.concat(this.content[i]);\r\n                if (i < this.content.length - 1) {\r\n                    mergedContent = mergedContent.concat(\"\\n\");\r\n                }\r\n            }\r\n            \r\n            return mergedContent;\r\n\r\n        } else {\r\n            return \"\";\r\n        }\r\n    }\r\n\r\n    setIcon(fileName) {\r\n        let fileNames = this.icons[0];\r\n        let Icons = this.icons[1];\r\n        let Text = this.icons[2];\r\n\r\n        let index = fileNames.indexOf(fileName);\r\n\r\n        //icon not part of this vertex yet\r\n        if (index === -1) {\r\n            fileNames.push(fileName);\r\n            Icons.push(true);\r\n            Text.push(false);\r\n\r\n        } else {\r\n            Icons[index] = !Icons[index]\r\n        }\r\n\r\n        if (Text[index] === false && Icons[index] === false) {\r\n            Icons.splice(index,1);\r\n            Text.splice(index,1);\r\n            fileNames.splice(index,1);\r\n        }\r\n\r\n    }\r\n\r\n    setText(fileName) {\r\n        let fileNames = this.icons[0];\r\n        let icons = this.icons[1];\r\n        let text = this.icons[2];\r\n\r\n        let index = fileNames.indexOf(fileName);\r\n\r\n        //icon not part of this vertex yet\r\n        if (index === -1) {\r\n            fileNames.push(fileName);\r\n            icons.push(false);\r\n            text.push(true);\r\n\r\n        } else {\r\n            text[index] = !text[index]\r\n        }\r\n\r\n        if (text[index] === false && icons[index] === false) {\r\n            icons.splice(index,1);\r\n            text.splice(index,1);\r\n            fileNames.splice(index,1);\r\n        }\r\n\r\n    }\r\n\r\n    isIconSet(fileName) {\r\n        let index = this.icons[0].indexOf(fileName);\r\n        if (index === -1) {\r\n            return false;\r\n        }\r\n        return this.icons[1][index];\r\n    }\r\n\r\n    isTextSet(fileName) {\r\n            let index = this.icons[0].indexOf(fileName);\r\n            if (index === -1) {\r\n                return false;\r\n            } else {\r\n                return this.icons[2][index];\r\n            }\r\n    }\r\n\r\n    getBounds() {\r\n        return [this.x, this.y, this.x+this.width, this.y+this.realHeight-padding];\r\n    }\r\n\r\n    expandSide(side, x, y,canvasContext) {\r\n        let ex = 0;\r\n        let ey = 0;\r\n\r\n        let pad = (this.hasContent() ? padding*4 : padding*2);\r\n\r\n        switch (side) {\r\n            case \"topLeft\":\r\n                ey += this.y + this.height;\r\n                this.y = y;\r\n                this.height = ey-this.y;\r\n                ex += this.x + this.width;\r\n                this.x = x;\r\n                this.width = ex-this.x;\r\n                break;\r\n\r\n            case \"topRight\":\r\n                ey += this.y + this.height;\r\n                this.y = y;\r\n                this.height = ey-this.y;\r\n                this.width = x-this.x;\r\n                break;\r\n\r\n            case \"bottomLeft\":\r\n\r\n                this.height = y-this.y  - this.iconAreaHeight - this.contentHeight - pad;\r\n                ex += this.x + this.width;\r\n                this.x = x;\r\n                this.width = ex-this.x;\r\n                break;\r\n\r\n            case \"bottomRight\":\r\n\r\n                this.height = y - this.y - this.iconAreaHeight - this.contentHeight - pad;\r\n                this.width = x-this.x;\r\n                break;\r\n\r\n            case \"left\":\r\n                ex += this.x + this.width;\r\n                this.x = x;\r\n                this.width = ex-this.x;\r\n                break;\r\n\r\n            case \"right\":\r\n                this.width = x-this.x;\r\n                break;\r\n\r\n            case \"top\":\r\n                ey += this.y + this.height;\r\n                this.y = y;\r\n                this.height = ey-this.y;\r\n                break;\r\n\r\n            case \"bottom\":\r\n                this.height = y-this.y  - this.iconAreaHeight - this.contentHeight - pad;\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n        this.height = Math.max(this.height,12+padding);\r\n        this.draw(canvasContext)\r\n    }\r\n\r\n\r\n    increaseWidthIfNecessary(canvasContext, possibleWidth) {\r\n        if (possibleWidth > this.width) {\r\n            this.width = possibleWidth;\r\n        }\r\n\r\n    }\r\n\r\n    hasContent() {\r\n        return !(this.content[0] === \"\" && this.content.length === 1)\r\n    }\r\n\r\n\r\n    draw(canvasContext) {\r\n\r\n        // Icon height in px\r\n        let iconHeight = 20;\r\n        let iconPadding = 2;\r\n        let iconListLen = this.icons[0].length;\r\n\r\n        // check for width increases\r\n        for (let i = 0; i < this.icons[0].length; i++) {\r\n\r\n            if (this.icons[1][i] === true) {\r\n                if (this.icons[2][i] === true) {\r\n                    this.increaseWidthIfNecessary(canvasContext, iconHeight + canvasContext.measureText(\"<< \" + this.icons[0][i] + \" >>\").width);\r\n                }\r\n            }else{\r\n                if (this.icons[2][i] === true) {\r\n                    this.increaseWidthIfNecessary(canvasContext, canvasContext.measureText(\"<< \" + this.icons[0][i] + \" >>\").width);\r\n                }\r\n            }\r\n        }\r\n        this.increaseWidthIfNecessary(canvasContext, canvasContext.measureText(this.title + this.Origin).width);\r\n\r\n        for (let i = 0; i < this.content.length; i++) {\r\n            this.increaseWidthIfNecessary(canvasContext, canvasContext.measureText(this.content[i]).width + padding*2);\r\n        }\r\n\r\n        // Font size\r\n        padding = 5;\r\n        // Set font settings\r\n        if(this.is)\r\n        canvasContext.font = this.fontSize+\"px Segoe UI\";\r\n        canvasContext.fontSize = this.fontSize;\r\n\r\n\r\n        // Find the maximum width of text and size the class accordingly\r\n        let measuredNameText = canvasContext.measureText(this.title + this.Origin).width;\r\n        let maxWidth = Math.max(measuredNameText + padding*2, this.width);\r\n        this.contentHeight = 0;\r\n\r\n        // Iterate over all content text lines\r\n        for (let i = 0; i < this.content.length; i++) {\r\n            let measuredText = canvasContext.measureText(this.content[i]);\r\n            maxWidth = Math.max(maxWidth, measuredText.width, measuredNameText);\r\n            this.contentHeight += this.fontSize+padding;\r\n        }\r\n\r\n        if(!this.hasContent()){\r\n            this.contentHeight = 0\r\n        }\r\n\r\n        if (maxWidth > this.width) {\r\n            this.width = maxWidth\r\n        }\r\n\r\n        // Configure drawing for shadows\r\n        // And generally make it look nice\r\n        canvasContext.shadowOffsetX = 2.0; canvasContext.shadowOffsetY = 2.0;\r\n        this.iconAreaHeight = (iconHeight + (iconPadding * 2)) * iconListLen;\r\n\r\n        // Update rect height\r\n        // Use this to force text to fit\r\n        if (this.content[0] !== \"\") {\r\n            this.realHeight = padding * 4 + this.height + this.iconAreaHeight + this.contentHeight;\r\n        }else{\r\n            this.realHeight = padding * 2 + this.height + this.iconAreaHeight\r\n        }\r\n\r\n        // Draw rect\r\n        \r\n        canvasContext.fillStyle = this.colour;\r\n        canvasContext.fillRect(this.x, this.y, this.width, this.realHeight);\r\n        canvasContext.strokeRect(this.x, this.y, this.width, this.realHeight);\r\n\r\n\r\n        if (this.content[0] !== \"\") {\r\n            canvasContext.strokeRect(this.x, this.y, this.width, this.height+this.iconAreaHeight+padding*2);\r\n        }\r\n\r\n        // Draw selected markers if rect is selected\r\n        if (this.selected) {\r\n            canvasContext.fillStyle = \"#000000\";\r\n            drawMarker(this.x, this.y);\r\n            drawMarker(this.x+this.width, this.y);\r\n            drawMarker(this.x, this.y+this.realHeight);\r\n            drawMarker(this.x+this.width, this.y+this.realHeight);\r\n        }\r\n\r\n        // Draw Icons by filename\r\n        let yPos = this.y + iconPadding;\r\n        let xPos = this.x + this.width + iconPadding;\r\n\r\n        function loadImage(imageElement) {\r\n            let sh = imageElement.height;\r\n            let sw = imageElement.width;\r\n            let scale = iconHeight / sh;\r\n            canvasContext.drawImage(imageElement, xPos-(iconPadding*2)-(sw*scale), yPos, sw * scale, sh * scale);\r\n            yPos += iconHeight + (iconPadding * 2); // What's the point of this line? yPos should be out of scope when this method is run\r\n\r\n        }\r\n\r\n        for (let i = 0; i < this.icons[0].length; i++) {\r\n\r\n            if (this.icons[1][i] === true) {\r\n                if (this.icons[2][i] === true) {\r\n                    this.increaseWidthIfNecessary(canvasContext, iconHeight + canvasContext.measureText(\"<< \" + this.icons[0][i] + \" >>\").width);\r\n                }\r\n\r\n                let element = this.imageElements[this.icons[0][i]];\r\n\r\n                \r\n                if (element === undefined) {\r\n\r\n                    let imageElement = new Image();\r\n                    imageElement.src = serverURL + \"/icons/\" + this.icons[0][i];\r\n                    imageElement.crossOrigin = \"anonymous\";\r\n\r\n                    imageElement.onload = () => {\r\n                        loadImage(imageElement);\r\n                        this.imageElements[this.icons[0][i]] = imageElement\r\n                    };\r\n                } else {\r\n                    loadImage(element)\r\n                }\r\n            } else {\r\n                yPos += iconHeight + (iconPadding * 2);\r\n            }\r\n            \r\n        } \r\n\r\n        // Reset color for text\r\n        canvasContext.fillStyle = \"#000000\";\r\n\r\n        // Draw Height for text that will be increased to draw downward\r\n        let dy = padding+this.fontSize;\r\n\r\n        // Disable shadows for text\r\n        canvasContext.shadowOffsetX = 0.0; canvasContext.shadowOffsetY = 0.0;\r\n\r\n        let txPos = this.x + iconPadding;\r\n        let tyPos = this.y + iconHeight;\r\n\r\n        for (let i = 0; i < this.icons[0].length; i++) {\r\n            if (this.icons[2][i] === true) {\r\n                if (this.icons[1][i] !== true) {\r\n                    this.increaseWidthIfNecessary(canvasContext, canvasContext.measureText(\"<< \" + this.icons[0][i] + \" >>\").width);\r\n                }\r\n\r\n                let name = \"<< \" + this.icons[0][i].slice(0, -4) + \" >>\";\r\n                if (this.icons[0][i].slice(-6, -4) === \"_n\") {\r\n                    name = \"\";\r\n                }\r\n\r\n                canvasContext.fillText(name, txPos, tyPos);\r\n            }\r\n            tyPos += iconHeight + (iconPadding * 2);\r\n        }\r\n\r\n        // Draw name\r\n        this.increaseWidthIfNecessary(canvasContext, canvasContext.measureText(this.Origin + this.title).width);\r\n\r\n        if(this.isAbstract) {\r\n            canvasContext.font = \"italic \" + this.fontSize + \"px Segoe UI\";\r\n        }else{\r\n            canvasContext.font = this.fontSize + \"px Segoe UI\";\r\n        }\r\n\r\n        canvasContext.fillText(this.Origin + this.title , this.x+padding, this.y+dy+this.iconAreaHeight);\r\n        dy = padding*2 +this.height + this.contentHeight;\r\n\r\n        canvasContext.font = this.fontSize+\"px Segoe UI\";\r\n\r\n        // Draw text\r\n        for (let i = 0; i < this.content.length; i++) {\r\n            this.increaseWidthIfNecessary(canvasContext, canvasContext.measureText(this.content[i]).width + padding*2);\r\n            canvasContext.fillText(this.content[i], this.x+padding, this.y+dy+this.iconAreaHeight);\r\n            dy += this.fontSize + padding;\r\n        }\r\n\r\n        canvasContext.strokeStyle = \"black\"\r\n    }\r\n\r\n    // Checks if it intersects with point\r\n    intersects(x, y) {\r\n        if (x < this.x) return false;\r\n        if (y < this.y) return false;\r\n        if (x > this.x+this.width) return false;\r\n        return y <= this.y + this.realHeight;\r\n\r\n    }\r\n\r\n    // Gets the nearest side, in Arrow compatible x,y percentage values\r\n    // Also returns a threshold distance\r\n    // Parameters are the cursor X and Y coordinates\r\n    // Return value:\r\n    //      [threshold, xRel, yRel]\r\n    //\r\n    // If threshold is -1, xRel and yRel are equal to cursorX, cursorY\r\n    // This only happens when cursor shouldn't connect to vertex\r\n    getNearestSideFrom(cursorX, cursorY) {\r\n\r\n        // Else\r\n        return this.getNearestSide(cursorX, cursorY);\r\n    }\r\n\r\n    getNearestSide(cursorX, cursorY) {\r\n        // Create possibilities\r\n        let sides = [];\r\n\r\n        // If can connect to top/bottom\r\n        if (cursorX > this.x && cursorX < this.x+this.width) {\r\n            //console.log(\"success\");\r\n            let xPercentage = (cursorX-this.x)/this.width;\r\n\r\n            sides.push([Math.abs(cursorY-(this.y)), xPercentage, 0]);\r\n            sides.push([Math.abs(cursorY-(this.y+this.realHeight)), xPercentage, 1]);\r\n        }\r\n\r\n        // If can connect to left/right\r\n        else if (cursorY > this.y && cursorY < this.y+(this.realHeight)) {\r\n            //console.log(\"success\");\r\n            let yPercentage = (cursorY-this.y)/(this.realHeight);\r\n\r\n            sides.push([Math.abs(cursorX-(this.x)), 0, yPercentage]);\r\n            sides.push([Math.abs(cursorX-(this.x+this.width)), 1, yPercentage]);\r\n        }\r\n\r\n        // Can't connect\r\n\r\n        let goodSide = false;\r\n\r\n        sides.forEach((side) => {\r\n            if(side[0] < distanceThreshold){\r\n                goodSide = true;\r\n            }\r\n        });\r\n\r\n        if(goodSide === false && cursorX > this.x && cursorX < this.x + this.width && cursorY > this.y && cursorY < this.y+this.realHeight){\r\n                // click was inside the vertex but not in tolerance\r\n                //console.log(\"trying things\")\r\n                let yPercentage = (cursorY-this.y)/(this.realHeight);\r\n                let xPercentage = (cursorX-this.x)/this.width;\r\n\r\n                // find closest side\r\n                let rightDist = Math.abs(xPercentage-1)*this.width;\r\n                let topDist = yPercentage*this.realHeight;\r\n                let leftDist = xPercentage*this.width;\r\n                let bottomDist = yPercentage*this.realHeight;\r\n\r\n                let closestIndex = 0;\r\n                let closestDistance = leftDist;\r\n                let distArrays = [leftDist,rightDist,topDist,bottomDist];\r\n\r\n                // no need to go through leftDist here as its already set as shortest\r\n                for(let i = 1; i< distArrays.length-1; i++){\r\n                    if(distArrays[i] < closestDistance){\r\n                        closestDistance = distArrays[i];\r\n                        closestIndex = i;\r\n                    }\r\n                }\r\n\r\n                if ( closestIndex === 0 ){\r\n                    return [0, 0, yPercentage]\r\n                }\r\n                if ( closestIndex === 1 ){\r\n                    return [0, 1, yPercentage]\r\n                }\r\n                if ( closestIndex === 2 ){\r\n                    return [0, xPercentage, 0]\r\n                }\r\n                if ( closestIndex === 3 ){\r\n                    return [0, xPercentage, 1]\r\n                }\r\n        }\r\n\r\n        if(sides.length === 0){\r\n            return null\r\n        }\r\n\r\n        // Return side with shortest distance\r\n        let shortest = sides[0];\r\n        for (let i = 1; i < sides.length; i++) {\r\n            if (sides[i][0] < shortest[0]) {\r\n                shortest = sides[i];\r\n            }\r\n        }\r\n        return shortest;\r\n    }\r\n\r\n}","import React from 'react';\r\nimport { createSaveState } from '../Serialisation/NewFileManager';\r\nimport * as canvasDraw from \"./CanvasDraw\";\r\nimport { getFolderNameFromKey, getVertexData} from './ContainmentTree';\r\nimport { Tool } from './LeftMenu';\r\n\r\nlet selectMultiple = false;\r\nlet selectDown = false;\r\nlet savedObjects = [];\r\nexport let selectedCanvasObject = null;\r\n\r\n\r\nexport class Canvas extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.canvasRef = React.createRef();\r\n\r\n        this.state = {}\r\n    }\r\n\r\n\r\n\r\n    componentDidMount() {\r\n        this.zoom = this.props.mainState.zoomLevel;\r\n        this.tool = this.props.mainState.drawMode;\r\n\r\n        document.getElementById(\"Canvas\").addEventListener('dragenter', this.dragEnter);\r\n        document.getElementById(\"Canvas\").addEventListener('dragover', this.dragOver);\r\n        document.getElementById(\"Canvas\").addEventListener('dragleave', this.dragLeave);\r\n        document.getElementById(\"Canvas\").addEventListener('drop', this.drop);\r\n\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.getElementById(\"Canvas\").removeEventListener('dragenter', this.dragEnter);\r\n        document.getElementById(\"Canvas\").removeEventListener('dragover', this.dragOver);\r\n        document.getElementById(\"Canvas\").removeEventListener('dragleave', this.dragLeave);\r\n        document.getElementById(\"Canvas\").removeEventListener('drop', this.drop);\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        this.zoom = this.props.mainState.zoomLevel;\r\n        this.tool = this.props.mainState.drawMode;\r\n    }\r\n\r\n    dragEnter(e) {\r\n        e.preventDefault();\r\n    }\r\n    \r\n    dragOver(e) {\r\n        e.preventDefault();\r\n    }\r\n    \r\n    dragLeave(e) {\r\n        return 0\r\n    }\r\n    \r\n    drop(e) {\r\n        if(canvasDraw.getCurrentModel() <= 0){ // stops the user dragging and dropping without a model being selected\r\n            console.log(\"attempted to drag and drop vertex while there are no available models to draw on\");\r\n            window.alert(\"You need to create and select a graph first before you can start drawing!\");\r\n        }\r\n        else{\r\n            console.log('dropped')\r\n            console.log(canvasDraw.getCurrentModel())\r\n            //Find the vertex object that was dragged\r\n            let droppedSemanticID = e.dataTransfer.getData('text/plain');\r\n            let droppedVertex = 0;\r\n            for(let vert of getVertexData()){\r\n                if (vert.semanticIdentity.UUID === droppedSemanticID)\r\n                droppedVertex = vert;\r\n            }\r\n            //console.log(droppedVertex)\r\n            //get canvas relative coordinates for where the object was dropped\r\n            let mouseCoords = canvasDraw.getGraphXYFromMouseEvent(e)\r\n\r\n            let newName = droppedVertex.text.replace(\" \",\"\");\r\n            newName = newName.replace(\" \",\"\")\r\n            let newColour;\r\n            let visibilityCheck = false;\r\n\r\n            //check if selected model is located in the same package or not\r\n            if(droppedVertex.parentRenderKey !== canvasDraw.getCurrentRenderKey()){\r\n                newColour = \"#FFFFFF\";\r\n                visibilityCheck = true; //used to determine if the vertex has an origin package added\r\n            }\r\n            else{\r\n            \r\n                newColour = droppedVertex.colour;\r\n            }\r\n\r\n\r\n        //create the vertex object(size 30x15) and place it\r\n            let canvasVert = canvasDraw.createVertex(mouseCoords[0],mouseCoords[1],droppedVertex.width,droppedVertex.height,newName,\r\n            droppedVertex.content,newColour,droppedVertex.icons,droppedVertex.imageElements,droppedVertex.fontSize,droppedVertex.semanticIdentity)\r\n            if(visibilityCheck === true){\r\n                //add origin package\r\n                let originText = getFolderNameFromKey(droppedVertex.parentRenderKey)\r\n                originText = originText.replace(\" \",\"\")\r\n                originText = originText.replace(\" \",\"\")\r\n                canvasVert.setOrigin(originText + \" :: \")\r\n            }\r\n            canvasDraw.addObject(canvasVert)\r\n            canvasDraw.drawAll()\r\n\r\n            createSaveState() //Used for undo/redo functionality\r\n        }\r\n\r\n        //canvas\r\n        //mouseStartX\r\n        //mouseStartY\r\n        //x mose+10\r\n        //x mouse +10\r\n\r\n    }\r\n\r\n\r\n\r\n    // prevent context (right-click) menu from appearing\r\n    ocm = (e) => {\r\n        e.preventDefault();\r\n    };\r\n    // What happens if u click anywhere on the canvas\r\n    mouseDown = (e, canvas) => {\r\n        let position = canvasDraw.getGraphXYFromMouseEvent(e);\r\n        let x = position[0]; let y = position[1];\r\n        this.setState({\r\n            startX: x,\r\n            startY: y\r\n        });\r\n\r\n        //toggle shift key to move all connected\r\n        if (e.shiftKey && !selectDown) {\r\n            selectDown = true;\r\n        }\r\n        // If it was a left click\r\n        if (e.button === 0 && !selectMultiple) {\r\n            let intersection = canvasDraw.findIntersected(x, y);\r\n            selectedCanvasObject = intersection\r\n            // check if there's an object\r\n            if (intersection !== null) {\r\n                //if object is a box, move the object\r\n                if (canvas.tool === Tool.Select && intersection.typeName === \"Vertex\") {\r\n                    e.preventDefault();\r\n                    // brings up the menu\r\n                    this.props.setLeftMenu(canvasDraw.findIntersected(x, y));\r\n                    canvasDraw.onMiddleClick(canvas, x, y,null,selectDown);\r\n                    //console.log(selectDown);\r\n\r\n                } else {\r\n                    this.props.setLeftMenu(canvasDraw.findIntersected(x, y));\r\n                    canvasDraw.saveBlockStates(canvas, x, y, 1);\r\n                    canvasDraw.onLeftMousePress(canvas, x, y);\r\n                }\r\n\r\n              } else { //clicked nothing\r\n            this.props.setLeftMenu(canvasDraw.findIntersected(x, y));\r\n            canvasDraw.saveBlockStates(canvas, x, y, 1);\r\n            canvasDraw.onLeftMousePress(canvas, x, y);\r\n            }\r\n        }\r\n        \r\n        //toggles ctrl key to be active for selecting multiple.\r\n        //detoggles in mouseup\r\n        if (e.ctrlKey && !selectMultiple) {\r\n            selectMultiple = true;\r\n        }\r\n\r\n        //mouse down\r\n        if (e.button === 0 && selectMultiple) {\r\n            \r\n            let intersection = canvasDraw.findIntersected(x, y);\r\n            // check if there's an object\r\n            if (intersection === null) {\r\n                this.props.setLeftMenu(intersection, false, savedObjects);\r\n                savedObjects = [];\r\n                selectMultiple = false;\r\n\r\n            }\r\n            if (intersection !== null) {\r\n                //console.log(selectMultiple);\r\n                // Remove dupes\r\n                let foundEnd = 0;\r\n                //start at 0\r\n                while (foundEnd < savedObjects.length-1){\r\n                    //stop @ second last one\r\n                    //check RHS for duplicates\r\n                    //found+1 because wanna look at box after the one we looking at\r\n                    for (let ob = foundEnd+1; ob < savedObjects.length; ob++){\r\n                        if(savedObjects[foundEnd].x === savedObjects[ob].x && savedObjects[foundEnd].y === savedObjects[ob].y ){\r\n                            savedObjects.splice(ob); // if it's the same, delete it and slide array back one\r\n                        }\r\n                    }\r\n                    foundEnd++;\r\n                }\r\n                //ideally want to push in the first object that has already been selected\r\n                console.log(savedObjects);\r\n                savedObjects.push(canvasDraw.findIntersected(x, y));\r\n                canvasDraw.onMiddleClick(canvas, x, y, savedObjects)\r\n                \r\n                for(let i = 0; i <savedObjects.length; i++) {\r\n                    this.props.setLeftMenu(savedObjects[i], selectMultiple);\r\n                }\r\n                \r\n\r\n            }\r\n        }\r\n\r\n\r\n\r\n\r\n        // If it was a middle click\r\n        if (e.button === 1) {\r\n            e.preventDefault();\r\n            canvasDraw.onMiddleClick(canvas, x, y)\r\n        }\r\n\r\n\r\n    };\r\n\r\n    mouseUp = (e, canvas) =>{\r\n\r\n        canvasDraw.solidifyObject();\r\n\r\n        let position = canvasDraw.getGraphXYFromMouseEvent(e);\r\n        let x = position[0]; let y = position[1];\r\n\r\n        // If it was a left click\r\n        if (e.button === 0) {\r\n            if (canvas.tool === Tool.Select) {\r\n                canvasDraw.drawAll()\r\n            }\r\n\t\t\telse {\r\n                canvasDraw.onLeftMouseRelease(canvas, x, y);\r\n            }\r\n\r\n        }\r\n\r\n        // if it was a right click\r\n        if (e.button === 2) {\r\n\r\n           // deleted the old rightclick functionality and will leave this if statement here for when we implement right click menu - cooper\r\n           \r\n\t\t\t\r\n        }\r\n\t\tif (e.shiftKey && selectDown) {\r\n            selectDown = false;\r\n        }\r\n\r\n        if (e.button === 1) {\r\n            window.setTimeout(() => {canvasDraw.solidifyObject()},200)\r\n\r\n        }\r\n\t\tif (canvasDraw.blockBeenSelected === true){\r\n\t\t\tcanvasDraw.checkCollision(selectedCanvasObject);\r\n\t\t}\r\n\t\t\r\n    };\r\n\r\n    mouseLeave() {\r\n        canvasDraw.onMouseLeave()\r\n    }\r\n\r\n    render() {\r\n        return <canvas ref={this.canvasRef} id=\"drawCanvas\" onContextMenu={(e) => this.ocm(e)} onMouseDown={(e) => this.mouseDown(e, this)} onMouseUp={(e) => this.mouseUp(e, this)} onMouseLeave={(e) => this.mouseLeave(e,this)}>\r\n                <p> HTML5 Canvas elements are not supported by your browser</p>\r\n            </canvas>\r\n    }\r\n\r\n}\r\n\r\nwindow.addEventListener(\"resize\",canvasDraw.resetMouseOrigin);\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport { Vertex } from \"../DataStructures/Vertex\";\r\nimport { Arrow } from \"../DataStructures/Arrow\";\r\nimport { Tool } from \"./LeftMenu\";\r\nimport { Graph } from \"../DataStructures/Graph\";\r\nimport {getModelNameFromKey, handleAddVertex, vertexData} from \"./ContainmentTree\";\r\nimport { createSaveState } from \"../Serialisation/NewFileManager\";\r\nimport {selectedCanvasObject} from \"./Canvas\"\r\n\r\n//false unless the onMouseMove function is executing, Is used to stop vertex created with leftmenu tool creating multiple vertex's when dragging for an inital size\r\nlet dragging = false;\r\n\r\n// Core variables\r\nlet canvasElement;\r\nlet canvasContext;\r\n\r\n// Mouse / Cursor\r\nlet mouseStartX;\r\nlet mouseStartY;\r\n\r\nlet previousObject;\r\nlet startX, startY, endX, endY;\r\n\r\nlet yRows = 70;\r\n\r\nexport var mouseOriginX;\r\nexport var mouseOriginY;\r\n\r\n// Non zoomed in Width/Height (in pixels)\r\nlet canvasWidth;\r\nlet canvasHeight;\r\n\r\n// Zoom and Pan\r\nlet zoom = 200.0;\r\n\r\n// Renderable objects\r\nexport var currentObjects = new Graph();\r\n\r\nexport var savedArrows = [];\r\n\r\n// The naming conventions here are terrible, but basically the render keys determine where\r\n// a tree view element is placed in the graph while the model functions determine what's \r\n// actually being rendered\r\n\r\nexport let currentRenderKey = 0;\r\nexport let totalRenderKeys = 0\r\n\r\nexport let currentModel = 0;\r\nexport let totalModels = 0;\r\n\r\nexport function setTotalRenderKey(newData){\r\n    totalRenderKeys = newData;\r\n}\r\nexport function setTotalModelKeys(newData){\r\n    totalModels = newData;\r\n}\r\n\r\nexport function getCurrentRenderKey() {\r\n    return currentRenderKey;\r\n}\r\n\r\nexport function setNewRenderKey(newKey) {\r\n    currentRenderKey = newKey;\r\n}\r\n\r\nexport function getTotalRenderKeys() {\r\n    return totalRenderKeys;\r\n}\r\n\r\nexport function incrementTotalRenderKeys() {\r\n    totalRenderKeys = totalRenderKeys += 1;\r\n}\r\n\r\nexport function getCurrentObjects() {\r\n    return currentObjects;\r\n}\r\n\r\n// --- Model Key Stuff --- //\r\n\r\nexport function getCurrentModel() {\r\n    return currentModel;\r\n}\r\n\r\nexport function setNewModel(newModel) {\r\n    currentModel = newModel;\r\n    try {\r\n        document.getElementById(\"SelectedModel\").value = getModelNameFromKey(newModel)\r\n    } catch (error) {\r\n        \r\n    }\r\n    \r\n\r\n}\r\n\r\nexport function getTotalModels() {\r\n    return totalModels;\r\n}\r\n\r\nexport function incrementTotalModels() {\r\n    totalModels = totalModels += 1;\r\n}\r\n\r\n\r\n\r\n\r\n// Arrow Path\r\nexport var arrowPath = [];\r\nlet lastX = 0;\r\nlet lastY = 0;\r\n\r\n\r\n// Resize status\r\nlet resizing = false;\r\n\r\nlet arrowType = 0;\r\nlet firstArrowJoint = true;\r\n\r\nlet cancelDraw = false;\r\n\r\n//Block Past location var\r\nlet past_location = [];\r\nlet past_size = [];\r\nlet selectedObject;\r\nexport var blockBeenSelected = false;\r\n\r\n// Init\r\nexport function assignElement(elementID) {\r\n    canvasElement = document.getElementById(elementID);\r\n    canvasContext = canvasElement.getContext(\"2d\");\r\n\r\n    resetMouseOrigin();\r\n\r\n}\r\n\r\n\r\n\r\nexport function resetMouseOrigin() {\r\n    try {\r\n        let canvasRect = canvasElement.getBoundingClientRect();\r\n        mouseOriginX = canvasRect.left;\r\n        mouseOriginY = canvasRect.top;\r\n        recalculateScale();\r\n        clearCanvas();\r\n    } catch {\r\n        console.error(\"Failed to acquire canvas element\");\r\n    }\r\n    drawAll()\r\n}\r\n\r\n// Core functions\r\nexport function drawAll() {\r\n    updateArrows();\r\n    clearCanvas();\r\n\r\n    canvasContext.resetTransform();\r\n    canvasContext.scale(getEffectiveZoom(), getEffectiveZoom());\r\n\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item !== null) {\r\n            //console.log(\"HERE \" + item.typeName)\r\n            //Only render the objects which are in the currently selected containment\r\n\r\n            if (item.getModelKey() === currentModel) {\r\n                /*\r\n                if (item.typeName === \"Vertex\"){\r\n                    console.log(\"Item is set as present\")\r\n                    item.setPresent();\r\n                }\r\n                */\r\n                item.draw(canvasContext);\r\n\r\n            }\r\n\r\n            /*\r\n            else if (item.getModelKey() !== currentModel && item.typeName === \"Vertex\"){\r\n                console.log(\"Item is sent away\")\r\n                item.setAway();\r\n                //console.log(\"The item to not be rendered is\" + item.typeName);\r\n            }\r\n            */\r\n\r\n        }\r\n    });\r\n\r\n}\r\n\r\nexport function deleteElement(element) {\r\n    if (element !== null) {\r\n        if (!currentObjects.remove(element)) {\r\n            console.error(\"Failed to delete object with UUID %s\", element.semanticIdentity.UUID);\r\n        }\r\n    } else {\r\n        console.error(\"Attempted to delete a null element\");\r\n    }\r\n\r\n    drawAll()\r\n}\r\n\r\n//this is the same as the above, except when you're deleting a vertex with an arrow connected the edge connection code freaks out.\r\n//this here deletes any arrows connected to the vertex before deleting the vertex to get around this\r\nexport function vertexDeleteElement(element) {\r\n    console.log(\"vDeleteE occurs\")\r\n    //find the UUID of the vertex for arrow dest and source matching\r\n    //let selectedVertUUID = element.semanticIdentity.UUID;\r\n\r\n    //Get the arrow UUID's\r\n    let sourceUUIDs = currentObjects.ArrowUUIDSource(element);\r\n    let destUUIDs = currentObjects.ArrowUUIDDest(element);\r\n    //find an arrow with matching source/dest if they exist\r\n\r\n    sourceUUIDs.forEach(element => currentObjects.remove(element.arrow));\r\n    destUUIDs.forEach(element => currentObjects.remove(element.arrow))\r\n\r\n    //Now that the arrows are out of the way, we're safe to delete the vertex (same code as above)\r\n    if (element !== null) {\r\n        console.log(\"vdl if staement pass\")\r\n        if (!currentObjects.remove(element)) {\r\n            \r\n            console.error(\"Failed to delete object with UUID %s\", element.semanticIdentity.UUID);\r\n        }\r\n    } else {\r\n        console.error(\"Attempted to delete a null element\");\r\n    }\r\n\r\n    drawAll()\r\n\r\n}\r\n\r\nexport function updateRows() {\r\n    yRows = document.getElementById(\"canvasRows\").value;\r\n    drawAll()\r\n}\r\n\r\n// Format co-ordinate so that the value aligns with a row\r\nfunction findNearestGridY(y, top) {\r\n\r\n    // distance to topmost top rowLine\r\n    let slotHeight = canvasHeight / yRows * zoom / 100 * 200 / zoom;\r\n\r\n    // which row to put it in\r\n    let slot = Math.floor(y / slotHeight);\r\n\r\n    // y co-ordinate of that row (if bottom then go up by row gap)\r\n    return slotHeight * slot + (slotHeight / 2 * + top)\r\n}\r\n\r\n// Checks to see which side it should resize on\r\nfunction checkResizeBounds(x, y) {\r\n    // Iterate through all objects and only check vertices\r\n    let currentObjectsFlattened = currentObjects.flatten();\r\n    for (let i = 0; i < currentObjectsFlattened.length; i++) {\r\n        let item = currentObjectsFlattened[i];\r\n\r\n        if (item.typeName === \"Vertex\") {\r\n            // Get vertex bounds\r\n            // x1 y1 are the lower coordinates\r\n            // x2 y2 are the upper coordinates\r\n            // Note: x2 y2 are not width/height values\r\n\r\n            //tolerance in px\r\n            let tolerance = 10;\r\n\r\n            let bounds = item.getBounds();\r\n            let x1 = bounds[0];\r\n            let y1 = bounds[1];\r\n            let x2 = bounds[2];\r\n            let y2 = bounds[3];\r\n\r\n            let top = Math.abs(y1 - y) < tolerance;\r\n            let bottom = Math.abs(y2 - y) < tolerance;\r\n            let left = Math.abs(x1 - x) < tolerance;\r\n            let right = Math.abs(x2 - x) < tolerance;\r\n            let inYBounds = y > y1 && y < y2;\r\n            let inXBounds = x > x1 && x < x2;\r\n\r\n            if (right && inYBounds) {\r\n                return [item, \"right\"];\r\n            }\r\n\r\n            if (top && left) {\r\n                return [item, \"topLeft\"];\r\n            } else if (top && right) {\r\n                return [item, \"topRight\"];\r\n            } else if (bottom && left) {\r\n                return [item, \"bottomLeft\"];\r\n            } else if (bottom && right) {\r\n                return [item, \"bottomRight\"];\r\n            } else if (left && inYBounds) {\r\n                return [item, \"left\"];\r\n            } if (right && inYBounds) {\r\n                return [item, \"right\"];\r\n            } else if (top && inXBounds) {\r\n                return [item, \"top\"];\r\n            } else if (bottom && inXBounds) {\r\n                return [item, \"bottom\"];\r\n            }\r\n        }\r\n    }\r\n\r\n    // All else fails\r\n    return [null, null];\r\n}\r\n\r\nexport const distanceThreshold = 15;\r\n\r\n// Find connectable for arrow within a threshold distance\r\nfunction getConnectionDataForArrow(cursorX, cursorY) {\r\n    const angleThreshold = 8;\r\n\r\n    let nearest = null;\r\n    let nearestDistance = 0;\r\n\r\n    // Find nearest connectable\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item !== null) {\r\n            if (item.typeName === \"Vertex\") {\r\n                let sideData = item.getNearestSideFrom(cursorX, cursorY, lastX, lastY);\r\n                // Only check if valid\r\n                if (sideData !== null && sideData[0] < distanceThreshold) {\r\n                    // Compare dist\r\n                    if (nearest === null || sideData[0] < nearestDistance) {\r\n                        nearest = [0, item.semanticIdentity.UUID, sideData[1], sideData[2]];\r\n                        nearestDistance = sideData[0];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // Set coordinates\r\n    let coordinate = nearest;\r\n    if (nearest === null) {\r\n        coordinate = [1, cursorX, cursorY];\r\n    }\r\n\r\n    // If can't snap to right angles\r\n    if (arrowPath.length < 1 || coordinate[0] === 0) return { coord: coordinate, snapped: nearest !== null, nearest: nearest };\r\n\r\n    // Get angle\r\n    let lastPathX = arrowPath[arrowPath.length - 1][1];\r\n    let lastPathY = arrowPath[arrowPath.length - 1][2];\r\n    let x = coordinate[1] - lastPathX;\r\n    let y = coordinate[2] - lastPathY;\r\n\r\n    // must be y,x check documentation if you dont believe me\r\n    let angle = Math.atan2(y, x) * (180 / Math.PI);\r\n    // Make positive\r\n    angle = (angle + 360) % 360;\r\n    // Get relative\r\n    let relAngle = angle % 90;\r\n\r\n    // Check if it should snap to right angles\r\n    if (relAngle > 90 - angleThreshold || relAngle < angleThreshold) {\r\n        // Get length\r\n        let l = getDistance(0, 0, x, y);\r\n\r\n        // Choose angle\r\n        let angles = [0, 90, 180, 270, 360];\r\n        let nearestAngle = angles[0];\r\n        for (let i = 1; i < angles.length; i++) {\r\n            if (Math.abs(angles[i] - angle) < Math.abs(nearestAngle - angle)) {\r\n                nearestAngle = angles[i];\r\n            }\r\n        }\r\n        let nearestRad = nearestAngle * (Math.PI / 180);\r\n\r\n        // Create vector\r\n        let xv = l * Math.cos(nearestRad);\r\n        let yv = l * Math.sin(nearestRad);\r\n\r\n        // Create point (not vector sitting on 0,0)\r\n        coordinate = [coordinate[0], lastPathX + xv, lastPathY + yv];\r\n\r\n\r\n    }\r\n\r\n    return { coord: coordinate, snapped: nearest !== null, nearest: nearest }\r\n}\r\n\r\nexport function getSelectedObject(canvas) {\r\n    return canvas.props.mainState.selectedObject\r\n}\r\n\r\nfunction resizeObjectOnMouseMove(e, resizeVars) {\r\n    let coords = getGraphXYFromMouseEvent(e);\r\n\r\n    resizeVars[0].expandSide(resizeVars[1], coords[0], coords[1], canvasContext);\r\n\r\n    //grab object and arrows connected to it\r\n    // update arrows\r\n    updateA();\r\n    \r\n    \r\n}\r\n\r\n// Sets the objects uuid and adds it to the root of currentObjects\r\nexport function addObject(object) {\r\n    if (object === null || object === undefined) return;\r\n    currentObjects.add(object);\r\n}\r\n\r\n// Sets the currentObjects value to a new one. WARNING it will override the current value without any checks\r\nexport function setCurrentObjects(newObjects) {\r\n    currentObjects = newObjects;\r\n    drawAll();\r\n}\r\n\r\nexport function newFile() {\r\n    // Confirm\r\n    let r = window.confirm(\"Are you sure, this will clear the current canvas!\");\r\n    if (r === true) {\r\n        console.log(\"Clearing canvas\");\r\n        window.location.reload();\r\n    } else {\r\n        console.log(\"User opted to not clear the canvas\");\r\n    }\r\n\r\n    // Redraw\r\n    drawAll(currentObjects);\r\n}\r\n\r\nfunction arrowToolSelected() {\r\n    return arrowType === Tool.Visibility || arrowType === Tool.Edge || arrowType === Tool.Specialisation\r\n}\r\n\r\nexport function getObjectFromUUID(UUID) {\r\n    let foundObject;\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.semanticIdentity.UUID === UUID) {\r\n            foundObject = item;\r\n        }\r\n    });\r\n    return foundObject;\r\n}\r\n\r\n\r\nfunction findNearestArrowPointIndex(x, y) {\r\n    let nearestPointIndex = -1;\r\n    // Nearest distance here is used as a tolerance variable\r\n    let nearestDistance = 30;\r\n    let cDist;\r\n    let nearestArrow = null;\r\n\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.typeName === \"Arrow\") {\r\n            item.path.forEach((point) => {\r\n                cDist = Math.hypot(x - point[0], y - point[1]);\r\n                console.log(cDist);\r\n                if (cDist < nearestDistance) {\r\n                    nearestDistance = cDist;\r\n                    nearestPointIndex = item.path.indexOf(point);\r\n                    nearestArrow = item\r\n                }\r\n            });\r\n        }\r\n    });\r\n    return [nearestPointIndex, nearestArrow]\r\n}\r\n\r\nfunction StickArrowToObject(connectionData, arrow, index) {\r\n    // so the line sticks to object\r\n    if (connectionData['snapped'] === false) {\r\n        let coord = connectionData['coord'];\r\n        // update the arrow\r\n        arrow.path[index] = [coord[1], coord[2]]\r\n    } else {\r\n        let vertexUUID = connectionData['nearest'][1];\r\n        let vertex = getObjectFromUUID(vertexUUID);\r\n\r\n        if (vertex !== undefined) {\r\n            arrow.path[index] = arrow.rebuildPath()\r\n        }\r\n    }\r\n}\r\n\r\nfunction moveArrowPointOnMouseMove(e, index, arrow) {\r\n    let x, y;\r\n    [x, y] = getGraphXYFromMouseEvent(e);\r\n    let conData = getConnectionDataForArrow(x, y);\r\n    arrow.pathData[index] = conData['nearest'];\r\n    StickArrowToObject(conData, arrow, index);\r\n\r\n\r\n}\r\n\r\n\r\n// Event based functions\r\nexport function onLeftMousePress(canvas, x, y) {\r\n\r\n    // Checks if your mouse is in range of the borders of a box to resize them\r\n    let resizeVars = checkResizeBounds(x, y);\r\n    if (canvas.tool === Tool.Vertex || canvas.tool === Tool.Select) {\r\n        if (resizeVars[0] !== null) {\r\n            if (resizeVars[0] === getSelectedObject(canvas)) {\r\n                saveBlockStates(canvas, x, y);\r\n                resizing = true;\r\n                canvasElement.onmousemove = function (e) {\r\n                    resizeObjectOnMouseMove(e, resizeVars);\r\n\r\n                };\r\n                \r\n                return;\r\n            }\r\n        } else {\r\n        }\r\n\r\n\r\n\r\n        let intersection = findIntersected(x, y);\r\n        if (canvas.tool === Tool.Vertex && intersection !== null) {\r\n            //console.log(\"Selecting intersected Vertex\");\r\n            canvas.props.setLeftMenu(intersection);\r\n            canvas.props.setMode(Tool.Select);\r\n            cancelDraw = true;\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    if (canvas.tool === Tool.Select) {\r\n        let index, arrow;\r\n        [index, arrow] = findNearestArrowPointIndex(x, y);\r\n        //console.log(index, arrow);\r\n        if (arrow === getSelectedObject(canvas)) {\r\n            if (index !== -1) {\r\n                resizing = true;\r\n                let func = function (e) {\r\n                    moveArrowPointOnMouseMove(e, index, arrow)\r\n                };\r\n\r\n\r\n                canvasElement.addEventListener(\"mousemove\", func);\r\n                canvasElement.addEventListener(\"mouseup\", () => {\r\n                    canvasElement.removeEventListener(\"mousemove\", func);\r\n                    console.log(\"removed\")\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    mouseStartX = x;\r\n    mouseStartY = y;\r\n\r\n\r\n\r\n    // Enable example draw while user is deciding shape\r\n    canvasElement.onmousemove = function (e) { onMouseMove(e, canvas) }\r\n\r\n\r\n}\r\n\r\n//aligning lines when large box moved\r\nexport function checkArrowsConnectedToBox(Object) {\r\n    // check arrows which one matches the box that was moved by its ID \r\n\r\n    // check how much the box has changed\r\n    let objectID;\r\n\r\n    let arrowArray = [];\r\n\r\n    resizing = true;\r\n    objectID = Object.semanticIdentity.UUID;\r\n    console.log(objectID);\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.typeName === \"Arrow\") {\r\n            let conData = 0;\r\n            //If the object is connected to destination\r\n            if (objectID === item.destVertexUUID) {\r\n                arrowArray.push(item);\r\n\r\n                // get connection data calcs min dist to travel and hopefully it's straight up\r\n                // first object destination y is less than object y\r\n                if (item.path[0][1] < Object.y) {\r\n                    conData = getConnectionDataForArrow(item.path[0][0], Object.y);\r\n                }\r\n                else {\r\n                    conData = getConnectionDataForArrow(item.path[0][0], Object.y + Object.height);\r\n                }\r\n                item.pathData[1] = conData['nearest'];\r\n                console.log(\"dest one\")\r\n                StickArrowToObject(conData, item, 1);\r\n\r\n                //If the object is connected to Source\r\n            } else if (objectID === item.sourceVertexUUID) {\r\n                arrowArray.push(item);\r\n                if (item.path[1][1] < Object.y) {\r\n                    conData = getConnectionDataForArrow(item.path[1][0], Object.y);\r\n                }\r\n                else {\r\n                    conData = getConnectionDataForArrow(item.path[1][0], Object.y + Object.height);\r\n                }\r\n                item.pathData[0] = conData['nearest'];\r\n                console.log(\"source one\");\r\n                StickArrowToObject(conData, item, 0);\r\n\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    resizing = false;\r\n\r\n\r\n}\r\n\r\nexport function checkHorizArrowsConnectedToBox(Object) {\r\n    let objectID;\r\n\r\n    let arrowArray = [];\r\n\r\n    resizing = true;\r\n    objectID = Object.semanticIdentity.UUID;\r\n    console.log(objectID);\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.typeName === \"Arrow\") {\r\n            let conData = 0;\r\n            //If the object is connected to destination\r\n            if (objectID === item.destVertexUUID) {\r\n                arrowArray.push(item);\r\n\r\n                if (item.path[0][0] < Object.x) {\r\n                    conData = getConnectionDataForArrow(Object.x + 1, item.path[0][1]);\r\n                }\r\n                else {\r\n                    conData = getConnectionDataForArrow(Object.x + Object.width - 1, item.path[0][1]);\r\n                }\r\n                item.pathData[1] = conData['nearest'];\r\n                console.log(\"dest one\")\r\n                StickArrowToObject(conData, item, 1);\r\n\r\n                //If the object is connected to Source\r\n            } else if (objectID === item.sourceVertexUUID) {\r\n                arrowArray.push(item);\r\n                if (item.path[1][0] < Object.x) {\r\n                    conData = getConnectionDataForArrow(Object.x + 1, item.path[0][1]);\r\n                }\r\n                else {\r\n                    conData = getConnectionDataForArrow(Object.x + Object.width - 1, item.path[0][1]);\r\n                }\r\n                item.pathData[0] = conData['nearest'];\r\n                console.log(\"source one\");\r\n                StickArrowToObject(conData, item, 0);\r\n\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    resizing = false;\r\n\r\n\r\n}\r\n\r\n\r\n//save the position of the clicked variable as global\r\nexport function saveBlockStates(canvas, x, y) {\r\n    selectedObject = getSelectedObject(canvas);\r\n    if (getSelectedObject(canvas) === null) {\r\n        selectedObject = findIntersected(x, y);\r\n    }\r\n    if (selectedCanvasObject !== null) {\r\n        blockBeenSelected = true;\r\n\r\n        //console.log(\"Block States Have been Saved\");\r\n        past_location = [selectedCanvasObject.x, selectedCanvasObject.y];\r\n        past_size = [selectedCanvasObject.width, selectedCanvasObject.height];\r\n    }\r\n}\r\n\r\nexport function setArrowType(type) {\r\n    arrowType = type\r\n}\r\n\r\n//make sure boxes don't collide\r\nexport function checkCollision(canvasObject) {\r\n    //console.log(\"Collision Tests:\");\r\n    let object = canvasObject\r\n    let CollideCount = 0;\r\n    //console.log(past_size);\r\n    // for loop to check all boxes in the list\r\n    if (currentObjects.flatten() !== null && object !== null) {\r\n        currentObjects.flatten().forEach((item) => {\r\n            if (item.typeName === \"Vertex\") {\r\n                //make sure coords are > coords of box u just placed + its width\r\n                if (object.x === item.x && object.y === item.y) {\r\n                    //console.log(\"collides with itself\");\r\n                }\r\n                // error of 10 pixels for item's height\r\n                else if ((object.y > (item.y + item.height + 10)) || (object.x > (item.x + item.width))\r\n                    || (item.x > (object.x + object.width)) || (item.y > (object.y + object.height + 10))) {\r\n                }\r\n                else {\r\n                    // revert to past stored location\r\n                    object.x = past_location[0];\r\n                    object.y = past_location[1];\r\n                    object.width = past_size[0];\r\n                    object.height = past_size[1];\r\n                    CollideCount++;\r\n                    //console.log(\"Collided\");\r\n                }\r\n            }\r\n        });\r\n        // as long as never collided, change to new location\r\n        if (CollideCount === 0) {\r\n            past_location = [object.x, object.y];\r\n            past_size = [object.width, object.height]\r\n            //console.log(CollideCount);\r\n        }\r\n        blockBeenSelected = false;\r\n        drawAll(currentObjects);\r\n    }\r\n}\r\n\r\n\r\nexport function onRightMouseRelease(canvas, x, y) {\r\n    let ET = findIntersected(x, y);\r\n    if (arrowToolSelected() && ET !== null) {\r\n        // Create\r\n\r\n        let newObject = createObject(canvas, mouseStartX, mouseStartY, x, y);\r\n\r\n        // Reset path\r\n        arrowPath = [];\r\n        firstArrowJoint = true;\r\n\r\n        addObject(newObject);\r\n\r\n        // Disable example draw\r\n        canvasElement.onmousemove = null;\r\n        drawAll(currentObjects);\r\n\r\n        canvas.props.setLeftMenu(newObject)\r\n        canvas.props.setMode(Tool.Select);\r\n    }\r\n}\r\n\r\nexport function updateA() {\r\n    let conData = 0;\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.typeName === \"Arrow\") {\r\n\r\n            conData = getConnectionDataForArrow(item.path[1][0], item.path[1][1]);\r\n            item.pathData[1] = conData['nearest'];\r\n            StickArrowToObject(conData, item, 0);\r\n\r\n\r\n        }\r\n    });\r\n}\r\nexport function compareSizesToMoveAll(Object) {\r\n\r\n    //for loop to get all the arrows\r\n    //for loop to check destination and source\r\n    //if object ID is equal \r\n    //find whichever one is not the currently selected block\r\n    // if it's smaller move it else do nothing\r\n\r\n    let objectID;\r\n    let verticalArray = [];\r\n    let horizontalArray = [];\r\n    let box;\r\n    let boxArray = [];\r\n    let allArrows = [];\r\n\r\n    objectID = Object.semanticIdentity.UUID;\r\n    console.log(Object);\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.typeName === \"Arrow\") {\r\n\r\n            //If the object is connected to destination\r\n            if (objectID === item.destVertexUUID) {\r\n                box = getObjectFromUUID(item.sourceVertexUUID);\r\n                if ((box.height + 10) * box.width < (Object.height + 10) * Object.width) {\r\n                    boxArray.push(box);\r\n\r\n                }\r\n                //check if arrow is on top/ below\r\n                if (item.path[0][1] < Object.y || item.path[0][1] > Object.y + Object.height + 10) {\r\n                    //push to vertical array\r\n                    verticalArray.push(item);\r\n                }\r\n                //check if arrow is left/ right\r\n                else if (item.path[0][0] < Object.x || item.path[0][0] > Object.x + Object.width) {\r\n                    //push to horizontal array\r\n                    horizontalArray.push(item);\r\n                }\r\n\r\n\r\n\r\n            }\r\n            //If the object is connected to Source\r\n            else if (objectID === item.sourceVertexUUID) {\r\n                box = getObjectFromUUID(item.destVertexUUID);\r\n                if ((box.height + 10) * box.width < (Object.height + 10) * Object.width) {\r\n                    boxArray.push(box);\r\n                }\r\n                //check if arrow is on top/ below\r\n                if (item.path[1][1] < Object.y || item.path[1][1] > Object.y + Object.height + 10) {\r\n                    //push to vertical array\r\n                    verticalArray.push(item);\r\n\r\n                }\r\n                //check if arrow is left/ right\r\n                else if (item.path[1][0] < Object.x || item.path[1][0] > Object.x + Object.width) {\r\n                    //push to horizontal array\r\n                    horizontalArray.push(item);\r\n                }\r\n\r\n            }\r\n\r\n            allArrows.push(item);\r\n        }\r\n\r\n    });\r\n    return [boxArray, verticalArray, horizontalArray, allArrows];\r\n}\r\n\r\nexport function checkBoxSizesAndReturnBigBox(first, second) {\r\n    if ((first.width) * (first.height + 10) <= (second.width) * (second.height + 10)) {\r\n        return [second, first];\r\n    } else {\r\n        return [first, second];\r\n    }\r\n}\r\n\r\n//line intersect\r\nexport function lineIntersect(canvas, x, y, secondObject) {\r\n    endX = 0;\r\n    endY = 0;\r\n\r\n    startX = 0;\r\n    startY = 0;\r\n\r\n    console.log(\"\\n \\n arrow path: \" + arrowPath + \"\\n\\n\");\r\n    arrowPath = [];\r\n\r\n    //previous object is below\r\n    if (previousObject.y > y && previousObject.x + previousObject.width > x) {\r\n        console.log(\"\\n\\n\\n prev object was below \\n\\n\\n\");\r\n        startY = previousObject.y;\r\n        startX = previousObject.x + (0.5 * previousObject.width);\r\n\r\n        endY = secondObject.y + secondObject.height + 10;\r\n        endX = secondObject.x + (0.5 * secondObject.width);\r\n\r\n    }\r\n    // previous object is above\r\n    else if (previousObject.y < y && previousObject.x + previousObject.width > x && previousObject.x < x) {\r\n        console.log(\"\\n\\n\\n prev object was above \\n\\n\\n\");\r\n        startY = previousObject.y + previousObject.height + 10; //+ means go to bottom\r\n        startX = previousObject.x + (0.5 * previousObject.width);\r\n\r\n        endY = secondObject.y;\r\n        endX = secondObject.x + (0.5 * secondObject.width);\r\n    }\r\n    //previous object is left of //if you click higher it counts as above\r\n\r\n    //sizes based on Total Area\r\n    let blockPre = previousObject.height + previousObject.width;\r\n    let blockSec = secondObject.height + secondObject.width;\r\n\r\n    //previous object is below\r\n    if (previousObject.y > (secondObject.y + secondObject.height + 10)) {\r\n        //console.log(\"\\n\\n\\n prev object was below \\n\\n\\n\");\r\n        //if previous is inside second range\r\n        if ((previousObject.x > secondObject.x) && ((previousObject.x + previousObject.width) < (secondObject.x + secondObject.width))) {\r\n            startY = previousObject.y;\r\n            startX = previousObject.x + (0.5 * previousObject.width);\r\n\r\n            endY = startY - (startY - (secondObject.y + secondObject.height + 10));\r\n            endX = startX;\r\n        }\r\n        //if second is inside previous range\r\n        else if ((previousObject.x < secondObject.x) && ((previousObject.x + previousObject.width) > (secondObject.x + secondObject.width))) {\r\n            startY = secondObject.y + secondObject.height + 10;\r\n            startX = secondObject.x + (0.5 * secondObject.width);\r\n\r\n            endY = startY + (previousObject.y - startY);\r\n            endX = startX;\r\n        }\r\n        //If pre is downLeft of sec extend whichever box is bigger horizontally and fit\r\n        else if ((previousObject.x < secondObject.x) && ((previousObject.x + previousObject.width) < (secondObject.x + secondObject.width))) {\r\n            if (blockPre <= blockSec) {\r\n                secondObject.width = secondObject.width + (secondObject.x - previousObject.x);\r\n                secondObject.x = previousObject.x;\r\n\r\n                startY = previousObject.y;\r\n                startX = secondObject.x + previousObject.width / 2;\r\n                endY = secondObject.y + secondObject.height;\r\n                endX = startX;\r\n                //second obj is changing size\r\n                checkArrowsConnectedToBox(secondObject);\r\n\r\n            }\r\n            if (blockPre >= blockSec) {\r\n                previousObject.width = previousObject.width + ((secondObject.x + secondObject.width) - (previousObject.x + previousObject.width));\r\n\r\n                startY = secondObject.y + secondObject.height;\r\n                startX = secondObject.x + secondObject.width / 2;\r\n                endY = previousObject.y;\r\n                endX = startX;\r\n                //prev obj is changing size\r\n\r\n                //this one works\r\n                checkArrowsConnectedToBox(previousObject);\r\n            }\r\n        }\r\n        //If pre is downright of sec extend whichever box is better horizontally and fit\r\n        else if (previousObject.x > secondObject.x) {\r\n            if (blockPre <= blockSec) {\r\n                secondObject.width = secondObject.width + ((previousObject.x + previousObject.width) - (secondObject.x + secondObject.width));\r\n\r\n                startY = previousObject.y;\r\n                startX = previousObject.x + previousObject.width / 2;\r\n                endY = secondObject.y + secondObject.height;\r\n                endX = startX;\r\n                //second obj is changing size\r\n\r\n                checkArrowsConnectedToBox(secondObject, endX - startX, endY - startY);\r\n            }\r\n            if (blockPre >= blockSec) {\r\n                previousObject.width = previousObject.width + (previousObject.x - secondObject.x);\r\n                previousObject.x = secondObject.x;\r\n\r\n                startY = secondObject.y + secondObject.height;\r\n                startX = secondObject.x + secondObject.width / 2;\r\n                endY = previousObject.y;\r\n                endX = startX;\r\n                //prev obj is changing size\r\n\r\n                checkArrowsConnectedToBox(previousObject);\r\n            }\r\n        }\r\n    }\r\n    // previous object is above\r\n    else if (previousObject.y + previousObject.height + 10 < secondObject.y) {\r\n        //console.log(\"\\n\\n\\n prev object was above \\n\\n\\n\");\r\n        //if previous is inside second range\r\n        if ((previousObject.x > secondObject.x) && ((previousObject.x + previousObject.width) < (secondObject.x + secondObject.width))) {\r\n            startY = previousObject.y + previousObject.height;\r\n            startX = previousObject.x + (0.5 * previousObject.width);\r\n\r\n            endY = startY - (startY - (secondObject.y));\r\n            endX = startX;\r\n        }\r\n        //if second is inside previous range\r\n        else if ((previousObject.x < secondObject.x) && ((previousObject.x + previousObject.width) > (secondObject.x + secondObject.width))) {\r\n            startY = secondObject.y;\r\n            startX = secondObject.x + (0.5 * secondObject.width);\r\n\r\n            endY = startY + previousObject.height + (previousObject.y - startY);\r\n            endX = startX;\r\n        }\r\n        //If pre is upLeft of sec extend whichever box is better horizontally and fit\r\n        else if ((previousObject.x < secondObject.x) && ((previousObject.x + previousObject.width) < (secondObject.x + secondObject.width))) {\r\n            if (blockPre <= blockSec) {\r\n                secondObject.width = secondObject.width + (secondObject.x - previousObject.x);\r\n                secondObject.x = previousObject.x;\r\n\r\n                startY = previousObject.y + previousObject.height;\r\n                startX = secondObject.x + previousObject.width / 2;\r\n                endY = secondObject.y;\r\n                endX = startX;\r\n                //second obj is changing size\r\n\r\n                //fixed\r\n                checkArrowsConnectedToBox(secondObject);\r\n            }\r\n            if (blockPre >= blockSec) {\r\n                previousObject.width = previousObject.width + ((secondObject.x + secondObject.width) - (previousObject.x + previousObject.width));\r\n\r\n\r\n                startY = secondObject.y;\r\n                startX = secondObject.x + secondObject.width / 2;\r\n                endY = previousObject.y + previousObject.height;\r\n                endX = startX;\r\n                //previous obj is changing size\r\n\r\n                checkArrowsConnectedToBox(previousObject);\r\n            }\r\n        }\r\n        //If pre is upright of sec extend whichever box is bigger horizontally and fit\r\n        else if (previousObject.x > secondObject.x) {\r\n            if (blockPre <= blockSec) {\r\n                secondObject.width = secondObject.width + ((previousObject.x + previousObject.width) - (secondObject.x + secondObject.width));\r\n\r\n                startY = previousObject.y + previousObject.height;\r\n                startX = previousObject.x + previousObject.width / 2;\r\n                endY = secondObject.y;\r\n                endX = startX;\r\n                //previous obj is changing size\r\n\r\n                //this one is fixed\r\n                checkArrowsConnectedToBox(secondObject);\r\n            }\r\n            if (blockPre >= blockSec) {\r\n                previousObject.width = previousObject.width + (previousObject.x - secondObject.x);\r\n                previousObject.x = secondObject.x;\r\n\r\n                startY = secondObject.y;\r\n                startX = secondObject.x + secondObject.width / 2;\r\n                endY = previousObject.y + previousObject.height;\r\n                endX = startX;\r\n\r\n                //second obj is changing size\r\n\r\n                checkArrowsConnectedToBox(previousObject);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    //previous object is left \r\n    else if (previousObject.x + previousObject.width < secondObject.x) {\r\n\r\n        //Previous is smaller\r\n        if (previousObject.y > secondObject.y && previousObject.y + previousObject.height + 10 < secondObject.y + secondObject.height + 10) {\r\n            startY = previousObject.y + (previousObject.height + 10) / 2;\r\n            startX = previousObject.x + previousObject.width;\r\n\r\n            endX = secondObject.x;\r\n            endY = startY;\r\n\r\n        }\r\n        //Second is smaller\r\n        else if (secondObject.y > previousObject.y && secondObject.y + secondObject.height + 10 < previousObject.y + previousObject.height + 10) {\r\n            startY = secondObject.y + (secondObject.height + 10) / 2;\r\n            startX = secondObject.x;\r\n\r\n            endX = previousObject.x + previousObject.width;\r\n            endY = startY;\r\n\r\n        }\r\n        //Top Left and peeking\r\n        else if (previousObject.y + previousObject.height + 10 > secondObject.y && secondObject.y > previousObject.y) {\r\n            if (blockPre <= blockSec) {\r\n                secondObject.height = secondObject.height + (secondObject.y - previousObject.y);\r\n                secondObject.y = previousObject.y;\r\n\r\n                startY = previousObject.y + (previousObject.height + 10) / 2;\r\n                startX = previousObject.x + previousObject.width;\r\n                endX = secondObject.x;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(secondObject);\r\n\r\n                console.log(\"m\");\r\n            }\r\n\r\n            if (blockPre >= blockSec) {\r\n                let increase = previousObject.height + 10 + ((secondObject.y + secondObject.height) - (previousObject.y + previousObject.height));\r\n                //looks at x coord and y coord and @ that coord checks if there's a box\r\n                //resizeVars[0] returns the box if there is a\r\n                //resizeVars[1] is which side/corner of the box that its coords are expected to be at (else null)\r\n                let resizeVars = checkResizeBounds(previousObject.x + previousObject.width, previousObject.y + previousObject.height + 10);\r\n                console.log(resizeVars);\r\n                resizeVars[0].expandSide(resizeVars[1], previousObject.x + previousObject.width, previousObject.y + increase, canvasContext);\r\n\r\n\r\n                startY = secondObject.y + (secondObject.height + 10) / 2;\r\n                startX = secondObject.x;\r\n\r\n                endX = previousObject.x + previousObject.width;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(previousObject);\r\n\r\n                console.log(\"n\");\r\n            }\r\n        }\r\n        //Bottom Left and peeking\r\n        else if (secondObject.y + secondObject.height + 10 > previousObject.y && previousObject.y + previousObject.height + 10 > secondObject.y + secondObject.height + 10) {\r\n            if (blockPre <= blockSec) {\r\n\r\n                let increase = secondObject.y + secondObject.height + 10 + ((previousObject.y + previousObject.height + 10) - (secondObject.y + secondObject.height + 10));\r\n\r\n                let resizeVars = checkResizeBounds(secondObject.x + secondObject.width, secondObject.y + secondObject.height + 10);\r\n                console.log(resizeVars);\r\n                resizeVars[0].expandSide(resizeVars[1], secondObject.x + secondObject.width, increase, canvasContext);\r\n\r\n\r\n                startY = previousObject.y + (previousObject.height + 10) / 2;\r\n                startX = secondObject.x;\r\n\r\n                endX = previousObject.x + previousObject.width;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(secondObject);\r\n\r\n                console.log(\"o\");\r\n            }\r\n\r\n            if (blockPre >= blockSec) {\r\n                previousObject.height = previousObject.height + 10 + (previousObject.y - secondObject.y);\r\n                previousObject.y = secondObject.y;\r\n\r\n                startY = secondObject.y + (secondObject.height + 10) / 2;\r\n                startX = secondObject.x;\r\n\r\n                endX = previousObject.x + previousObject.width;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(previousObject);\r\n\r\n                console.log(\"p\");\r\n            }\r\n        }\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    //Previous object is right side\r\n    else if (previousObject.x > (secondObject.x + secondObject.width)) {\r\n\r\n        //Previous is smaller and on inside\r\n        if (previousObject.y > secondObject.y && previousObject.y + previousObject.height < secondObject.y + secondObject.height) {\r\n            startY = previousObject.y + (previousObject.height + 10) / 2;\r\n            startX = previousObject.x;\r\n\r\n            endX = secondObject.x + secondObject.width;\r\n            endY = startY;\r\n\r\n        }\r\n        //Second is smaller and on inside\r\n        else if (secondObject.y > previousObject.y && secondObject.y + secondObject.height < previousObject.y + previousObject.height) {\r\n            startY = secondObject.y + (secondObject.height + 10) / 2;\r\n            startX = secondObject.x + secondObject.width;\r\n\r\n            endX = previousObject.x;\r\n            endY = startY;\r\n\r\n            console.log(\"r\");\r\n        }\r\n        //Top Right and peeking\r\n        else if (previousObject.y + previousObject.height + 10 > secondObject.y && secondObject.y > previousObject.y) {\r\n            if (blockPre <= blockSec) {\r\n                secondObject.height = secondObject.height + 10 + (secondObject.y - previousObject.y);\r\n                secondObject.y = previousObject.y;\r\n\r\n                startY = previousObject.y + (previousObject.height + 10) / 2;\r\n                startX = previousObject.x;\r\n\r\n                endX = secondObject.x + secondObject.width;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(secondObject);\r\n\r\n                console.log(\"s\");\r\n            }\r\n\r\n            if (blockPre >= blockSec) {\r\n                previousObject.height = previousObject.height + 10 + ((secondObject.y + secondObject.height + 10) - (previousObject.y + previousObject.height + 10));\r\n\r\n                startX = secondObject.x + secondObject.width;\r\n                startY = secondObject.y + (secondObject.height + 10) / 2;\r\n\r\n                endX = previousObject.x;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(previousObject);\r\n\r\n                console.log(\"t\");\r\n            }\r\n\r\n        }\r\n        //Bottom Left and peeking\r\n        else if (secondObject.y + secondObject.height + 10 < previousObject.y + previousObject.height + 10 && previousObject.y < secondObject.y + secondObject.height + 10) {\r\n            if (blockPre <= blockSec) {\r\n                let increase = secondObject.height + 10 + ((previousObject.y + previousObject.height + 10) - (secondObject.y + secondObject.height + 10));\r\n                let resizeVars = checkResizeBounds(secondObject.x + secondObject.width, secondObject.y + secondObject.height + 10);\r\n                console.log(resizeVars);\r\n                resizeVars[0].expandSide(resizeVars[1], secondObject.x + secondObject.width, secondObject.y + increase, canvasContext);\r\n\r\n\r\n                startY = previousObject.y + (previousObject.height + 10) / 2;\r\n                startX = previousObject.x;\r\n\r\n                endX = secondObject.x + secondObject.width;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(secondObject);\r\n\r\n                console.log(\"u\");\r\n            }\r\n\r\n            if (blockPre >= blockSec) {\r\n                let increase = previousObject.height + 10 + (previousObject.y - secondObject.y);\r\n                let resizeVars = checkResizeBounds(previousObject.x + previousObject.width, previousObject.y + previousObject.height + 10);\r\n                console.log(resizeVars);\r\n                resizeVars[0].expandSide(resizeVars[1], previousObject.x + previousObject.width, previousObject.y + increase, canvasContext);\r\n\r\n                previousObject.y = secondObject.y;\r\n\r\n\r\n                startX = previousObject.x;\r\n                startY = secondObject.y + (secondObject.height + 10) / 2;\r\n\r\n                endX = secondObject.x + secondObject.width;\r\n                endY = startY;\r\n\r\n                checkHorizArrowsConnectedToBox(previousObject);\r\n\r\n                console.log(\"v\");\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    arrowPath.push(getConnectionDataForArrow(startX, startY).coord);\r\n\r\n\r\n    let newObject = createObject(canvas, startX, startY, endX, endY);\r\n\r\n\r\n\r\n    return newObject;\r\n\r\n\r\n\r\n}\r\n//\r\nexport function collectMehBox(boxes, arrows, bigbox, item, index) {\r\n\r\n    //console.log(\"runningcollect\");\r\n    if (bigbox.semanticIdentity.UUID === item.destVertexUUID) {\r\n        let box = getObjectFromUUID(item.sourceVertexUUID);\r\n        if ((bigbox.y) * index + (box.y) * (1 - index) > (box.y + box.height + 10) * index + (bigbox.y + bigbox.height + 10) * (1 - index)) {\r\n            boxes.push(box);\r\n            arrows.push(item);\r\n        }\r\n\r\n\r\n    } else if (bigbox.semanticIdentity.UUID === item.sourceVertexUUID) {\r\n        let box = getObjectFromUUID(item.destVertexUUID);\r\n        if ((bigbox.y) * index + (box.y) * (1 - index) > (box.y + box.height + 10) * index + (bigbox.y + bigbox.height + 10) * (1 - index)) {\r\n            boxes.push(box);\r\n            arrows.push(item);\r\n        }\r\n    }\r\n    return [boxes, arrows];\r\n}\r\n//Will arrange boxes and arrows in linked order above or below the big box.\r\n//Bigbox - The larger important box\r\n//boxes - list of all the boxes being moved\r\n//arrows - arrows connect to the above boxes\r\n//index - denotes the side that boxes are connected to \r\nexport function arrangeboxesandarrows(bigbox, boxes, arrows, index) {\r\n    //index = 1 = up\r\n    if (boxes.length >= 2) {\r\n        let b = 0;\r\n        let x = bigbox.x;\r\n        let y = bigbox.y + (bigbox.height + 30) * (1 - index);\r\n        for (b; b < boxes.length; b++) {\r\n            boxes[b].x = x;\r\n            boxes[b].y = y - ((boxes[b].height + 30) * index);\r\n            x = x + boxes[b].width + 20;\r\n\r\n            if (boxes[b].x + boxes[b].width > bigbox.x + bigbox.width) {\r\n                bigbox.width = bigbox.width + boxes[b].width\r\n            }\r\n        }\r\n        b = 0;\r\n        for (b; b < boxes.length; b++) {\r\n            console.log(arrows[b]);\r\n            let conData = getConnectionDataForArrow(boxes[b].x + boxes[b].width / 2, bigbox.y + (bigbox.height + 10) * (1 - index));\r\n            arrows[b].pathData[1] = conData['nearest'];\r\n            StickArrowToObject(conData, arrows[b], 1);\r\n        }\r\n    }\r\n}\r\n//\r\nexport function collectsidebox(boxes, arrows, bigbox, item, index) {\r\n\r\n    if (bigbox.semanticIdentity.UUID === item.destVertexUUID) {\r\n        let box = getObjectFromUUID(item.sourceVertexUUID);\r\n        if ((bigbox.x) * index + (box.x) * (1 - index) > (box.x + box.width) * index + (bigbox.x + bigbox.width) * (1 - index)) {\r\n            boxes.push(box);\r\n            arrows.push(item);\r\n        }\r\n\r\n\r\n    } else if (bigbox.semanticIdentity.UUID === item.sourceVertexUUID) {\r\n        let box = getObjectFromUUID(item.destVertexUUID);\r\n        if ((bigbox.x) * index + (box.x) * (1 - index) > (box.x + box.width) * index + (bigbox.x + bigbox.width) * (1 - index)) {\r\n            boxes.push(box);\r\n            arrows.push(item);\r\n        }\r\n    }\r\n    return [boxes, arrows];\r\n}\r\nexport function arrangeboxesandarrowshorizontal(bigbox, boxes, arrows, index) {\r\n    //index = 0 = right\r\n    if (boxes.length >= 2) {\r\n        let b = 0;\r\n        let x = bigbox.x + (bigbox.width + 30) * (1 - index);\r\n        let y = bigbox.y;\r\n        for (b; b < boxes.length; b++) {\r\n            boxes[b].x = x - ((boxes[b].width + 30) * index);\r\n            boxes[b].y = y;\r\n            y = y + boxes[b].height + 20;\r\n            //extending box\r\n            if (boxes[b].y + boxes[b].height + 10 > bigbox.y + bigbox.height + 10) {\r\n                bigbox.height = bigbox.height + boxes[b].height;\r\n            }\r\n        }\r\n        b = 0;\r\n        for (b; b < boxes.length; b++) {\r\n            console.log(arrows[b]);\r\n            let conData = getConnectionDataForArrow(bigbox.x + (bigbox.width) * (1 - index), boxes[b].y + (boxes[b].height + 10) / 2);\r\n            arrows[b].pathData[1] = conData['nearest'];\r\n            StickArrowToObject(conData, arrows[b], 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport function shiftBoxes(secondObject) {\r\n    //if box is within horizontal bounds\r\n\r\n    let upBoxes = [];\r\n    let upArrows = [];\r\n    let downBoxes = [];\r\n    let downArrows = [];\r\n    let leftBoxes = [];\r\n    let leftArrows = [];\r\n    let rightBoxes = [];\r\n    let rightArrows = [];\r\n    let [bigBox, smallBox] = checkBoxSizesAndReturnBigBox(previousObject, secondObject);\r\n\r\n    //grab all arrows connected to either object\r\n    //Index 0 means down index 1 means up\r\n\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item.typeName === \"Arrow\") {\r\n            //get the big box because it has all the arrows connected\r\n            if (bigBox.y + bigBox.height + 10 < smallBox.y && smallBox.x > bigBox.x && smallBox.x + smallBox.width < bigBox.x + bigBox.width) {\r\n                [downBoxes, downArrows] = collectMehBox(downBoxes, downArrows, bigBox, item, 0);\r\n\r\n\r\n            } else if (bigBox.y > (smallBox.y + smallBox.height + 10) && smallBox.x > bigBox.x && smallBox.x + smallBox.width < bigBox.x + bigBox.width) {\r\n                [upBoxes, upArrows] = collectMehBox(upBoxes, upArrows, bigBox, item, 1);\r\n\r\n            } else if (bigBox.x > smallBox.x + smallBox.width && smallBox.y > bigBox.y && smallBox.y + smallBox.height + 10 < bigBox.y + bigBox.height + 10) {\r\n                console.log(\"left ran\");\r\n                [leftBoxes, leftArrows] = collectsidebox(leftBoxes, leftArrows, bigBox, item, 1);\r\n\r\n            } else if (bigBox.x + bigBox.width < smallBox.x && smallBox.y > bigBox.y && smallBox.y + smallBox.height + 10 < bigBox.y + bigBox.height + 10) {\r\n                console.log(\"right ran\");\r\n                [rightBoxes, rightArrows] = collectsidebox(rightBoxes, rightArrows, bigBox, item, 0);\r\n            }\r\n        }\r\n    });\r\n    //Do stuff to boxes\r\n    //1 = up\r\n    //0 = down\r\n    arrangeboxesandarrows(bigBox, downBoxes, downArrows, 0);\r\n    arrangeboxesandarrows(bigBox, upBoxes, upArrows, 1);\r\n\r\n    arrangeboxesandarrowshorizontal(bigBox, leftBoxes, leftArrows, 1);\r\n    arrangeboxesandarrowshorizontal(bigBox, rightBoxes, rightArrows, 0);\r\n\r\n    //console.log(downboxes.length);\r\n\r\n\r\n\r\n}\r\n\r\nexport function onLeftMouseRelease(canvas, x, y) {\r\n\r\n\r\n    if (cancelDraw) {\r\n        cancelDraw = false;\r\n        return;\r\n    }\r\n\r\n    if (resizing === true) {\r\n        resizing = false;\r\n        canvasElement.onmousemove = null;\r\n        return\r\n    }\r\n\r\n    // Disable example draw\r\n    canvasElement.onmousemove = null;\r\n\r\n    if (arrowToolSelected()) {\r\n        \r\n\r\n        if (getConnectionDataForArrow(x, y).snapped && !firstArrowJoint) {\r\n            // Create\r\n            let secondObject = findIntersected(x, y);\r\n            let newObject = null;\r\n            let firstObject = arrowPath[0] // the first position in the arrowpath array will either be null or the first vertex that is clicked with an arrow. \r\n                                            // therefor the arrow will not be created unless the first object that is clicked with the arrow tool is a vertex. - cooper\r\n            \r\n            if (firstObject !== null && secondObject !== null && savedArrows !== null) {\r\n                // create the arrow using the createObject function rather than the other function they were using as this seems much more stable - cooper\r\n                // also deleted a weird forloop that they had that i assume was for stopping the arrow overlap issue, but they themselves commented that it doesnt work\r\n                newObject = createObject(canvas, mouseStartX, mouseStartY, x, y); \r\n               \r\n            } \r\n\r\n            // Reset path\r\n            arrowPath = [];\r\n            firstArrowJoint = true;\r\n\r\n\r\n            if (newObject !== null) {\r\n                addObject(newObject);\r\n            }\r\n\r\n\r\n            drawAll(currentObjects);\r\n\r\n\r\n\r\n            //converting all arrows to savedArrows array\r\n            let i = 0;\r\n            currentObjects.flatten().forEach((item) => {\r\n                if (item.typeName === \"Arrow\") {\r\n                    savedArrows[i] = item.path;\r\n                    i++;\r\n                }\r\n\r\n            });\r\n\r\n            if (newObject !== null) {\r\n                canvas.props.setLeftMenu(newObject);\r\n            }\r\n\r\n            canvas.props.setMode(Tool.Select);\r\n            if (previousObject !== null && secondObject !== null) {\r\n                shiftBoxes(secondObject);\r\n            }\r\n            previousObject = null;\r\n\r\n\r\n        } else {\r\n            //maybe here where we can disable compound lines\r\n\r\n            //save object here\r\n            previousObject = findIntersected(x, y);\r\n            \r\n        \r\n\r\n            arrowPath.push(getConnectionDataForArrow(x, y).coord);\r\n            lastX = x;\r\n            lastY = y;\r\n            canvasElement.onmousemove = function (e) {\r\n                onMouseMove(e, canvas)\r\n            };\r\n            firstArrowJoint = false;\r\n        }\r\n\r\n    }\r\n\r\n    if (canvas.tool === Tool.Vertex) {\r\n        let newObject = createObject(canvas, mouseStartX, mouseStartY, x, y);\r\n        addObject(newObject);\r\n\r\n        canvas.props.setLeftMenu(newObject);\r\n        canvas.props.setMode(Tool.Select);\r\n        createSaveState();\r\n    }\r\n    if (canvas.tool === Tool.Artifact) {\r\n        let newObject = createArtifact(canvas, mouseStartX, mouseStartY);\r\n        addObject(newObject);\r\n\r\n        canvas.props.setLeftMenu(newObject);\r\n        canvas.props.setMode(Tool.Select);\r\n    }\r\n    if (canvas.tool === Tool.Container) {\r\n        let newObject = createContainer(canvas, mouseStartX, mouseStartY);\r\n        newObject.setColour(\"#FFFFFF\");\r\n        addObject(newObject);\r\n        canvas.props.setLeftMenu(newObject);\r\n        canvas.props.setMode(Tool.Select);\r\n    }\r\n\r\n\r\n\r\n\r\n    drawAll(currentObjects);\r\n\r\n}\r\n\r\nfunction onMouseMove(e, canvas) {\r\n    dragging = true;\r\n    let position = getGraphXYFromMouseEvent(e);\r\n\r\n    // Redraw Existing Objects\r\n    drawAll(currentObjects);\r\n\r\n    // Draw the new object\r\n    let newObject = createObject(canvas, mouseStartX, mouseStartY, position[0], position[1]);\r\n\r\n    canvasContext.globalAlpha = 0.75;\r\n    if (newObject !== null) {\r\n        newObject.draw(canvasContext);\r\n    }\r\n    canvasContext.globalAlpha = 1.0;\r\n    dragging = false;\r\n}\r\n\r\nexport function onMiddleClick(canvas, x, y, savedObjects = null, shiftDown = false) {\r\n\r\n    // selecting the object based on coordinate\r\n    // if it doesnt find an object dont run it\r\n\r\n    let selectedObject = findIntersected(x, y);\r\n\r\n    //compareSizesToMoveAll returns any connected vertices to the selected along with the arrows themselves to be updated\r\n    let [friendObject, arrowsVert, arrowsHoriz, allArrows] = compareSizesToMoveAll(selectedObject);\r\n\r\n        //If the selected block has a friend (connected by arrow) it will begin to try and identify friends of friends\r\n    if (friendObject !== null || friendObject.length >= 1) {\r\n        let ObjectsToCheck = friendObject;\r\n        let nextObjects = [];\r\n\r\n        //For loop to check all the closest friends (connected directly to selected )\r\n        for (let n = 0; n < ObjectsToCheck.length; n++) {\r\n            let [newfriendObject] = compareSizesToMoveAll(ObjectsToCheck[n]);\r\n            if (newfriendObject !== null) {\r\n\r\n                //for loop to check for duplicates and remove if any\r\n                for (let nf = 0; nf < newfriendObject.length; nf++) {\r\n                    console.log(ObjectsToCheck.length)\r\n                    for (let of = 0; of < ObjectsToCheck.length; of++) {\r\n                        //doesn't get run?:\r\n                        if (newfriendObject[nf].semanticIdentity.UUID === ObjectsToCheck[of].semanticIdentity.UUID) {\r\n                            newfriendObject.splice(nf, 1);\r\n                        }\r\n                    }\r\n                }\r\n                //Adds the objects that are connected to the friends to the friend list.\r\n                if (newfriendObject.length >= 1) {\r\n                    for (let p = 0; p < newfriendObject.length; p++) {\r\n                        nextObjects.push(newfriendObject[p]);\r\n                        friendObject.push(newfriendObject[p]);\r\n                    }\r\n\r\n                } \r\n            }\r\n           \r\n        }\r\n        //Updates the friendlist to begin a new search. \r\n        ObjectsToCheck = nextObjects; \r\n\r\n\r\n\r\n    }\r\n    let F = [];\r\n    if (friendObject !== null) {\r\n        let i = 0;\r\n        for (i; i < friendObject.length; i++) {\r\n            F.push([x - friendObject[i].x, y - friendObject[i].y]); //distance from mouse to actual object's x, y\r\n            //console.log(F);\r\n        }\r\n    }\r\n\r\n    let S = []; //previous coords\r\n    if (savedObjects !== null) {\r\n        let i = 0;\r\n        for (i; i < savedObjects.length; i++) {\r\n            S.push([x - savedObjects[i].x, y - savedObjects[i].y]);\r\n            //console.log(F);\r\n        }\r\n    }\r\n\r\n    if (selectedObject !== null) {\r\n        saveBlockStates(canvas, x, y);\r\n        // check the distance between the mouse and the object\r\n        let saveDisX = x - selectedObject.x;\r\n        let saveDisY = y - selectedObject.y;\r\n\r\n\r\n        canvasElement.onmousemove = function (e) { moveObject(e, selectedObject, friendObject, F, savedObjects, S, saveDisX, saveDisY, arrowsVert, arrowsHoriz, allArrows, shiftDown) }\r\n    }\r\n\r\n}\r\n\r\nexport function onMouseLeave() {\r\n    canvasElement.onmousemove = {};\r\n    firstArrowJoint = true;\r\n    drawAll()\r\n}\r\n\r\n// moving objects in respect to cursor values saveDisX, saveDisY\r\n// friends = the smaller boxes that are connected to the bigger box\r\nfunction moveObject(e, object, friends, F, savedObjects = null, S, saveDisX, saveDisY, arrowsVert, arrowsHoriz, allArrows, shiftDown) {\r\n    if (object != null) {\r\n        if (object.typeName === \"Vertex\") {\r\n            let position = getGraphXYFromMouseEvent(e);\r\n            let x = position[0] - saveDisX;\r\n            let y = position[1] - saveDisY;\r\n\r\n            //for loop iterate through all boxes assume they not empty\r\n            if (shiftDown) {\r\n                if (friends !== null) {\r\n                    let i = 0;\r\n                    //check friends' previous location and cursors location\r\n                    for (i; i < friends.length; i++) {\r\n                        friends[i].x = position[0] - F[i][0];\r\n                        friends[i].y = position[1] - F[i][1];\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (savedObjects !== null) {\r\n                let i = 0;\r\n                //check friends' previous location and cursors location\r\n                for (i; i < savedObjects.length; i++) {\r\n                    savedObjects[i].x = position[0] - S[i][0];\r\n                    savedObjects[i].y = position[1] - S[i][1];\r\n                }\r\n            }\r\n\r\n\r\n            \r\n            if (arrowsVert !== null) {\r\n                let conData = 0;\r\n                let j = 0;\r\n\r\n                for (j; j < arrowsVert.length; j++) {\r\n                    // source = one that's been clicked\r\n                    arrowsVert[j].path[1][0] = arrowsVert[j].path[0][0];\r\n                    conData = getConnectionDataForArrow(arrowsVert[j].path[1][0], arrowsVert[j].path[1][1]);\r\n\r\n\r\n                    \r\n\r\n                    \r\n                        StickArrowToObject(conData, arrowsVert[j], 0);\r\n                        //console.log(arrowsVert[j].path);\r\n                }\r\n            }\r\n            else if (arrowsHoriz !== null) {\r\n                let conData = 0;\r\n                let k = 0;\r\n                for (k; k < arrowsHoriz.length; k++) {\r\n                    // source = one that's been clicked\r\n                    arrowsHoriz[k].path[1][1] = arrowsHoriz[k].path[0][1];\r\n                    conData = getConnectionDataForArrow(arrowsHoriz[k].path[1][0], arrowsHoriz[k].path[1][1]);\r\n                    \r\n               \r\n\r\n                        StickArrowToObject(conData, arrowsHoriz[k], 0);\r\n                        //console.log(arrowsHoriz[k].path);\r\n                  \r\n                }\r\n            }\r\n            else if (allArrows !== null){\r\n            }\r\n\r\n            object.x = x;\r\n            object.y = y;\r\n\r\n            updateArrows();\r\n\r\n\r\n        } else if (object.typeName === \"Arrow\") {\r\n            return;\r\n\r\n        }\r\n    }\r\n}\r\nexport function updateArrows() {\r\n    let flattenedObjects = currentObjects.flatten();\r\n    flattenedObjects.forEach((item) => {\r\n        if (item !== null) {\r\n            if (item.typeName === \"Arrow\") {\r\n                item.rebuildPath();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nexport function solidifyObject() {\r\n    canvasElement.onmousemove = null;\r\n}\r\n\r\n// Zoom and pan\r\nexport function setZoom(newZoom) {\r\n    zoom = newZoom;\r\n\r\n    resetMouseOrigin();\r\n\r\n    drawAll();\r\n}\r\n\r\n// Useful for debugging\r\nexport function drawMarker(xpos, ypos) {\r\n    const radius = 2;\r\n    const lineWidth = 0.5;\r\n    const strokeColour = \"#007ACC\";\r\n    const fillColour = \"#007ACC55\";\r\n\r\n    let oldLineWidth = canvasContext.lineWidth;\r\n    canvasContext.lineWidth = lineWidth;\r\n    let oldStrokeStyle = canvasContext.strokeStyle;\r\n    canvasContext.strokeStyle = strokeColour;\r\n    let oldFillStyle = canvasContext.fillStyle;\r\n    canvasContext.fillStyle = fillColour;\r\n\r\n    canvasContext.globalAlpha = 1.0;\r\n    canvasContext.beginPath();\r\n    canvasContext.arc(xpos, ypos, radius, 0, Math.PI * 2, false);\r\n    canvasContext.fill();\r\n    canvasContext.stroke();\r\n    canvasContext.closePath();\r\n\r\n    canvasContext.lineWidth = oldLineWidth;\r\n    canvasContext.strokeStyle = oldStrokeStyle;\r\n    canvasContext.fillStyle = oldFillStyle;\r\n}\r\n\r\n// Gets the distance between x1, y1 and x2, y2\r\nexport function getDistance(x1, y1, x2, y2) {\r\n    return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\r\n}\r\n\r\n// Finds the object that is intersected with the cursor, returns null if no objects are intersected\r\nexport function findIntersected(x, y) {\r\n    let selectedItem = null;\r\n    currentObjects.flatten().forEach((item) => {\r\n        if (item !== null) {\r\n            if (item.intersects(x, y)) {\r\n                //console.log(\"Intersection detected with \", item.typeName);\r\n                selectedItem = item;\r\n            }\r\n        }\r\n    });\r\n    return selectedItem;\r\n}\r\n\r\nfunction createArtifact(canvas, x1, y1) {\r\n\r\n    if (canvas.tool === Tool.Artifact) {\r\n        // Get positions\r\n        let pos = orderCoordinates(x1, y1, x1 + 450, y1 + 50);\r\n        let vy1 = findNearestGridY(pos[1], 0);\r\n        let vy2 = findNearestGridY(pos[3], 0);\r\n\r\n        // Add vertex\r\n        return new Vertex({title: \"\", content: [\"\"], x:  pos[0], y:  findNearestGridY(y1, 1), width: pos[2] - pos[0], height: vy2 - vy1});\r\n        \r\n\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction createContainer(canvas, x1, y1) {\r\n\r\n    if (canvas.tool === Tool.Container) {\r\n        // Get positions\r\n        let pos = orderCoordinates(x1, y1, x1 + 100, y1 + 60);\r\n        let vy1 = findNearestGridY(pos[1], 0);\r\n        let vy2 = findNearestGridY(pos[3], 0);\r\n\r\n        // Add Container\r\n        let newVert =  new Vertex({title: \"new Container\", content: [\"\"], x: pos[0], y: findNearestGridY(y1, 1), width: pos[2] - pos[0], height: vy2 - vy1});\r\n        newVert.setIsContainer(true);\r\n        return newVert;\r\n\r\n    }\r\n    return null;\r\n}\r\n\r\n//Links the container with the mirrorSemantic to the container with the Base (Mirror becomes base)\r\n\r\nexport function linkContainer(baseUUID,mirrorUUID){\r\n    let baseSemantic = null;\r\n    console.log(currentObjects.rootVertices) \r\n    //Since rootvertices was made as a set, cant just find indexes to reference, have to keep for looping to what we want\r\n    for(let i of currentObjects.rootVertices){\r\n        if(i.vertex.semanticIdentity.UUID === baseUUID){\r\n            baseSemantic = i;\r\n            break\r\n        }\r\n    }\r\n    for(let i of currentObjects.rootVertices){\r\n        if(i.vertex.semanticIdentity.UUID === mirrorUUID){\r\n            i.vertex.semanticIdentity = baseSemantic.vertex.semanticIdentity;\r\n            break\r\n        }\r\n    }\r\n    for(let i of currentObjects.rootVertices){\r\n        if(i.vertex.semanticIdentity.UUID === baseUUID){\r\n            updateLinkedContainers(baseSemantic.vertex);\r\n        }\r\n    }\r\n\r\n    console.log(currentObjects.rootVertices)\r\n\r\n}\r\n//Updates the appearances of linked containers to match the input container\r\n//Without a source container or doing a general scan, containers would be matched to copy the first vertex in the set, not the one that most recently changed\r\nexport function updateLinkedContainers(inputContainer){\r\n    for(let i of currentObjects.rootVertices){\r\n        if(inputContainer.semanticIdentity.UUID === i.vertex.semanticIdentity.UUID){\r\n            i.vertex.title = inputContainer.title\r\n            i.vertex.content = inputContainer.content\r\n            i.vertex.icons = inputContainer.icons\r\n            i.vertex.colour = inputContainer.colour\r\n            i.vertex.imageElements = inputContainer.imageElements\r\n            i.vertex.fontSize = inputContainer.fontSize\r\n        }\r\n    }\r\n    drawAll()\r\n}\r\n\r\n//Function for creating a vertex object without the left menu tools - Lachlan\r\nexport function createVertex(x1, y1, width, height,name,content,colour,icons,imageElements,fontSize,semanticIdentity){\r\n\r\n    return new Vertex({title: name,content: content, colour: colour, x: x1, y: findNearestGridY(y1, 1), width: width, height: height, semanticIdentity: semanticIdentity});\r\n\r\n}\r\n\r\nexport function updateVertex(selectedObject){ // function to update the data of the contaimnment tree object and all other objects sharing the semantic- cooper\r\n    let vertex;\r\n    if(selectedObject.type !== \"treeVertex\"){\r\n        vertex = getLinkedVertex(selectedObject); // 'vertex' refers to the treeview object.\r\n\r\n        vertex.text = selectedObject.title + \" \";\r\n        vertex.content = selectedObject.content;\r\n        vertex.width = selectedObject.width;\r\n        vertex.height = selectedObject.height;\r\n\r\n        if(vertex.parentRenderKey === selectedObject.vertexRenderKey){\r\n            console.log(vertex)\r\n            console.log(selectedObject)\r\n        }\r\n        else{\r\n        \r\n        }\r\n    }\r\n    else{\r\n        vertex = selectedObject;\r\n    }\r\n\r\n\r\n    for(let verticies of currentObjects.flatten()){\r\n        if(vertex.semanticIdentity.UUID === verticies.originalUUID && verticies !== selectedObject){ // updates all of the canvas objects that come from the treeview object.\r\n\r\n            //check if This graph vertex is in a different folder to the base vertex, if so make it white and add location\r\n            //console.log(vertex.parentRenderKey)\r\n            //console.log(verticies.vertexRenderKey)\r\n\r\n            if(vertex.parentRenderKey === verticies.vertexRenderKey){\r\n                \r\n            //If the vertex's model is in same folder\r\n            verticies.title = vertex.text.replace(\" \", \"\")\r\n            verticies.colour = vertex.colour;\r\n            verticies.content = vertex.content;\r\n            }\r\n            else{\r\n            verticies.title = vertex.text.replace(\" \", \"\")\r\n            verticies.colour = \"#FFFFFF\";\r\n            verticies.content = vertex.content;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function getLinkedVertex(selectedObject){ // grabs the contaiment tree object - cooper\r\n    for(let vertex of vertexData){\r\n        if(vertex.semanticIdentity.UUID === selectedObject.originalUUID)\r\n        return vertex;\r\n    }\r\n}\r\n\r\nfunction createObject(canvas, x1, y1, x2, y2) {\r\n    let newPath;\r\n    let currentObjectsFlattened = currentObjects.flatten();\r\n\r\n    if (canvas.tool === \"Vertex\" && dragging === false) {\r\n        // Get positions\r\n        let pos = orderCoordinates(x1, y1, x2 + 10, y2);\r\n        let vy1 = findNearestGridY(pos[1], 0);\r\n        let vy2 = findNearestGridY(pos[3], 0);\r\n\r\n        // Add vertex\r\n        console.log(\"draw vertex\")\r\n        let newVert = handleAddVertex(\"Drawn Vertex\" ,getCurrentRenderKey())\r\n        console.log(newVert.semanticIdentity.UUID)\r\n\r\n        return new Vertex({title: \"Drawn Vertex\", content: newVert,colour: newVert.colour, x: pos[0], y: findNearestGridY(y1, 1), width: pos[2] - pos[0], height: vy2 - vy1, semanticIdentity: newVert.semanticIdentity});\r\n        \r\n\r\n    } else if (arrowToolSelected()) {\r\n        // Generate path\r\n\r\n        newPath = arrowPath.concat([getConnectionDataForArrow(x2, y2).coord]);\r\n\r\n        // Check if first path connects to a vertex, and ignore if it doesn't\r\n        // Should be 0 if the connectable connects to a vertex\r\n        //\r\n        //\r\n        //because createObject is always running when moving mouse\r\n        //\r\n        // if current mouse pos is not over a box, don't create arrow\r\n        // if removed here, it is still removed in another function \r\n        //let intersection = findIntersected(x2, y2);\r\n        if (newPath[0][0] !== 0) {\r\n            return null;\r\n        }\r\n\r\n        // Create arrow\r\n        \r\n        let arrow = new Arrow(currentObjectsFlattened, newPath, arrowType);\r\n        arrow.rebuildPath(currentObjectsFlattened);\r\n        return arrow;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function getGraphXYFromMouseEvent(e) {\r\n    resetMouseOrigin();\r\n\r\n    let x = (e.clientX - mouseOriginX) / getEffectiveZoom();\r\n    let y = (e.clientY - mouseOriginY) / getEffectiveZoom();\r\n\r\n    return [x, y];\r\n}\r\n\r\nexport function getDownload() {\r\n\r\n    let DLelement = document.createElement(\"a\");\r\n    DLelement.href = canvasElement.toDataURL(\"image/png\").replace(/^data:image\\/[^;]/, 'data:application/octet-stream');\r\n    DLelement.download = \"Graph.png\";\r\n    document.body.appendChild(DLelement);\r\n    DLelement.click();\r\n\r\n}\r\n\r\nfunction orderCoordinates(sx, sy, ex, ey) {\r\n    // This code also ensures x1 < x2 and y1 < y2\r\n    let x1 = Math.min(sx, ex);\r\n    let y1 = Math.min(sy, ey);\r\n    let x2 = Math.max(sx, ex);\r\n    let y2 = Math.max(sy, ey);\r\n\r\n    return [x1, y1, x2, y2];\r\n}\r\n\r\n// Gets the effective (percentage) zoom from the current zoom\r\nfunction getEffectiveZoom() {\r\n    return zoom / 100;\r\n}\r\n\r\n// This should be used whenever the window itself resizes\r\nfunction recalculateScale() {\r\n    // Adjusts the aspect ratio so it is 1:1 instead of matching the windows.\r\n    // Also removes blurry rendering\r\n    //let dpi = window.devicePixelRatio;\r\n    let canvasContainer = document.getElementsByClassName(\"Canvas\")[0];\r\n    let styleHeight = +getComputedStyle(canvasContainer).getPropertyValue(\"height\").slice(0, -2);\r\n    let styleWidth = +getComputedStyle(canvasContainer).getPropertyValue(\"width\").slice(0, -2);\r\n\r\n    canvasElement.setAttribute('height', styleHeight * getEffectiveZoom());\r\n    canvasElement.setAttribute('width', styleWidth * getEffectiveZoom());\r\n\r\n    // Configurable\r\n    canvasWidth = canvasElement.width;\r\n    canvasHeight = canvasElement.height;\r\n}\r\n\r\nfunction clearCanvas() {\r\n    // Fill base canvas\r\n    canvasContext.fillStyle = \"#ffffff\";\r\n    canvasContext.fillRect(0, 0, canvasWidth, canvasHeight);\r\n}\r\n","import React from 'react';\r\nimport {getFolderData,getModelData,getSelectedFolderKey,setSelectedFolderKey,handleModelRebase,handleRenameFolder, handleAddModel, getModelNameFromKey, modelObjects, \r\n    handleAddFolder, handleDeleteFolder, handleDeleteModel, handleRenameModel} from \"./ContainmentTree\"\r\nimport {getCurrentRenderKey, setNewRenderKey, getCurrentModel, setNewModel, findIntersected, getGraphXYFromMouseEvent, getObjectFromUUID, getCurrentObjects,\r\n    linkContainer, currentObjects, drawAll, updateVertex} from \"./CanvasDraw\";\r\nimport {handleAddVertex, handleDeleteVertex, getVertexData} from \"./ContainmentTree\";\r\nimport { createSaveState } from '../Serialisation/NewFileManager';\r\nlet rightClickedItem = \"Default\"; //Name of the right clicked item where \"Default\" is a non-object such as empty canvas space\r\nlet rightClickedItemKey = 0; // Identifying key of selected item needed to use relating methods eg. selectedFolderKey, ModelKey,VertexKey.\r\nlet menuType = \"Default\"; //Which menu type to return based on the selected item and what operations are available to it\r\nlet rightClickedObject; // the canvas object which was right clicked\r\n\r\n\r\n\r\n//Right click menu component used to access certain function of program\r\nexport class ContextMenu extends React.Component {\r\n\r\n    \r\n    state = {\r\n        xPos: \"0px\",\r\n        yPos: \"0px\",\r\n        showMenu: false\r\n    }\r\n\r\n\r\n    componentDidMount() {\r\n        document.addEventListener(\"click\", this.handleClick);\r\n        document.addEventListener(\"contextmenu\", this.handleContextMenu);\r\n        document.addEventListener(\"keypress\", this.handleKey);\r\n\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener(\"click\", this.handleClick);\r\n        document.removeEventListener(\"contextmenu\", this.handleContextMenu);\r\n        document.removeEventListener(\"keypress\", this.handleKey);\r\n    }\r\n\r\n    //The handle click method will check which option has been clicked and call the relevant method\r\n    handleClick = (e) => {\r\n        //ignore clicks if context menu closed\r\n        if (this.state.showMenu) {\r\n            //console.log(e.target.id)\r\n            \r\n            //If Move model was selected, create a new context menu with available folders\r\n            if(e.target.id === \"MoveModel\"){\r\n                menuType = \"MoveModel\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(menuType === 'MoveModel' && e.target.id.includes(\"Folder\")){\r\n                let newFolderKey = e.target.id.replace(\"Folder\",'')\r\n                //console.log(newFolderKey) \r\n                handleModelRebase(rightClickedItemKey,parseInt(newFolderKey));\r\n                console.log(\"model \", rightClickedItemKey, \" moved to folder id \",newFolderKey)\r\n                this.setState({showMenu: false})\r\n                this.props.setLeftMenuToTree();\r\n            }\r\n            else if(e.target.id === \"Rename\"){\r\n                menuType = \"Rename\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"RenameVertex\"){\r\n                menuType = \"RenameVertex\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"RenameModel\"){\r\n                menuType = \"RenameModel\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"AddVertex\"){\r\n                menuType = \"AddVertex\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"AddGraph\"){\r\n                menuType = \"AddGraph\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"AddPackage\"){\r\n                menuType = \"AddPackage\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"DeletePackage\"){\r\n                menuType = \"DeletePackage\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"DeleteVertex\"){\r\n                menuType = \"DeleteVertex\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"DeleteModel\"){\r\n                menuType = \"DeleteModel\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(e.target.id === \"DeleteVertexConfirmed\"){\r\n                for(let vertex of getVertexData()){\r\n                    if(vertex.renderKey === rightClickedItemKey){\r\n                        handleDeleteVertex(vertex.semanticIdentity.UUID)\r\n                    }\r\n                }\r\n                this.setState({showMenu: false})\r\n                this.props.setLeftMenuToTree();\r\n                createSaveState();\r\n            }\r\n            else if(e.target.id === \"DeletePackageConfirmed\"){\r\n                for(let folder of getFolderData()){\r\n                    if(folder.renderKey === rightClickedItemKey){\r\n                        handleDeleteFolder(rightClickedItemKey)\r\n                    }\r\n                }\r\n                this.setState({showMenu: false})\r\n                this.props.setLeftMenuToTree();\r\n                createSaveState();\r\n            }\r\n            else if(e.target.id === \"DeleteModelConfirmed\"){\r\n                for(let model of modelObjects){\r\n                    if(model.modelKey === rightClickedItemKey){\r\n                        handleDeleteModel(rightClickedItemKey)\r\n                    }\r\n                }\r\n                this.setState({showMenu: false})\r\n                this.props.setLeftMenuToTree();\r\n                createSaveState();\r\n            }\r\n            else if(e.target.id === \"RenameBox\" || e.target.id === \"CMSelected\"){ //This prevents the context menu closing when certain targets are clicked\r\n            }\r\n            else if(e.target.id === \"RenameVertexBox\" || e.target.id === \"CMSelected\"){ //This prevents the context menu closing when certain targets are clicked\r\n            }\r\n            else if(e.target.id === \"RenameModelBox\" || e.target.id === \"CMSelected\"){ //This prevents the context menu closing when certain targets are clicked\r\n            }\r\n            else if(e.target.id === \"VertexNameBox\" || e.target.id === \"CMSelected\"){ //This prevents the context menu closing when certain targets are clicked\r\n            }\r\n            else if(e.target.id === \"GraphNameBox\" || e.target.id === \"CMSelected\"){ //This prevents the context menu closing when certain targets are clicked\r\n            }\r\n            else if(e.target.id === \"PackageNameBox\" || e.target.id === \"CMSelected\"){ //This prevents the context menu closing when certain targets are clicked\r\n            }\r\n            else if(e.target.id === \"Create-Graph\"){\r\n                menuType = \"AddContainerModel\";\r\n                this.setState({showMenu: true})\r\n            }\r\n            else if(menuType === 'AddContainerModel' && e.target.id.includes(\"Folder\")){\r\n                console.log(rightClickedObject)  \r\n                let newFolderKey = e.target.id.replace(\"Folder\",'')\r\n                handleAddModel(rightClickedObject.title,parseInt(newFolderKey),rightClickedObject.semanticIdentity)\r\n                this.props.setLeftMenuToTree();\r\n                this.setState({showMenu: false})\r\n            }\r\n            else if(e.target.id === \"LinkContainer\"){\r\n                menuType = \"LinkContainer\";\r\n                this.setState({showMenu: true})\r\n                console.log(getCurrentObjects().rootVertices)\r\n            }\r\n            else if(menuType === 'LinkContainer' && e.target.id.includes(\"Vertex\")){\r\n                console.log(\"linking semantic\")  \r\n                let baseUUID = e.target.id.replace(\"Vertex\",'');\r\n                let mirrorUUID = rightClickedObject.semanticIdentity.UUID;\r\n                linkContainer(baseUUID,mirrorUUID)\r\n                this.props.setLeftMenuToTree();\r\n\r\n                this.setState({showMenu: false})\r\n            }\r\n            else if(e.target.id === \"Bi-Nav\"){\r\n                menuType = \"Bi-Nav\";\r\n                this.setState({showMenu: true})\r\n\r\n            }\r\n            else if(menuType === 'Bi-Nav' && e.target.id.includes(\"Nav\")){\r\n                console.log(\"navigating\")  \r\n                let keys = e.target.id.replace(\"Nav\",'');\r\n                console.log(keys)\r\n\r\n\r\n                setNewModel(parseInt(keys[0]));\r\n                setNewRenderKey(keys[1]); // automatically sets the renderkey to be the same as the models as this was causing issues - cooper\r\n                setSelectedFolderKey(keys[1]);\r\n                for (let item of currentObjects.flatten()){\r\n                    if (item.typeName === \"Vertex\" && item.getModelKey() === getCurrentModel()){\r\n                        item.setPresent();\r\n                    }\r\n                    else if (item.getModelKey() !== getCurrentModel() && item.typeName === \"Vertex\"){\r\n                        item.setAway();\r\n                    }\r\n                }\r\n                drawAll();\r\n                console.log(getCurrentModel(),getCurrentRenderKey())\r\n                this.props.setLeftMenuToTree();\r\n\r\n\r\n                this.setState({showMenu: false})\r\n            }\r\n\r\n            \r\n            else{this.setState({ showMenu: false });}\r\n            \r\n        }\r\n    }\r\n\r\n    handleKey = (e) => {\r\n        if(e.key === 'Enter'){\r\n            if(menuType === \"Rename\"){\r\n                let newName = document.getElementById(\"RenameBox\").value\r\n                handleRenameFolder(newName,rightClickedItemKey)\r\n                console.log(\"menu change\")\r\n                try{\r\n                this.props.setLeftMenuToTree();\r\n                }\r\n                catch(e){ //Not sure why theres an error here as it performs the method, then says the method doesnt exists, doesnt trigger on other uses of method either.-Lachlan\r\n                    //believe the issue is enter key event is fireing twice, will fix later, not a critical/detrimental or performance effecting issue - Lachlan\r\n                    console.log(e)\r\n                }\r\n                console.log(\"menu change fin\")\r\n                this.setState({ showMenu: false })\r\n                createSaveState();\r\n            }\r\n            else if(menuType === \"RenameModel\"){\r\n                let newName = document.getElementById(\"RenameModelBox\").value\r\n                handleRenameModel(newName,rightClickedItemKey)\r\n                console.log(\"menu change\")\r\n                try{\r\n                this.props.setLeftMenuToTree();\r\n                }\r\n                catch(e){ \r\n                    console.log(e)\r\n                }\r\n                console.log(\"menu change fin\")\r\n                this.setState({ showMenu: false })\r\n                createSaveState();\r\n            }\r\n            else if(menuType === \"RenameVertex\"){\r\n                let newName = document.getElementById(\"RenameVertexBox\").value\r\n                rightClickedObject.text = newName;\r\n                rightClickedObject.data.text = newName;\r\n                console.log(\"menu change\")\r\n                try{\r\n                this.props.setLeftMenuToTree();\r\n                }\r\n                catch(e){ \r\n                    console.log(e)\r\n                }\r\n                console.log(\"rightClickedObject\")\r\n                console.log(rightClickedObject)\r\n                updateVertex(rightClickedObject);\r\n                console.log(\"menu change fin\")\r\n                this.setState({ showMenu: false })\r\n                drawAll()\r\n                createSaveState();\r\n            }\r\n            else if(menuType === \"AddVertex\"){\r\n                \r\n                let vertexName = document.getElementById(\"VertexNameBox\").value;\r\n                handleAddVertex(vertexName, getSelectedFolderKey());\r\n                try{\r\n                this.props.setLeftMenuToTree();\r\n                }\r\n                catch(e){\r\n                    console.log(e);\r\n                }\r\n                this.setState({showMenu: false});\r\n                createSaveState();\r\n            }\r\n            else if(menuType === \"AddGraph\"){\r\n                \r\n                let graphName = document.getElementById(\"GraphNameBox\").value;\r\n                handleAddModel(graphName, getSelectedFolderKey());\r\n                try{\r\n                this.props.setLeftMenuToTree();\r\n                }\r\n                catch(e){\r\n                    console.log(e);\r\n                }\r\n                this.setState({showMenu: false});\r\n                createSaveState();\r\n            }\r\n            else if(menuType === \"AddPackage\"){\r\n                \r\n                let packageName = document.getElementById(\"PackageNameBox\").value;\r\n                handleAddFolder(packageName, getSelectedFolderKey());\r\n                try{\r\n                this.props.setLeftMenuToTree();\r\n                }\r\n                catch(e){\r\n                    console.log(e);\r\n                }\r\n                this.setState({showMenu: false});\r\n                createSaveState();\r\n            }\r\n        }\r\n        /*if(e.key === 'Enter'){\r\n            console.log(\"enter pressed\")\r\n        }\r\n        */\r\n    }\r\n\r\n    \r\n    handleContextMenu = (e) => {\r\n        e.preventDefault();//prevent default stops the regular contextmenu from appearing\r\n\r\n        /*as alot of the \"data\" is in the back end and not in the html element displayed,\r\n         we need to simulate a left click to actually select what were right clicking on in the background \r\n         */\r\n        e.target.click();\r\n\r\n        menuType = \"Default\"; //reset the menu type\r\n        rightClickedItem = \"Default\" //reset the selected item\r\n        rightClickedItemKey = 0 //reset the index\r\n        rightClickedObject = null; // reset the object\r\n        \r\n\r\n        //console.log(e.target.className)\r\n\r\n        //If target is tree node\r\n        if(e.target.className === \"jstree-anchor jstree-hovered jstree-clicked\"){\r\n            //console.log(\"clicked a tree object\")\r\n            //if target is existing folder, load the folder menu\r\n            if(e.target.text.includes(\"\")){\r\n                for(let folder of getFolderData()){\r\n                    if(e.target.text === folder.text){\r\n                        //console.log(\"matching folder found\")\r\n                        menuType = \"Folder\"\r\n                        rightClickedItem = e.target.text;\r\n                        rightClickedItemKey = getSelectedFolderKey();\r\n                    }\r\n                }\r\n            }\r\n\r\n            //if target is existing model, load model menu\r\n            if(e.target.text.includes(\"\")){\r\n                for(let model of getModelData()){\r\n                    if(e.target.text === model.text){\r\n                        //console.log(\"matching model found\")\r\n                        menuType = \"Model\"\r\n                        rightClickedItem = e.target.text;\r\n                        rightClickedItemKey = getCurrentModel();\r\n                    }\r\n                }\r\n            }\r\n            console.log(\"e.target\")\r\n            console.log(e.target)\r\n            //if target is existing vertex load vertex menu\r\n            if(e.target.text.includes(\"\") || e.target.text.includes(\"\")){\r\n                console.log(\"e.target\")\r\n                console.log(e.target)\r\n                for(let vertex of getVertexData()){\r\n                    if(e.target.text === vertex.text){\r\n                        menuType = \"Vertex\"\r\n                        rightClickedObject = vertex;\r\n                        rightClickedItem = e.target.text;\r\n                        rightClickedItemKey = getSelectedFolderKey();\r\n\r\n                    }\r\n                }\r\n            }\r\n\r\n            if(e.target.text === \"Root\"){\r\n                \r\n                //console.log(\"matching folder found\")\r\n                menuType = \"Root\"\r\n                rightClickedItem = e.target.text;\r\n                rightClickedItemKey = getSelectedFolderKey();\r\n            }\r\n            \r\n        }\r\n\r\n        \r\n        // if target exists within the canvas\r\n        if(e.target.id ===\"drawCanvas\"){\r\n            let position = getGraphXYFromMouseEvent(e);\r\n            let x = position[0]; let y = position[1];\r\n            rightClickedObject = findIntersected(x, y);\r\n            if(rightClickedObject !== null){\r\n                if(rightClickedObject.typeName === \"Vertex\"){\r\n                    rightClickedItem = rightClickedObject.title\r\n                    if(rightClickedObject.isContainer === true){\r\n                        menuType = \"Container\"\r\n                    }\r\n                    else{\r\n                        menuType = \"CanvasVertex\"\r\n                    }\r\n                    \r\n                }\r\n                else if(rightClickedObject.typeName === \"Arrow\"){\r\n                    let source = getObjectFromUUID(rightClickedObject.sourceVertexUUID);\r\n                    let dest = getObjectFromUUID(rightClickedObject.destVertexUUID);\r\n                    let sourceName = source.title;\r\n                    let destName = dest.title;\r\n                    rightClickedItem = \"Arrow from \" + sourceName + \" to \" + destName\r\n                    menuType = \"Arrow\"\r\n                }\r\n            }\r\n            \r\n        }\r\n        this.setState({\r\n            xPos: `${e.pageX}px`,\r\n            yPos: `${e.pageY}px`,\r\n            showMenu: true,\r\n          });\r\n        \r\n    };\r\n    \r\n\r\n    render() {\r\n        const { showMenu, yPos, xPos } = this.state;\r\n        if (showMenu){\r\n            if(menuType === \"Default\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\">Default</div>   \r\n\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"Folder\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"><b>{rightClickedItem}</b></div>   \r\n                    <div className=\"CMitem\" id=\"Rename\"> Rename</div>\r\n                    <div className=\"CMitem\" id=\"AddVertex\"> Add Vertex</div>\r\n                    <div className=\"CMitem\" id=\"AddGraph\"> Add Graph</div>\r\n                    <div className=\"CMitem\" id=\"AddPackage\"> Add Package</div>\r\n                    <div className=\"CMitem\" id=\"DeletePackage\"> Delete Package</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"Root\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"><b>{rightClickedItem}</b></div>   \r\n                    <div className=\"CMitem\" id=\"AddPackage\"> Add Package</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"DeletePackage\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"><b>Are you sure you wish to delete: {rightClickedItem}</b></div>   \r\n                    <div className=\"CMitem\" id=\"DeletePackageConfirmed\"> Yes, Delete this package</div>\r\n                    <div className=\"CMitem\" id=\"DeletePackageCancel\"> No</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"DeleteModel\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"><b>Are you sure you wish to delete: {rightClickedItem}</b></div>   \r\n                    <div className=\"CMitem\" id=\"DeleteModelConfirmed\"> Yes, Delete this graph</div>\r\n                    <div className=\"CMitem\" id=\"DeleteModelCancel\"> No</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"DeleteVertex\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"><b>Are you sure you wish to delete: {rightClickedItem}</b></div>   \r\n                    <div className=\"CMitem\" id=\"DeleteVertexConfirmed\"> Yes, Delete this vertex</div>\r\n                    <div className=\"CMitem\" id=\"DeleteVertexCancel\"> No</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"Model\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <div className=\"CMitem\" id=\"RenameModel\"> Rename </div>\r\n                    <div className=\"CMitem\" id=\"MoveModel\"> Move To </div>\r\n                    <div className=\"CMitem\" id=\"DeleteModel\"> Delete Graph </div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"MoveModel\"){\r\n\r\n                let renderedOutput = getFolderData().map(item => <div className=\"CMitem\" id={'Folder'+ item.renderKey} key={item.text}> {item.text} </div>);\r\n\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> Move \"<b>{rightClickedItem}</b>\" To:</div>   \r\n                    <div>{renderedOutput}</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"Rename\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <input className=\"CMText\" id=\"RenameBox\" type=\"text\" name=\"renameItem\" placeholder='New Name'/>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"RenameModel\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <input className=\"CMText\" id=\"RenameModelBox\" type=\"text\" name=\"renameItem\" placeholder='New Name'/>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"RenameVertex\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <input className=\"CMText\" id=\"RenameVertexBox\" type=\"text\" name=\"renameItem\" placeholder='New Name'/>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"AddVertex\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <input className=\"CMText\" id=\"VertexNameBox\" type=\"text\" name=\"nameVertex\" placeholder='Vertex Name'/>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"AddPackage\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <input className=\"CMText\" id=\"PackageNameBox\" type=\"text\" name=\"namePackage\" placeholder='Package Name'/>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"AddGraph\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <input className=\"CMText\" id=\"GraphNameBox\" type=\"text\" name=\"nameGraph\" placeholder='Graph Name'/>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"Vertex\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>\r\n                    <div className=\"CMitem\" id=\"Bi-Nav\"> Naviagte </div>   \r\n                    <div className=\"CMitem\" id=\"RenameVertex\"> Rename</div>\r\n                    <div className=\"CMitem\" id=\"AddVertex\"> Add Vertex</div>\r\n                    <div className=\"CMitem\" id=\"AddGraph\"> Add Graph</div>\r\n                    <div className=\"CMitem\" id=\"AddPackage\"> Add Package</div>\r\n                    <div className=\"CMitem\" id=\"DeleteVertex\"> Delete Vertex </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            else if(menuType === \"Arrow\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <div className=\"CMitem\" id=\"Auto-Layout\"> Auto-Layout option (not implemented) </div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"CanvasVertex\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>   \r\n                    <div className=\"CMitem\" id=\"Auto-Layout\"> Auto-Layout option (not implemented) </div>\r\n                    <div className=\"CMitem\" id=\"Bi-Nav\"> Naviagte </div>\r\n                    </div>\r\n                )\r\n            }\r\n           \r\n            else if(menuType === \"Container\"){\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> </div>\r\n                    <div className=\"CMitem\" id=\"Create-Graph\"> Create Graph </div>   \r\n                    <div className=\"CMitem\" id=\"LinkContainer\"> Link Container From </div> \r\n                    <div className=\"CMitem\" id=\"Bi-Nav\"> Goto other occurences </div> \r\n                    <div className=\"CMitem\" id=\"Auto-Layout\"> Auto-Layout option (not implemented) </div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"LinkContainer\"){\r\n                console.log(getCurrentObjects().rootVertices)\r\n                let vertices = Array.from(getCurrentObjects().rootVertices)\r\n                console.log(vertices)\r\n                for(let i in vertices){\r\n                    if (vertices[i].vertex.isContainer === false){\r\n                        vertices.splice(i,1)\r\n                    }\r\n                }\r\n                console.log(vertices)\r\n                \r\n                let renderedOutput = vertices.map(item => <div className=\"CMitem\" id={'Vertex'+ item.vertex.semanticIdentity.UUID} key={'Vertex'+ item.vertex.semanticIdentity.UUID + \" \" + item.vertex.awayx}> {getModelNameFromKey(item.vertex.vertexModelKey)} / {item.vertex.title} </div>);\r\n                \r\n                console.log(renderedOutput)\r\n\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> Link <b>{rightClickedItem}</b> from: </div>\r\n                    <div>{renderedOutput}</div>\r\n                    </div>\r\n                    \r\n                )\r\n            }\r\n            else if(menuType === \"AddContainerModel\"){\r\n                \r\n                let renderedOutput = getFolderData().map(item => <div className=\"CMitem\" id={'Folder'+ item.renderKey} key={item.text}> {item.text} </div>);\r\n\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> Create Model of <b>{rightClickedItem}</b> in:</div>   \r\n                    <div>{renderedOutput}</div>\r\n                    </div>\r\n                )\r\n            }\r\n            else if(menuType === \"Bi-Nav\"){\r\n\r\n                console.log(getCurrentObjects().rootVertices);\r\n                let matchingContainers = [];\r\n                let matchingModels = [];\r\n                let matchingUUID = 0;\r\n\r\n                matchingUUID = rightClickedObject.originalUUID;\r\n                //If undefined, then a treeview vertex is selected\r\n                if(matchingUUID === undefined){\r\n                    matchingUUID = rightClickedObject.semanticIdentity.UUID\r\n                }\r\n                console.log(\"UUID stuff\")\r\n                console.log(matchingUUID)\r\n                console.log(rightClickedObject.semanticIdentity.UUID)\r\n\r\n\r\n                for(let vert of getCurrentObjects().rootVertices){\r\n                    if(vert.vertex.originalUUID === matchingUUID){\r\n                        matchingContainers.push(vert)\r\n                    }\r\n                }\r\n                for(let model of getModelData()){\r\n                    if(model.semanticIdentity.UUID === matchingUUID){\r\n                        matchingModels.push(model)\r\n                    }\r\n                }\r\n\r\n                console.log(matchingContainers)\r\n                let renderedContainers = matchingContainers.map(item => <div className=\"CMitem\" id={'Nav'+ item.vertex.vertexModelKey + \" \" + item.vertex.vertexRenderKey} key={'Nav'+ item.vertex.semanticIdentity.UUID + \" \" + item.vertex.awayx}> {getModelNameFromKey(item.vertex.vertexModelKey)} / {item.vertex.title} </div>)\r\n                let renderedModels = matchingModels.map(item => <div className=\"CMitem\" id={'Nav'+ item.modelKey + \" \" + item.renderKey} key={'Nav'+ item.semanticIdentity.UUID}> {item.text}</div>)\r\n                \r\n\r\n                return (\r\n\r\n                //options are given classnames to identify what has been selected\r\n                    <div className=\"ContextMenu\" style={{top: yPos,left: xPos,}}>\r\n                    <div className=\"CMSelected\" id=\"CMSelected\"> <b>{rightClickedItem}</b> also appears at:</div>   \r\n                    <div>{renderedContainers}</div>\r\n                    <div>{renderedModels}</div>\r\n                    </div>\r\n                )\r\n            }\r\n        }\r\n    else return null;\r\n  }\r\n}\r\n","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport React from 'react';\r\nimport '../App.css';\r\nimport * as canvasDraw from \"./CanvasDraw\";\r\nimport {DropdownButton,Dropdown} from \"react-bootstrap\";\r\n\r\nimport {Canvas} from './Canvas';\r\nimport {LeftMenu, LeftMenuType, StringToLeftMenuType, Tool} from './LeftMenu';\r\n\r\n// Semantic domain editor\r\nimport SemanticDomainEditor from \"./SemanticDomainEditor\";\r\nimport {resetRows} from \"./SemanticDomainEditor\";\r\n\r\n//Adding folders to the tree view\r\nimport {handleAddFolder, handleDeleteModel, handleAddModel,handleRenameFolder, getSelectedFolderKey, handleRenameModel, handleAddVertex} from './ContainmentTree';\r\nimport { handleDeleteFolder } from './ContainmentTree';\r\n\r\nimport { showVertexPath } from './ContainmentTree';\r\nimport { someVertexPath } from './ContainmentTree';\r\nimport { ContextMenu } from './ContextMenu'\r\nimport {save, load, importLoad, undo, redo} from '../Serialisation/NewFileManager'\r\n\r\n\r\nimport iconRedo from \"../Resources/redo.svg\"\r\nimport iconUndo from \"../Resources/undo.svg\"\r\nimport iconHelp from \"../Resources/help.svg\"\r\n\r\n\r\n\r\nexport const version = 1;\r\n\r\nexport const serverURL = 'http://localhost:8080'\r\n\r\nlet folderName = \"Unnamed Folder\";\r\n\r\n\r\nexport class MainProgramClass extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            zoomLevel: 200,\r\n            drawMode: Tool.Vertex,\r\n            menu: LeftMenuType.TreeView,\r\n            selectedObject: null,\r\n        };\r\n\r\n        this.setMode = this.setMode.bind(this);\r\n        this.setLeftMenu = this.setLeftMenu.bind(this);\r\n        this.setLeftMenuToTree = this.setLeftMenuToTree.bind(this);\r\n        this.semanticTableEnabled = false;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.setMode(Tool.Select);\r\n        console.log(\"Mounted\");\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n        let div = document.getElementById(prevState.SelectedTool);\r\n\r\n        if (div !== null) {\r\n            div.style.backgroundColor = \"#FFFFFF\";\r\n        }\r\n\r\n        div = document.getElementById(this.state.SelectedTool);\r\n\r\n        div.style.backgroundColor = \"#CFFFFF\";\r\n\r\n        //console.log(\"Mode set to: \" + this.state.SelectedTool);\r\n\r\n        // This bit of code here updates the path for whatever vertex is being updated\r\n        if (this.state.selectedObject !== null){\r\n            if (this.state.selectedObject.typeName === \"Vertex\"){\r\n                showVertexPath(this.state.selectedObject)\r\n                this.state.selectedObject.setPath(someVertexPath)\r\n            }\r\n        }\r\n\r\n        \r\n        \r\n    }\r\n\r\n\r\n\r\n    updateFolderName = () => {\r\n        folderName = document.getElementById(\"FolderName\").value\r\n    }\r\n\r\n    //The following add/delete functions Now reload the treeview on add/deleteing folders and models - Lachlan\r\n    //The async function is due to javascript executing SetLeftMenuToTree without waiting for handleadd/delete to manipulate data for the new tree - LAchlan\r\n    addFolder = () => {\r\n        //handleAddFolder({modelName:document.getElementById(\"FolderName\").value});\r\n        //ContainmentTree.state = ContainmentTree.state;\r\n        //LeftMenu.state = LeftMenu.state;\r\n        (async() => {\r\n        //Your IDE might tell you this and following await's do nothing, but it is neccesary to stop setLeftMenuToTree fireing early - Lachlan\r\n        await handleAddFolder(folderName,getSelectedFolderKey());\r\n        this.setLeftMenuToTree();\r\n        })();\r\n        \r\n    }\r\n\r\n    deleteFolder = () => {\r\n        (async() => {\r\n            await handleDeleteFolder(getSelectedFolderKey());\r\n            this.setLeftMenuToTree();\r\n            })();\r\n    }\r\n\r\n    editFolderName = () => {\r\n        (async() => {\r\n            await handleRenameFolder(folderName,getSelectedFolderKey());\r\n            this.setLeftMenuToTree();\r\n        })();\r\n    }\r\n\r\n    addVertex = () =>{\r\n        (async() => {\r\n            await handleAddVertex(folderName,getSelectedFolderKey());\r\n            this.setLeftMenuToTree();\r\n        })();\r\n    }\r\n\r\n    addModel = () => {\r\n        (async() => {\r\n            await handleAddModel(folderName);\r\n            this.setLeftMenuToTree();\r\n            })();\r\n    }\r\n\r\n    deleteModel = () => {\r\n        \r\n        (async() => {\r\n            await handleDeleteModel(canvasDraw.getCurrentModel());\r\n            this.setLeftMenuToTree();\r\n            })();\r\n    }\r\n\r\n    editModelName = () => {\r\n        (async() => {\r\n            await handleRenameModel(folderName,canvasDraw.getCurrentModel());\r\n            this.setLeftMenuToTree();\r\n        })();\r\n    }\r\n\r\n    zoom = (type) => {\r\n        let cZoom = this.state.zoomLevel;\r\n        if (type === \"+\") {\r\n            if (this.state.zoomLevel < 500) {\r\n                this.setState({zoomLevel:cZoom += 25});\r\n                canvasDraw.setZoom(cZoom);\r\n            }\r\n        } else if (type === \"-\") {\r\n            if (this.state.zoomLevel > 100) {\r\n                this.setState({zoomLevel:cZoom -= 25});\r\n                canvasDraw.setZoom(cZoom);\r\n            }\r\n\r\n        } else {\r\n            console.log(\"Invalid Zoom Type\")\r\n        }\r\n    };\r\n\r\n\r\n    setMode(mode) {\r\n\r\n        if(mode === Tool.Visibility || mode === Tool.Edge || mode === Tool.Specialisation){\r\n            this.setState({drawMode: \"Arrow\"})\r\n        }else if (mode === Tool.Vertex){\r\n            this.setState({drawMode: \"Vertex\"})\r\n        }else if (mode === Tool.Select){\r\n            this.setState({drawMode: \"Select\"})\r\n        } else if (mode === Tool.Artifact) {\r\n            this.setState({ drawMode: \"Artifact\" })\r\n        } else if (mode === Tool.Container) {\r\n            this.setState({ drawMode: \"Container\" })\r\n        }\r\n\r\n        //console.log(Tool[mode]);\r\n\r\n        this.setState({SelectedTool: Tool[mode]});\r\n\r\n        canvasDraw.setArrowType(mode)\r\n\r\n    };\r\n\r\n    // chooses which left hand menu to display, based on the selected item\r\n    setLeftMenu(nearestObject, ctrl = false, OP = []) {\r\n        \r\n        if (OP !== null){\r\n            for(let i = 0;i<OP.length;i++){\r\n                OP[i].setSelected(false); //visually deselects elements\r\n            }\r\n        }\r\n        // checks if that specific object was clicked\r\n        // if it wasn't then deselect it\r\n        // i.e. determines if objects are selected or not\r\n        if (this.state.selectedObject !== null && ctrl === false) {\r\n            this.state.selectedObject.setSelected(false);\r\n            \r\n        }\r\n\r\n        // check if the nearest object was too far away or didnt exist\r\n        if (nearestObject === null) {\r\n            this.setState({\r\n                menu: LeftMenuType.TreeView,\r\n                selectedObject: null,\r\n            });\r\n\r\n        }\r\n\r\n        // if the selected object has a left menu,\r\n        else if (StringToLeftMenuType[nearestObject.typeName] !== null) {\r\n            this.setState({\r\n                menu: nearestObject.typeName,\r\n                selectedObject: nearestObject\r\n            });\r\n            //console.log(\"below should be selectedObject\");\r\n            //console.log(this.state.selectedObject)\r\n            nearestObject.setSelected(true);\r\n        } else {\r\n            if (this.state.selectedObject !== null) {\r\n                canvasDraw.drawAll();\r\n            }\r\n\r\n            this.setState({\r\n                menu: LeftMenuType.TreeView,\r\n                selectedObject: null\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    //Function for setting left menu to tree\r\n    //This function serves as a direct way to \"statechange\" the treeview menu - Lachlan\r\n    setLeftMenuToTree(){\r\n        \r\n        if (this.state.selectedObject !== null) {\r\n            \r\n            canvasDraw.drawAll();\r\n        }\r\n        this.setState({\r\n            \r\n            menu: LeftMenuType.None,\r\n        });\r\n        this.setState({\r\n            menu: LeftMenuType.TreeView,\r\n            selectedObject: null\r\n            \r\n        });\r\n        console.log(\"set left menu To Tree enacted\")\r\n        \r\n    }\r\n\r\n    setModelName = () => {\r\n        this.setState({modelName:document.getElementById(\"ModelName\").value})\r\n    };\r\n\r\n    // Code for file uploading\r\n    // If you know how to move it elsewhere to clean up this file\r\n    // Please move it to src/DataStructures/FileManager.js or similar\r\n    showFile = () => {\r\n        let refreshTree = this.setLeftMenuToTree //This is used so we can point to setLeftMenuToTree within the reader object\r\n        if (window.File && window.FileReader && window.FileList && window.Blob) {\r\n            try {\r\n                let file = document.querySelector('input[type=file]').files[0];\r\n                let reader = new FileReader();\r\n                reader.readAsText(file);\r\n                console.log(reader.result)\r\n                reader.onload = function () {\r\n                    let text = reader.result\r\n                    load(text)\r\n                    refreshTree();\r\n                }\r\n            }catch(e){\r\n                alert(e +\" did you select a file?\")\r\n            }\r\n        } else {\r\n            alert(\"Your browser is too old to support HTML5 File API\");\r\n        }\r\n        return 0;\r\n    };\r\n\r\n    importFile = () => {\r\n        let refreshTree = this.setLeftMenuToTree //make setLeftMenuToTree local to the block so the reader can use it\r\n        if (window.File && window.FileReader && window.FileList && window.Blob) {\r\n            try {\r\n                let file = document.getElementById('File-Select-Import').files[0];\r\n                let reader = new FileReader();\r\n                reader.readAsText(file);\r\n                reader.onload = function () {\r\n                    let text = reader.result\r\n                    importLoad(text)\r\n                    refreshTree();\r\n                }\r\n            }catch(e){\r\n                alert(e +\" did you select a file?\")\r\n            }\r\n        } else {\r\n            alert(\"Your browser is too old to support HTML5 File API\");\r\n        }\r\n        return 0;\r\n    };\r\n\r\n\r\n\r\n    // Used to enable/disable the semantic domain editor\r\n    toggleSemanticDomainState = () => {\r\n        if (this.semanticTableEnabled) {\r\n            this.semanticTableEnabled = false;\r\n            canvasDraw.drawAll();\r\n            this.setState(this.state);\r\n            console.log(\"Semantic Domain disabled\");\r\n        } else {\r\n            this.semanticTableEnabled = true;\r\n            resetRows();\r\n            this.setState(this.state);\r\n            console.log(\"Semantic Domain enabled\");\r\n        }\r\n    };\r\n\r\n    async mainUndo(){\r\n        await undo();\r\n        this.setLeftMenuToTree();\r\n\r\n    }\r\n\r\n    async mainRedo(){\r\n        await redo();\r\n        this.setLeftMenuToTree();\r\n    }\r\n\r\n\r\n\r\n    render() {\r\n        let GUI =\r\n        <><ContextMenu setLeftMenuToTree={this.setLeftMenuToTree} /><div className=\"Program\">\r\n                <div className={this.semanticTableEnabled ? \"SemanticDomain\" : \"hidden\"}>\r\n                    <SemanticDomainEditor />\r\n                </div>\r\n\r\n                <div className=\"TopMenus\">\r\n\r\n                    <DropdownButton variant=\"Primary\" id=\"File-Menu\" title=\"File\" size=\"lg\">\r\n\r\n                        <Dropdown.Item>\r\n                            <div className=\"TopBar\">\r\n                                <button id=\"file\" onClick={() => canvasDraw.newFile()}>New File</button>\r\n                            </div>\r\n                        </Dropdown.Item>\r\n\r\n                        <Dropdown.Item>\r\n                            <div className=\"TopBar\">\r\n                                <button id=\"downloader\" onClick={() => canvasDraw.getDownload()} download=\"image.png\">Export as .png</button>\r\n                            </div>\r\n                        </Dropdown.Item>\r\n\r\n\r\n                        <div className=\"TopBar\">\r\n                            <label>Load</label>\r\n                            <input type=\"file\" id=\"File-Select\" onChange={this.showFile} />\r\n                        </div>\r\n\r\n\r\n\r\n                        <div className=\"TopBar\">\r\n                            <label>Import</label>\r\n                            <input type=\"file\" id=\"File-Select-Import\" onChange={this.importFile} />\r\n                        </div>\r\n\r\n\r\n\r\n                        <Dropdown.Item>\r\n                            <div className=\"TopBar\">\r\n                                <button id=\"json-downloader\" onClick={() => save()}>Save (as Json)</button>\r\n                            </div>\r\n                        </Dropdown.Item>\r\n\r\n                        \r\n\r\n                    </DropdownButton>\r\n\r\n                    <div className=\"TopBar\" onClick={() => this.toggleSemanticDomainState()}>\r\n                        Semantic Editor\r\n                    </div>\r\n\r\n                    {/*<input className=\"TopBarSearch\" id=\"ModelName\" type=\"text\" name=\"modelName\" placeholder=\"Graph NOme\" onChange={(e) => this.setModelName(e)} />*/}\r\n                    <input className=\"SelectedModel\" id=\"SelectedModel\" type=\"text\" name=\"selectedModel\" readOnly='readonly' />\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    {/*<input className=\"TopBarSearch\" id=\"FolderName\" type=\"text\" name=\"folderName\" placeholder=\"New Container/Model\" onChange={(e) => this.updateFolderName(e)} />*/}\r\n                    {/*<div className=\"TopBarIcon\">&nbsp;</div>*/}\r\n                    {/*The + and - are backwards on purpose here*/}\r\n                    <div className=\"TopBarIcon\" onClick={() => this.zoom('-')}> - </div>\r\n\r\n                    {/*<div className=\"TopBarLabel\"> {this.state.zoomLevel}% </div>*/}\r\n\r\n                    <div className=\"TopBarIcon\" onClick={() => this.zoom('+')}> + </div>\r\n\r\n\r\n                    {/*<div className=\"TopBarIdentifier\">Rows:&nbsp;</div>*/}\r\n                    {/*<input className=\"TopBarSelector\" style={{\"border-left\": \"0px\"}} type=\"number\" id = \"canvasRows\" defaultValue=\"70\" min=\"0\" max=\"105\" onChange={() => canvasDraw.updateRows()}/>*/}\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.mainUndo()} ><img src={iconUndo} alt=\"Delete Container\" /></div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.mainRedo()} ><img src={iconRedo} alt=\"Add Container\" /></div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarIcon\" ><a href=\"UserManual.pdf\"><img src={iconHelp} alt=\"Help\"/></a></div>\r\n                    \r\n\r\n                    {/*<div className=\"TopBarIcon\" onClick={() => this.addFolder()}><img src={iconNewFolder} alt=\"Add Container\" /></div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.deleteFolder()}><img src={iconDeleteFolder} alt=\"Delete Container\" /></div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.editFolderName()}><img src={iconEditFolder} alt=\"Edit Container\" /></div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.addVertex()}><img src={iconaddVertex} alt=\"Add Vertex\" /></div>\r\n                    <div className=\"TopBarSpace\">&nbsp;</div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.addModel()}><img src={iconNewModel} alt=\"Add Model\" /></div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.deleteModel()}><img src={iconDeleteModel} alt=\"Delete Model\" /></div>\r\n                    <div className=\"TopBarIcon\" onClick={() => this.editModelName()}><img src={iconEditModel} alt=\"Edit Model\" /></div>*/}\r\n\r\n\r\n\r\n                </div>\r\n\r\n                <div className=\"LowerPanel\" id= \"LowerPanel\">\r\n                    <LeftMenu setMode={this.setMode} setLeftMenu={this.setLeftMenu} mainState={this.state} className=\"LeftMenus\" />\r\n                    <div className=\"Canvas\" id = \"Canvas\">\r\n                        <Canvas setLeftMenu={this.setLeftMenu} setMode={this.setMode} mainState={this.state} />\r\n                    </div>\r\n                </div>\r\n            </div></>;\r\n        return GUI\r\n    }\r\n}","/* This Source Code Form is subject to the terms of the Mozilla Public\r\n * License, v. 2.0. If a copy of the MPL was not distributed with this\r\n * file, You can obtain one at https://mozilla.org/MPL/2.0/. */\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as ServiceWorker from './ServiceWorker';\r\nimport {MainProgramClass} from './UIElements/MainView';\r\nimport {assignElement} from \"./UIElements/CanvasDraw\";\r\n\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nReactDOM.render(<MainProgramClass />,document.getElementById(\"program\"));\r\nassignElement(\"drawCanvas\");\r\n\r\n// save to server every interval\r\n\r\n\r\n//setInterval(() => {\r\n//    let data = JSON.stringify(getSaveData());\r\n//\r\n//    fetch('http://localhost:8080/serialisation/save',{\r\n//        method:'POST',\r\n//        headers: {\r\n//            'Accept': '*/*',\r\n//            'Content-Type': 'application/json',\r\n//            'Content-Length':data.length\r\n//        },\r\n//        body: data\r\n//    });\r\n//},60000);\r\n\r\n\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nServiceWorker.unregister();\r\n\r\n"],"sourceRoot":""}